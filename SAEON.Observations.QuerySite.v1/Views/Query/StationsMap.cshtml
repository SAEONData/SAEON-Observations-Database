<div class="row">
    <div class="col-md-12">
        <div id="mapLocations" style="height:400px; width:100%"></div>
    </div>
</div>
@section scripts {
    <script type="text/javascript">
        var markers = [];
        var map;
        function initMap() {
            map = new google.maps.Map(document.getElementById('mapLocations'), {
                zoom: 5,
                center: { lat: -28.7238579, lng: 24.6531662 }
            });
            UpdateMap(true);
        }
        function UpdateMap(isInit) {
            $.getJSON("/Query/GetMapPoints")
                .done(function (json) {
                    for (var i = 0; i < markers.length; i++) {
                        markers[i].setMap(null);
                    }
                    markers = [];
                    var bounds = new google.maps.LatLngBounds();
                    var locations = json;
                    for (var i = 0; i < locations.length; i++) {
                        var location = locations[i];
                        var marker = new google.maps.Marker({
                            position: { lat: location.Latitude, lng: location.Longitude },
                            map: map,
                            title: location.Title
                        });
                        markers.push(marker);
                        bounds.extend(marker.position);
                        if (location.IsSelected) {
                            marker.setIcon('http://maps.google.com/mapfiles/ms/icons/green-dot.png');
                        }
                        else {
                            marker.setIcon('http://maps.google.com/mapfiles/ms/icons/red-dot.png');
                        }
                    }
                    if (isInit) {
                        if (markers.length > 0) {
                            map.fitBounds(bounds);
                        }
                    }
                    var center = map.getCenter();
                    google.maps.event.trigger(map, "resize");
                    map.setCenter(center);
                })
                .fail(function () { alert('Error in GetMapPoints'); });
        }
        $(window).resize(function () {
            UpdateMap();
        });
    </script>
    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDcCAczkNZZUu5DfM78-7cpBrAnwyEy_Tg&callback=initMap">
    </script>
}

