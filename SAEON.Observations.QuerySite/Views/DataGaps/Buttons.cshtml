@using SAEON.Observations.QuerySite.Models
@model DataGapsModel
@{
    Html.EJ()
        .Button("btnSearch")
        .Text("Search")
        .ShowRoundedCorner(true)
        .Type(ButtonType.Button)
        .Size(ButtonSize.Medium)
        .ContentType(ContentType.TextAndImage)
        .PrefixIcon("e-icon e-search")
        .Enabled(false)
        .ClientSideEvents(e => e.Click("onSearchClick"))
        .Render();
}
<script type="text/javascript">
    function onSearchClick() {
        ShowWaiting();
        $.get("/DataGaps/GetData")
            .done(function () {
                $("#PartialChart").load("/DataGaps/GetChartHtml", function () {
                    ShowResults();
                    EnableButtons();
                    HideWaiting();
                });
            })
            .fail(function (jqXHR, textStatus, errorThrown) {
                ErrorInFunc("Error in GetData Status: " + textStatus + " Error: " + errorThrown)
            });
    }
    function ErrorInFunc(msg) {
        HideWaiting();
        alert(msg);
    }
    function EnableButtons() {
        var btnSearch = $("#btnSearch").data("ejButton");
        treeObj = $("#treeViewLocations").data('ejTreeView');
        var checkedNodes = treeObj.getCheckedNodes();
        var selectedLocations = 0
        for (i = 0; i < checkedNodes.length; i++) {
            var checkedNode = checkedNodes[i];
            var nodeData = treeObj.getNode(checkedNode);
            if (nodeData.id.startsWith("STA~")) {
                selectedLocations = selectedLocations + 1;
            }
        }
        treeObj = $("#treeViewFeatures").data('ejTreeView');
        var checkedNodes = treeObj.getCheckedNodes();
        var selectedFeatures = 0
        for (i = 0; i < checkedNodes.length; i++) {
            var checkedNode = checkedNodes[i];
            var nodeData = treeObj.getNode(checkedNode);
            if (nodeData.id.startsWith("OFF~")) {
                selectedFeatures = selectedFeatures + 1;
            }
        }
        if ((selectedLocations > 0) & (selectedFeatures > 0)) {
            btnSearch.enable();
        }
        else {
            btnSearch.disable();
        }
    }
    function DisableButtons() {
        var btnSearch = $("#btnSearch").data("ejButton");
        btnSearch.disable();
    }
    function ShowResults() {
        $("#TableTab").removeClass("hidden");
        $("#CardsTab").removeClass("hidden");
        $("#ChartTab").removeClass("hidden");
    }
    function HideResults() {
        $("#ChartTab").addClass("hidden");
    }
</script>
