/*
Deployment script for ObservationsTest

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "ObservationsTest"
:setvar DefaultFilePrefix "ObservationsTest"
:setvar DefaultDataPath "C:\Program Files\Microsoft SQL Server\MSSQL13.SAEON\MSSQL\DATA\"
:setvar DefaultLogPath "C:\Program Files\Microsoft SQL Server\MSSQL13.SAEON\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
PRINT N'Dropping [dbo].[Site].[IX_Instrument_EndDate]...';


GO
DROP INDEX [IX_Instrument_EndDate]
    ON [dbo].[Site];


GO
PRINT N'Dropping [dbo].[Site].[IX_Instrument_StartDate]...';


GO
DROP INDEX [IX_Instrument_StartDate]
    ON [dbo].[Site];


GO
PRINT N'Dropping [dbo].[Site].[IX_Instrument_UserId]...';


GO
DROP INDEX [IX_Instrument_UserId]
    ON [dbo].[Site];


GO
PRINT N'Dropping [dbo].[DF_DataLog_ImportDate]...';


GO
ALTER TABLE [dbo].[DataLog] DROP CONSTRAINT [DF_DataLog_ImportDate];


GO
PRINT N'Dropping [dbo].[DF_DataLog_ID]...';


GO
ALTER TABLE [dbo].[DataLog] DROP CONSTRAINT [DF_DataLog_ID];


GO
PRINT N'Dropping [dbo].[DF_ImportBatch_ImportDate]...';


GO
ALTER TABLE [dbo].[ImportBatch] DROP CONSTRAINT [DF_ImportBatch_ImportDate];


GO
PRINT N'Dropping [dbo].[DF_ImportBatch_Guid]...';


GO
ALTER TABLE [dbo].[ImportBatch] DROP CONSTRAINT [DF_ImportBatch_Guid];


GO
PRINT N'Dropping [dbo].[DF_Observation_AddedDate]...';


GO
ALTER TABLE [dbo].[Observation] DROP CONSTRAINT [DF_Observation_AddedDate];


GO
PRINT N'Dropping [dbo].[DF_Observation_ID]...';


GO
ALTER TABLE [dbo].[Observation] DROP CONSTRAINT [DF_Observation_ID];


GO
PRINT N'Dropping [dbo].[DF_DataSchema_ID]...';


GO
ALTER TABLE [dbo].[DataSchema] DROP CONSTRAINT [DF_DataSchema_ID];


GO
PRINT N'Dropping [dbo].[DF_DataSchema_IgnoreFirst]...';


GO
ALTER TABLE [dbo].[DataSchema] DROP CONSTRAINT [DF_DataSchema_IgnoreFirst];


GO
PRINT N'Dropping [dbo].[DF_DataSchema_IgnoreLast]...';


GO
ALTER TABLE [dbo].[DataSchema] DROP CONSTRAINT [DF_DataSchema_IgnoreLast];


GO
PRINT N'Dropping [dbo].[DF_DataSource_ID]...';


GO
ALTER TABLE [dbo].[DataSource] DROP CONSTRAINT [DF_DataSource_ID];


GO
PRINT N'Dropping [dbo].[DF_DataSource_AddedAt]...';


GO
ALTER TABLE [dbo].[DataSource] DROP CONSTRAINT [DF_DataSource_AddedAt];


GO
PRINT N'Dropping [dbo].[DF_DataSource_UpdatedAt]...';


GO
ALTER TABLE [dbo].[DataSource] DROP CONSTRAINT [DF_DataSource_UpdatedAt];


GO
PRINT N'Dropping [dbo].[DF_DataSourceRole_ID]...';


GO
ALTER TABLE [dbo].[DataSourceRole] DROP CONSTRAINT [DF_DataSourceRole_ID];


GO
PRINT N'Dropping [dbo].[DF_DataSourceTransformation_ID]...';


GO
ALTER TABLE [dbo].[DataSourceTransformation] DROP CONSTRAINT [DF_DataSourceTransformation_ID];


GO
PRINT N'Dropping [dbo].[DF_DataSourceTransformation_Rank]...';


GO
ALTER TABLE [dbo].[DataSourceTransformation] DROP CONSTRAINT [DF_DataSourceTransformation_Rank];


GO
PRINT N'Dropping [dbo].[DF_DataSourceType_ID]...';


GO
ALTER TABLE [dbo].[DataSourceType] DROP CONSTRAINT [DF_DataSourceType_ID];


GO
PRINT N'Dropping [dbo].[DF_Instrument_ID]...';


GO
ALTER TABLE [dbo].[Instrument] DROP CONSTRAINT [DF_Instrument_ID];


GO
PRINT N'Dropping [dbo].[DF_Instrument_AddedAt]...';


GO
ALTER TABLE [dbo].[Instrument] DROP CONSTRAINT [DF_Instrument_AddedAt];


GO
PRINT N'Dropping [dbo].[DF_Instrument_UpdatedAt]...';


GO
ALTER TABLE [dbo].[Instrument] DROP CONSTRAINT [DF_Instrument_UpdatedAt];


GO
PRINT N'Dropping [dbo].[DF_Offering_ID]...';


GO
ALTER TABLE [dbo].[Offering] DROP CONSTRAINT [DF_Offering_ID];


GO
PRINT N'Dropping [dbo].[DF_OrganisationRole_ID]...';


GO
ALTER TABLE [dbo].[OrganisationRole] DROP CONSTRAINT [DF_OrganisationRole_ID];


GO
PRINT N'Dropping [dbo].[DF_Phenomenon_ID]...';


GO
ALTER TABLE [dbo].[Phenomenon] DROP CONSTRAINT [DF_Phenomenon_ID];


GO
PRINT N'Dropping [dbo].[DF_PhenomenonOffering_ID]...';


GO
ALTER TABLE [dbo].[PhenomenonOffering] DROP CONSTRAINT [DF_PhenomenonOffering_ID];


GO
PRINT N'Dropping [dbo].[DF_PhenomenonUOM_ID]...';


GO
ALTER TABLE [dbo].[PhenomenonUOM] DROP CONSTRAINT [DF_PhenomenonUOM_ID];


GO
PRINT N'Dropping [dbo].[DF_PhenomenonUOM_IsDefault]...';


GO
ALTER TABLE [dbo].[PhenomenonUOM] DROP CONSTRAINT [DF_PhenomenonUOM_IsDefault];


GO
PRINT N'Dropping [dbo].[DF_Sensor_ID]...';


GO
ALTER TABLE [dbo].[Sensor] DROP CONSTRAINT [DF_Sensor_ID];


GO
PRINT N'Dropping [dbo].[DF_Site_ID]...';


GO
ALTER TABLE [dbo].[Site] DROP CONSTRAINT [DF_Site_ID];


GO
PRINT N'Dropping [dbo].[DF_Site_AddedAt]...';


GO
ALTER TABLE [dbo].[Site] DROP CONSTRAINT [DF_Site_AddedAt];


GO
PRINT N'Dropping [dbo].[DF_Site_UpdatedAt]...';


GO
ALTER TABLE [dbo].[Site] DROP CONSTRAINT [DF_Site_UpdatedAt];


GO
PRINT N'Dropping [dbo].[DF_Statuib_StationID]...';


GO
ALTER TABLE [dbo].[Station] DROP CONSTRAINT [DF_Statuib_StationID];


GO
PRINT N'Dropping [dbo].[DF_Station_AddedAt]...';


GO
ALTER TABLE [dbo].[Station] DROP CONSTRAINT [DF_Station_AddedAt];


GO
PRINT N'Dropping [dbo].[DF_Station_UpdatedAt]...';


GO
ALTER TABLE [dbo].[Station] DROP CONSTRAINT [DF_Station_UpdatedAt];


GO
PRINT N'Dropping [dbo].[DF_Status_ID]...';


GO
ALTER TABLE [dbo].[Status] DROP CONSTRAINT [DF_Status_ID];


GO
PRINT N'Dropping [dbo].[DF_TransformationType_ID]...';


GO
ALTER TABLE [dbo].[TransformationType] DROP CONSTRAINT [DF_TransformationType_ID];


GO
PRINT N'Dropping [dbo].[DF_UnitOfMeasure_ID]...';


GO
ALTER TABLE [dbo].[UnitOfMeasure] DROP CONSTRAINT [DF_UnitOfMeasure_ID];


GO
PRINT N'Dropping [dbo].[DF_Table_1_Organisation]...';


GO
ALTER TABLE [dbo].[Organisation] DROP CONSTRAINT [DF_Table_1_Organisation];


GO
PRINT N'Dropping [dbo].[FK_DataLog_DataSourceTransformation]...';


GO
ALTER TABLE [dbo].[DataLog] DROP CONSTRAINT [FK_DataLog_DataSourceTransformation];


GO
PRINT N'Dropping [dbo].[FK_DataLog_Sensor]...';


GO
ALTER TABLE [dbo].[DataLog] DROP CONSTRAINT [FK_DataLog_Sensor];


GO
PRINT N'Dropping [dbo].[FK_DataLog_ImportBatchID]...';


GO
ALTER TABLE [dbo].[DataLog] DROP CONSTRAINT [FK_DataLog_ImportBatchID];


GO
PRINT N'Dropping [dbo].[FK_DataLog_aspnet_Users]...';


GO
ALTER TABLE [dbo].[DataLog] DROP CONSTRAINT [FK_DataLog_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_DataLog_Status]...';


GO
ALTER TABLE [dbo].[DataLog] DROP CONSTRAINT [FK_DataLog_Status];


GO
PRINT N'Dropping [dbo].[FK_DataLog_PhenomenonOffering]...';


GO
ALTER TABLE [dbo].[DataLog] DROP CONSTRAINT [FK_DataLog_PhenomenonOffering];


GO
PRINT N'Dropping [dbo].[FK_DataLog_PhenomenonUOM]...';


GO
ALTER TABLE [dbo].[DataLog] DROP CONSTRAINT [FK_DataLog_PhenomenonUOM];


GO
PRINT N'Dropping [dbo].[FK_ImportBatch_aspnet_Users]...';


GO
ALTER TABLE [dbo].[ImportBatch] DROP CONSTRAINT [FK_ImportBatch_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_ImportBatch_DataSource]...';


GO
ALTER TABLE [dbo].[ImportBatch] DROP CONSTRAINT [FK_ImportBatch_DataSource];


GO
PRINT N'Dropping [dbo].[FK_Observation_ImportBatchID]...';


GO
ALTER TABLE [dbo].[Observation] DROP CONSTRAINT [FK_Observation_ImportBatchID];


GO
PRINT N'Dropping [dbo].[FK_Observation_Sensor]...';


GO
ALTER TABLE [dbo].[Observation] DROP CONSTRAINT [FK_Observation_Sensor];


GO
PRINT N'Dropping [dbo].[FK_Observation_PhenomenonOffering]...';


GO
ALTER TABLE [dbo].[Observation] DROP CONSTRAINT [FK_Observation_PhenomenonOffering];


GO
PRINT N'Dropping [dbo].[FK_Observation_PhenomenonUOM]...';


GO
ALTER TABLE [dbo].[Observation] DROP CONSTRAINT [FK_Observation_PhenomenonUOM];


GO
PRINT N'Dropping [dbo].[FK_Observation_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Observation] DROP CONSTRAINT [FK_Observation_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_DataSource_DataSchema]...';


GO
ALTER TABLE [dbo].[DataSource] DROP CONSTRAINT [FK_DataSource_DataSchema];


GO
PRINT N'Dropping [dbo].[FK_Sensor_DataSchema]...';


GO
ALTER TABLE [dbo].[Sensor] DROP CONSTRAINT [FK_Sensor_DataSchema];


GO
PRINT N'Dropping [dbo].[FK_DataSchema_DataSourceType]...';


GO
ALTER TABLE [dbo].[DataSchema] DROP CONSTRAINT [FK_DataSchema_DataSourceType];


GO
PRINT N'Dropping [dbo].[FK_DataSourceTransformation_DataSource]...';


GO
ALTER TABLE [dbo].[DataSourceTransformation] DROP CONSTRAINT [FK_DataSourceTransformation_DataSource];


GO
PRINT N'Dropping [dbo].[FK_Sensor_DataSource]...';


GO
ALTER TABLE [dbo].[Sensor] DROP CONSTRAINT [FK_Sensor_DataSource];


GO
PRINT N'Dropping [dbo].[FK_DataSourceRole_DataSource]...';


GO
ALTER TABLE [dbo].[DataSourceRole] DROP CONSTRAINT [FK_DataSourceRole_DataSource];


GO
PRINT N'Dropping [dbo].[FK_DataSource_aspnet_Users]...';


GO
ALTER TABLE [dbo].[DataSource] DROP CONSTRAINT [FK_DataSource_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_DataSourceRole_aspnet_Users]...';


GO
ALTER TABLE [dbo].[DataSourceRole] DROP CONSTRAINT [FK_DataSourceRole_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_DataSourceRole_aspnet_Roles]...';


GO
ALTER TABLE [dbo].[DataSourceRole] DROP CONSTRAINT [FK_DataSourceRole_aspnet_Roles];


GO
PRINT N'Dropping [dbo].[FK_DataSourceTransformation_Sensor]...';


GO
ALTER TABLE [dbo].[DataSourceTransformation] DROP CONSTRAINT [FK_DataSourceTransformation_Sensor];


GO
PRINT N'Dropping [dbo].[FK_DataSourceTransformation_aspnet_Users]...';


GO
ALTER TABLE [dbo].[DataSourceTransformation] DROP CONSTRAINT [FK_DataSourceTransformation_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_DataSourceTransformation_Phenomenon]...';


GO
ALTER TABLE [dbo].[DataSourceTransformation] DROP CONSTRAINT [FK_DataSourceTransformation_Phenomenon];


GO
PRINT N'Dropping [dbo].[FK_DataSourceTransformation_TransformationType]...';


GO
ALTER TABLE [dbo].[DataSourceTransformation] DROP CONSTRAINT [FK_DataSourceTransformation_TransformationType];


GO
PRINT N'Dropping [dbo].[FK_DataSourceTransformation_PhenomenonOffering]...';


GO
ALTER TABLE [dbo].[DataSourceTransformation] DROP CONSTRAINT [FK_DataSourceTransformation_PhenomenonOffering];


GO
PRINT N'Dropping [dbo].[FK_DataSourceTransformation_PhenomenonUOM]...';


GO
ALTER TABLE [dbo].[DataSourceTransformation] DROP CONSTRAINT [FK_DataSourceTransformation_PhenomenonUOM];


GO
PRINT N'Dropping [dbo].[FK_DataSourceType_aspnet_Users]...';


GO
ALTER TABLE [dbo].[DataSourceType] DROP CONSTRAINT [FK_DataSourceType_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_Instrument_Organisation_Instrument]...';


GO
ALTER TABLE [dbo].[Instrument_Organisation] DROP CONSTRAINT [FK_Instrument_Organisation_Instrument];


GO
PRINT N'Dropping [dbo].[FK_Instrument_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Instrument] DROP CONSTRAINT [FK_Instrument_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_PhenomenonOffering_Offering]...';


GO
ALTER TABLE [dbo].[PhenomenonOffering] DROP CONSTRAINT [FK_PhenomenonOffering_Offering];


GO
PRINT N'Dropping [dbo].[FK_Offering_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Offering] DROP CONSTRAINT [FK_Offering_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_Instrument_Organisation_OrganisationRole]...';


GO
ALTER TABLE [dbo].[Instrument_Organisation] DROP CONSTRAINT [FK_Instrument_Organisation_OrganisationRole];


GO
PRINT N'Dropping [dbo].[FK_Site_Organisation_OrganisationRole]...';


GO
ALTER TABLE [dbo].[Site_Organisation] DROP CONSTRAINT [FK_Site_Organisation_OrganisationRole];


GO
PRINT N'Dropping [dbo].[FK_Station_Organisation_OrganisationRole]...';


GO
ALTER TABLE [dbo].[Station_Organisation] DROP CONSTRAINT [FK_Station_Organisation_OrganisationRole];


GO
PRINT N'Dropping [dbo].[FK_OrganisationRole_aspnet_Users]...';


GO
ALTER TABLE [dbo].[OrganisationRole] DROP CONSTRAINT [FK_OrganisationRole_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_PhenomenonOffering_Phenomenon]...';


GO
ALTER TABLE [dbo].[PhenomenonOffering] DROP CONSTRAINT [FK_PhenomenonOffering_Phenomenon];


GO
PRINT N'Dropping [dbo].[FK_PhenomenonUOM_PhenomenonUOM]...';


GO
ALTER TABLE [dbo].[PhenomenonUOM] DROP CONSTRAINT [FK_PhenomenonUOM_PhenomenonUOM];


GO
PRINT N'Dropping [dbo].[FK_Sensor_Phenomenon]...';


GO
ALTER TABLE [dbo].[Sensor] DROP CONSTRAINT [FK_Sensor_Phenomenon];


GO
PRINT N'Dropping [dbo].[FK_Phenomenon_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Phenomenon] DROP CONSTRAINT [FK_Phenomenon_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_PhenomenonOffering_aspnet_Users]...';


GO
ALTER TABLE [dbo].[PhenomenonOffering] DROP CONSTRAINT [FK_PhenomenonOffering_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_PhenomenonUOM_aspnet_Users]...';


GO
ALTER TABLE [dbo].[PhenomenonUOM] DROP CONSTRAINT [FK_PhenomenonUOM_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_PhenomenonUOM_UnitOfMeasure]...';


GO
ALTER TABLE [dbo].[PhenomenonUOM] DROP CONSTRAINT [FK_PhenomenonUOM_UnitOfMeasure];


GO
PRINT N'Dropping [dbo].[FK_Sensor_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Sensor] DROP CONSTRAINT [FK_Sensor_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_Sensor_Station]...';


GO
ALTER TABLE [dbo].[Sensor] DROP CONSTRAINT [FK_Sensor_Station];


GO
PRINT N'Dropping [dbo].[FK_Station_Site]...';


GO
ALTER TABLE [dbo].[Station] DROP CONSTRAINT [FK_Station_Site];


GO
PRINT N'Dropping [dbo].[FK_Site_Organisation_Site]...';


GO
ALTER TABLE [dbo].[Site_Organisation] DROP CONSTRAINT [FK_Site_Organisation_Site];


GO
PRINT N'Dropping [dbo].[FK_Site_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Site] DROP CONSTRAINT [FK_Site_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_Station_Organisation_Station]...';


GO
ALTER TABLE [dbo].[Station_Organisation] DROP CONSTRAINT [FK_Station_Organisation_Station];


GO
PRINT N'Dropping [dbo].[FK_Station_ProjectSite]...';


GO
ALTER TABLE [dbo].[Station] DROP CONSTRAINT [FK_Station_ProjectSite];


GO
PRINT N'Dropping [dbo].[FK_Station_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Station] DROP CONSTRAINT [FK_Station_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_Status_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Status] DROP CONSTRAINT [FK_Status_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_TransformationType_aspnet_Users]...';


GO
ALTER TABLE [dbo].[TransformationType] DROP CONSTRAINT [FK_TransformationType_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_UnitOfMeasure_aspnet_Users]...';


GO
ALTER TABLE [dbo].[UnitOfMeasure] DROP CONSTRAINT [FK_UnitOfMeasure_aspnet_Users];


GO
PRINT N'Dropping [dbo].[UX_Station_Code]...';


GO
ALTER TABLE [dbo].[Station] DROP CONSTRAINT [UX_Station_Code];


GO
PRINT N'Dropping [dbo].[UX_Station_Name]...';


GO
ALTER TABLE [dbo].[Station] DROP CONSTRAINT [UX_Station_Name];


GO
PRINT N'Starting rebuilding table [dbo].[DataLog]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_DataLog] (
    [ID]                         UNIQUEIDENTIFIER CONSTRAINT [DF_DataLog_ID] DEFAULT newid() NOT NULL,
    [SensorID]                   UNIQUEIDENTIFIER NULL,
    [ImportDate]                 DATETIME         CONSTRAINT [DF_DataLog_ImportDate] DEFAULT (getdate()) NOT NULL,
    [ValueDate]                  DATETIME         NULL,
    [ValueTime]                  DATETIME         NULL,
    [ValueText]                  VARCHAR (50)     NOT NULL,
    [TransformValueText]         VARCHAR (50)     NULL,
    [RawValue]                   FLOAT (53)       NULL,
    [DataValue]                  FLOAT (53)       NULL,
    [Comment]                    VARCHAR (250)    NULL,
    [InvalidDateValue]           VARCHAR (50)     NULL,
    [InvalidTimeValue]           VARCHAR (50)     NULL,
    [InvalidOffering]            VARCHAR (50)     NULL,
    [InvalidUOM]                 VARCHAR (50)     NULL,
    [DataSourceTransformationID] UNIQUEIDENTIFIER NULL,
    [StatusID]                   UNIQUEIDENTIFIER NOT NULL,
    [StatusReasonID]             UNIQUEIDENTIFIER NULL,
    [ImportStatus]               VARCHAR (500)    NOT NULL,
    [UserId]                     UNIQUEIDENTIFIER NULL,
    [PhenomenonOfferingID]       UNIQUEIDENTIFIER NULL,
    [PhenomenonUOMID]            UNIQUEIDENTIFIER NULL,
    [ImportBatchID]              UNIQUEIDENTIFIER NOT NULL,
    [RawRecordData]              VARCHAR (500)    NULL,
    [RawFieldValue]              VARCHAR (50)     NOT NULL,
    [AddedAt]                    DATETIME         CONSTRAINT [DF_DataLog_AddedAt] DEFAULT GetDate() NULL,
    [UpdatedAt]                  DATETIME         CONSTRAINT [DF_DataLog_UpdatedAt] DEFAULT GetDate() NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_DataLog1] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_DataLog1] UNIQUE NONCLUSTERED ([ImportBatchID] ASC, [SensorID] ASC, [ImportDate] ASC, [ValueDate] ASC, [ValueTime] ASC, [PhenomenonOfferingID] ASC, [PhenomenonUOMID] ASC)
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_CX_DataLog1]
    ON [dbo].[tmp_ms_xx_DataLog]([AddedAt] ASC);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[DataLog])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_DataLog] ([SensorID], [ImportDate], [ValueDate], [ValueTime], [ValueText], [TransformValueText], [RawValue], [DataValue], [Comment], [InvalidDateValue], [InvalidTimeValue], [InvalidOffering], [InvalidUOM], [DataSourceTransformationID], [StatusID], [ImportStatus], [UserId], [PhenomenonOfferingID], [PhenomenonUOMID], [RawRecordData], [RawFieldValue], [ID], [ImportBatchID])
        SELECT [SensorID],
               [ImportDate],
               [ValueDate],
               [ValueTime],
               [ValueText],
               [TransformValueText],
               [RawValue],
               [DataValue],
               [Comment],
               [InvalidDateValue],
               [InvalidTimeValue],
               [InvalidOffering],
               [InvalidUOM],
               [DataSourceTransformationID],
               [StatusID],
               [ImportStatus],
               [UserId],
               [PhenomenonOfferingID],
               [PhenomenonUOMID],
               [RawRecordData],
               [RawFieldValue],
               [ID],
               [ImportBatchID]
        FROM   [dbo].[DataLog];
    END

DROP TABLE [dbo].[DataLog];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_DataLog]', N'DataLog';

EXECUTE sp_rename N'[dbo].[DataLog].[tmp_ms_xx_index_CX_DataLog1]', N'CX_DataLog', N'INDEX';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_DataLog1]', N'PK_DataLog', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_DataLog1]', N'UX_DataLog', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating [dbo].[DataLog].[IX_DataLog_ImportBatchID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataLog_ImportBatchID]
    ON [dbo].[DataLog]([ImportBatchID] ASC);


GO
PRINT N'Creating [dbo].[DataLog].[IX_DataLog_SensorID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataLog_SensorID]
    ON [dbo].[DataLog]([SensorID] ASC);


GO
PRINT N'Creating [dbo].[DataLog].[IX_DataLog_DataSourceTransformationID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataLog_DataSourceTransformationID]
    ON [dbo].[DataLog]([DataSourceTransformationID] ASC);


GO
PRINT N'Creating [dbo].[DataLog].[IX_DataLog_PhenomenonOfferingID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataLog_PhenomenonOfferingID]
    ON [dbo].[DataLog]([PhenomenonOfferingID] ASC);


GO
PRINT N'Creating [dbo].[DataLog].[IX_DataLog_PhenomenonUOMID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataLog_PhenomenonUOMID]
    ON [dbo].[DataLog]([PhenomenonUOMID] ASC);


GO
PRINT N'Creating [dbo].[DataLog].[IX_DataLog_StatusID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataLog_StatusID]
    ON [dbo].[DataLog]([StatusID] ASC);


GO
PRINT N'Creating [dbo].[DataLog].[IX_DataLog_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataLog_UserId]
    ON [dbo].[DataLog]([UserId] ASC);


GO
PRINT N'Creating [dbo].[DataLog].[IX_DataLog_StatusReasonID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataLog_StatusReasonID]
    ON [dbo].[DataLog]([StatusReasonID] ASC);


GO
PRINT N'Starting rebuilding table [dbo].[DataSchema]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_DataSchema] (
    [ID]               UNIQUEIDENTIFIER CONSTRAINT [DF_DataSchema_ID] DEFAULT (newid()) NOT NULL,
    [Code]             VARCHAR (50)     NOT NULL,
    [Name]             VARCHAR (100)    NOT NULL,
    [Description]      VARCHAR (5000)   NULL,
    [DataSourceTypeID] UNIQUEIDENTIFIER NOT NULL,
    [IgnoreFirst]      INT              CONSTRAINT [DF_DataSchema_IgnoreFirst] DEFAULT ((0)) NOT NULL,
    [IgnoreLast]       INT              CONSTRAINT [DF_DataSchema_IgnoreLast] DEFAULT ((0)) NOT NULL,
    [Condition]        VARCHAR (500)    NULL,
    [DataSchema]       TEXT             NULL,
    [UserId]           UNIQUEIDENTIFIER NOT NULL,
    [Delimiter]        VARCHAR (3)      NULL,
    [SplitSelector]    VARCHAR (50)     NULL,
    [SplitIndex]       INT              NULL,
    [AddedAt]          DATETIME         CONSTRAINT [DF_DataSchema_AddedAt] DEFAULT GetDate() NULL,
    [UpdatedAt]        DATETIME         CONSTRAINT [DF_DataSchema_UpdatedAt] DEFAULT GetDate() NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_DataSchema1] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_DataSchema_Code1] UNIQUE NONCLUSTERED ([Code] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_DataSchema_Name1] UNIQUE NONCLUSTERED ([Name] ASC)
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_CX_DataSchema1]
    ON [dbo].[tmp_ms_xx_DataSchema]([AddedAt] ASC);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[DataSchema])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_DataSchema] ([ID], [Code], [Name], [Description], [DataSourceTypeID], [IgnoreFirst], [IgnoreLast], [Condition], [DataSchema], [UserId], [Delimiter], [SplitSelector], [SplitIndex])
        SELECT [ID],
               [Code],
               [Name],
               [Description],
               [DataSourceTypeID],
               [IgnoreFirst],
               [IgnoreLast],
               [Condition],
               [DataSchema],
               [UserId],
               [Delimiter],
               [SplitSelector],
               [SplitIndex]
        FROM   [dbo].[DataSchema];
    END

DROP TABLE [dbo].[DataSchema];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_DataSchema]', N'DataSchema';

EXECUTE sp_rename N'[dbo].[DataSchema].[tmp_ms_xx_index_CX_DataSchema1]', N'CX_DataSchema', N'INDEX';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_DataSchema1]', N'PK_DataSchema', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_DataSchema_Code1]', N'UX_DataSchema_Code', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_DataSchema_Name1]', N'UX_DataSchema_Name', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating [dbo].[DataSchema].[IX_DataSchema_DataSourceTypeID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataSchema_DataSourceTypeID]
    ON [dbo].[DataSchema]([DataSourceTypeID] ASC);


GO
PRINT N'Creating [dbo].[DataSchema].[IX_DataSchema_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataSchema_UserId]
    ON [dbo].[DataSchema]([UserId] ASC);


GO
PRINT N'Starting rebuilding table [dbo].[DataSourceRole]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_DataSourceRole] (
    [ID]             UNIQUEIDENTIFIER CONSTRAINT [DF_DataSourceRole_ID] DEFAULT (newid()) NOT NULL,
    [DataSourceID]   UNIQUEIDENTIFIER NOT NULL,
    [RoleId]         UNIQUEIDENTIFIER NOT NULL,
    [DateStart]      DATETIME         NULL,
    [DateEnd]        DATETIME         NULL,
    [RoleName]       VARCHAR (256)    NULL,
    [IsRoleReadOnly] BIT              NULL,
    [UserId]         UNIQUEIDENTIFIER NULL,
    [AddedAt]        DATETIME         CONSTRAINT [DF_DataSourceRole_AddedAt] DEFAULT GetDate() NULL,
    [UpdatedAt]      DATETIME         CONSTRAINT [DF_DataSourceRole_UpdatedAt] DEFAULT GetDate() NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_DataSourceRole1] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_DataSourceRole1] UNIQUE NONCLUSTERED ([DataSourceID] ASC, [RoleId] ASC, [DateStart] ASC, [DateEnd] ASC)
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_CX_DataSourceRole1]
    ON [dbo].[tmp_ms_xx_DataSourceRole]([AddedAt] ASC);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[DataSourceRole])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_DataSourceRole] ([ID], [DataSourceID], [RoleId], [DateStart], [DateEnd], [RoleName], [IsRoleReadOnly], [UserId])
        SELECT [ID],
               [DataSourceID],
               [RoleId],
               [DateStart],
               [DateEnd],
               [RoleName],
               [IsRoleReadOnly],
               [UserId]
        FROM   [dbo].[DataSourceRole];
    END

DROP TABLE [dbo].[DataSourceRole];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_DataSourceRole]', N'DataSourceRole';

EXECUTE sp_rename N'[dbo].[DataSourceRole].[tmp_ms_xx_index_CX_DataSourceRole1]', N'CX_DataSourceRole', N'INDEX';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_DataSourceRole1]', N'PK_DataSourceRole', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_DataSourceRole1]', N'UX_DataSourceRole', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating [dbo].[DataSourceRole].[IX_DataSourceRole_DataSourceID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataSourceRole_DataSourceID]
    ON [dbo].[DataSourceRole]([DataSourceID] ASC);


GO
PRINT N'Creating [dbo].[DataSourceRole].[IX_DataSourceRole_RoleId]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataSourceRole_RoleId]
    ON [dbo].[DataSourceRole]([RoleId] ASC);


GO
PRINT N'Creating [dbo].[DataSourceRole].[IX_DataSourceRole_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataSourceRole_UserId]
    ON [dbo].[DataSourceRole]([UserId] ASC);


GO
PRINT N'Starting rebuilding table [dbo].[DataSourceTransformation]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_DataSourceTransformation] (
    [ID]                      UNIQUEIDENTIFIER CONSTRAINT [DF_DataSourceTransformation_ID] DEFAULT (newid()) NOT NULL,
    [TransformationTypeID]    UNIQUEIDENTIFIER NOT NULL,
    [PhenomenonID]            UNIQUEIDENTIFIER NOT NULL,
    [PhenomenonOfferingID]    UNIQUEIDENTIFIER NULL,
    [PhenomenonUOMID]         UNIQUEIDENTIFIER NULL,
    [StartDate]               DATETIME         NOT NULL,
    [EndDate]                 DATETIME         NULL,
    [DataSourceID]            UNIQUEIDENTIFIER NOT NULL,
    [Definition]              TEXT             NOT NULL,
    [NewPhenomenonOfferingID] UNIQUEIDENTIFIER NULL,
    [NewPhenomenonUOMID]      UNIQUEIDENTIFIER NULL,
    [Rank]                    INT              CONSTRAINT [DF_DataSourceTransformation_Rank] DEFAULT ((0)) NULL,
    [SensorID]                UNIQUEIDENTIFIER NULL,
    [UserId]                  UNIQUEIDENTIFIER NULL,
    [AddedAt]                 DATETIME         CONSTRAINT [DF_DataSourceTransformation_AddedAt] DEFAULT GetDate() NULL,
    [UpdatedAt]               DATETIME         CONSTRAINT [DF_DataSourceTransformation_UpdatedAt] DEFAULT GetDate() NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_DataSourceTransformation1] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_DataSourceTransformation1] UNIQUE NONCLUSTERED ([DataSourceID] ASC, [SensorID] ASC, [Rank] ASC, [TransformationTypeID] ASC, [PhenomenonID] ASC, [PhenomenonOfferingID] ASC, [PhenomenonUOMID] ASC, [NewPhenomenonOfferingID] ASC, [NewPhenomenonUOMID] ASC, [StartDate] ASC, [EndDate] ASC)
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_CX_DataSourceTransformation1]
    ON [dbo].[tmp_ms_xx_DataSourceTransformation]([AddedAt] ASC);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[DataSourceTransformation])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_DataSourceTransformation] ([ID], [TransformationTypeID], [PhenomenonID], [PhenomenonOfferingID], [PhenomenonUOMID], [StartDate], [EndDate], [DataSourceID], [Definition], [NewPhenomenonOfferingID], [NewPhenomenonUOMID], [Rank], [SensorID], [UserId])
        SELECT [ID],
               [TransformationTypeID],
               [PhenomenonID],
               [PhenomenonOfferingID],
               [PhenomenonUOMID],
               [StartDate],
               [EndDate],
               [DataSourceID],
               [Definition],
               [NewPhenomenonOfferingID],
               [NewPhenomenonUOMID],
               [Rank],
               [SensorID],
               [UserId]
        FROM   [dbo].[DataSourceTransformation];
    END

DROP TABLE [dbo].[DataSourceTransformation];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_DataSourceTransformation]', N'DataSourceTransformation';

EXECUTE sp_rename N'[dbo].[DataSourceTransformation].[tmp_ms_xx_index_CX_DataSourceTransformation1]', N'CX_DataSourceTransformation', N'INDEX';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_DataSourceTransformation1]', N'PK_DataSourceTransformation', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_DataSourceTransformation1]', N'UX_DataSourceTransformation', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating [dbo].[DataSourceTransformation].[IX_DataSourceTransformation_DataSourceID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataSourceTransformation_DataSourceID]
    ON [dbo].[DataSourceTransformation]([DataSourceID] ASC);


GO
PRINT N'Creating [dbo].[DataSourceTransformation].[IX_DataSourceTransformation_TransformationTypeID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataSourceTransformation_TransformationTypeID]
    ON [dbo].[DataSourceTransformation]([TransformationTypeID] ASC);


GO
PRINT N'Creating [dbo].[DataSourceTransformation].[IX_DataSourceTransformation_PhenomenonID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataSourceTransformation_PhenomenonID]
    ON [dbo].[DataSourceTransformation]([PhenomenonID] ASC);


GO
PRINT N'Creating [dbo].[DataSourceTransformation].[IX_DataSourceTransformation_PhenomenonOfferingID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataSourceTransformation_PhenomenonOfferingID]
    ON [dbo].[DataSourceTransformation]([PhenomenonOfferingID] ASC);


GO
PRINT N'Creating [dbo].[DataSourceTransformation].[IX_DataSourceTransformation_PhenomenonUOMID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataSourceTransformation_PhenomenonUOMID]
    ON [dbo].[DataSourceTransformation]([PhenomenonUOMID] ASC);


GO
PRINT N'Creating [dbo].[DataSourceTransformation].[IX_DataSourceTransformation_NewPhenomenonOfferingID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataSourceTransformation_NewPhenomenonOfferingID]
    ON [dbo].[DataSourceTransformation]([NewPhenomenonOfferingID] ASC);


GO
PRINT N'Creating [dbo].[DataSourceTransformation].[IX_DataSourceTransformation_NewPhenomenonUOMID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataSourceTransformation_NewPhenomenonUOMID]
    ON [dbo].[DataSourceTransformation]([NewPhenomenonUOMID] ASC);


GO
PRINT N'Creating [dbo].[DataSourceTransformation].[IX_DataSourceTransformation_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataSourceTransformation_UserId]
    ON [dbo].[DataSourceTransformation]([UserId] ASC);


GO
PRINT N'Creating [dbo].[DataSourceTransformation].[IX_DataSourceTransformation_SensorID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataSourceTransformation_SensorID]
    ON [dbo].[DataSourceTransformation]([SensorID] ASC);


GO
PRINT N'Creating [dbo].[DataSourceTransformation].[IX_DataSourceTransformation_Rank]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataSourceTransformation_Rank]
    ON [dbo].[DataSourceTransformation]([DataSourceID] ASC, [Rank] ASC);


GO
PRINT N'Creating [dbo].[DataSourceTransformation].[IX_DataSourceTransformation_StartDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataSourceTransformation_StartDate]
    ON [dbo].[DataSourceTransformation]([DataSourceID] ASC, [StartDate] ASC);


GO
PRINT N'Creating [dbo].[DataSourceTransformation].[IX_DataSourceTransformation_EndDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataSourceTransformation_EndDate]
    ON [dbo].[DataSourceTransformation]([DataSourceID] ASC, [EndDate] ASC);


GO
PRINT N'Starting rebuilding table [dbo].[DataSourceType]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_DataSourceType] (
    [ID]          UNIQUEIDENTIFIER CONSTRAINT [DF_DataSourceType_ID] DEFAULT (newid()) NOT NULL,
    [Code]        VARCHAR (50)     NOT NULL,
    [Description] VARCHAR (500)    NOT NULL,
    [UserId]      UNIQUEIDENTIFIER NULL,
    [AddedAt]     DATETIME         CONSTRAINT [DF_DataSourceType_AddedAt] DEFAULT GetDate() NULL,
    [UpdatedAt]   DATETIME         CONSTRAINT [DF_DataSourceType_UpdatedAt] DEFAULT GetDate() NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_DataSourceType1] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_DataSourceType_Code1] UNIQUE NONCLUSTERED ([Code] ASC)
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_CX_DataSourceType1]
    ON [dbo].[tmp_ms_xx_DataSourceType]([AddedAt] ASC);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[DataSourceType])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_DataSourceType] ([ID], [Code], [Description], [UserId])
        SELECT [ID],
               [Code],
               [Description],
               [UserId]
        FROM   [dbo].[DataSourceType];
    END

DROP TABLE [dbo].[DataSourceType];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_DataSourceType]', N'DataSourceType';

EXECUTE sp_rename N'[dbo].[DataSourceType].[tmp_ms_xx_index_CX_DataSourceType1]', N'CX_DataSourceType', N'INDEX';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_DataSourceType1]', N'PK_DataSourceType', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_DataSourceType_Code1]', N'UX_DataSourceType_Code', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating [dbo].[DataSourceType].[IX_DataSourceType_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataSourceType_UserId]
    ON [dbo].[DataSourceType]([UserId] ASC);


GO
PRINT N'Starting rebuilding table [dbo].[ImportBatch]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_ImportBatch] (
    [ID]             UNIQUEIDENTIFIER CONSTRAINT [DF_ImportBatch_ID] DEFAULT newid() NOT NULL,
    [Code]           INT              IDENTITY (1, 1) NOT NULL,
    [DataSourceID]   UNIQUEIDENTIFIER NOT NULL,
    [ImportDate]     DATETIME         CONSTRAINT [DF_ImportBatch_ImportDate] DEFAULT getdate() NOT NULL,
    [Status]         INT              NOT NULL,
    [UserId]         UNIQUEIDENTIFIER NOT NULL,
    [FileName]       VARCHAR (250)    NULL,
    [LogFileName]    VARCHAR (250)    NULL,
    [Comment]        VARCHAR (8000)   NULL,
    [StatusID]       UNIQUEIDENTIFIER NULL,
    [StatusReasonID] UNIQUEIDENTIFIER NULL,
    [AddedAt]        DATETIME         CONSTRAINT [DF_ImportBatch_AddedAt] DEFAULT GetDate() NULL,
    [UpdatedAt]      DATETIME         CONSTRAINT [DF_ImportBatch_UpdatedAt] DEFAULT GetDate() NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_ImportBatch1] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_ImportBatch_Code1] UNIQUE NONCLUSTERED ([Code] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_ImportBatch1] UNIQUE NONCLUSTERED ([DataSourceID] ASC, [ImportDate] ASC, [LogFileName] ASC)
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_CX_ImportBatch1]
    ON [dbo].[tmp_ms_xx_ImportBatch]([AddedAt] ASC);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[ImportBatch])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_ImportBatch] ([ID], [DataSourceID], [ImportDate], [Status], [UserId], [FileName], [LogFileName], [Comment])
        SELECT [ID],
               [DataSourceID],
               [ImportDate],
               [Status],
               [UserId],
               [FileName],
               [LogFileName],
               [Comment]
        FROM   [dbo].[ImportBatch];
    END

DROP TABLE [dbo].[ImportBatch];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_ImportBatch]', N'ImportBatch';

EXECUTE sp_rename N'[dbo].[ImportBatch].[tmp_ms_xx_index_CX_ImportBatch1]', N'CX_ImportBatch', N'INDEX';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_ImportBatch1]', N'PK_ImportBatch', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_ImportBatch_Code1]', N'UX_ImportBatch_Code', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_ImportBatch1]', N'UX_ImportBatch', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating [dbo].[ImportBatch].[IX_ImportBatch_DataSourceID]...';


GO
CREATE NONCLUSTERED INDEX [IX_ImportBatch_DataSourceID]
    ON [dbo].[ImportBatch]([DataSourceID] ASC);


GO
PRINT N'Creating [dbo].[ImportBatch].[IX_ImportBatch_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_ImportBatch_UserId]
    ON [dbo].[ImportBatch]([UserId] ASC);


GO
PRINT N'Creating [dbo].[ImportBatch].[IX_ImportBatch_ImportDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_ImportBatch_ImportDate]
    ON [dbo].[ImportBatch]([DataSourceID] ASC, [ImportDate] ASC);


GO
PRINT N'Creating [dbo].[ImportBatch].[IX_ImportBatch_LogFileName]...';


GO
CREATE NONCLUSTERED INDEX [IX_ImportBatch_LogFileName]
    ON [dbo].[ImportBatch]([DataSourceID] ASC, [LogFileName] ASC);


GO
PRINT N'Creating [dbo].[ImportBatch].[IX_ImportBatch_StatusID]...';


GO
CREATE NONCLUSTERED INDEX [IX_ImportBatch_StatusID]
    ON [dbo].[ImportBatch]([StatusID] ASC);


GO
PRINT N'Creating [dbo].[ImportBatch].[IX_ImportBatch_StatusReasonID]...';


GO
CREATE NONCLUSTERED INDEX [IX_ImportBatch_StatusReasonID]
    ON [dbo].[ImportBatch]([StatusReasonID] ASC);


GO
PRINT N'Starting rebuilding table [dbo].[Observation]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Observation] (
    [ID]                   UNIQUEIDENTIFIER     CONSTRAINT [DF_Observation_ID] DEFAULT newid() NOT NULL,
    [SensorID]             UNIQUEIDENTIFIER     NOT NULL,
    [ValueDate]            DATETIME             NOT NULL,
    [RawValue]             FLOAT (53)           NULL,
    [DataValue]            FLOAT (53)           NULL,
    [Comment]              VARCHAR (250) SPARSE NULL,
    [PhenomenonOfferingID] UNIQUEIDENTIFIER     NOT NULL,
    [PhenomenonUOMID]      UNIQUEIDENTIFIER     NOT NULL,
    [ImportBatchID]        UNIQUEIDENTIFIER     NOT NULL,
    [StatusID]             UNIQUEIDENTIFIER     NULL,
    [StatusReasonID]       UNIQUEIDENTIFIER     NULL,
    [UserId]               UNIQUEIDENTIFIER     NOT NULL,
    [AddedDate]            DATETIME             CONSTRAINT [DF_Observation_AddedDate] DEFAULT getdate() NOT NULL,
    [AddedAt]              DATETIME             CONSTRAINT [DF_Observation_AddedAt] DEFAULT GetDate() NULL,
    [UpdatedAt]            DATETIME             CONSTRAINT [DF_Observation_UpdatedAt] DEFAULT GetDate() NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_Observation1] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_Observation1] UNIQUE NONCLUSTERED ([SensorID] ASC, [ImportBatchID] ASC, [ValueDate] ASC, [PhenomenonOfferingID] ASC, [PhenomenonUOMID] ASC)
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_CX_Observation1]
    ON [dbo].[tmp_ms_xx_Observation]([AddedAt] ASC);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Observation])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_Observation] ([SensorID], [ValueDate], [RawValue], [DataValue], [Comment], [PhenomenonOfferingID], [PhenomenonUOMID], [UserId], [AddedDate], [ID], [ImportBatchID])
        SELECT [SensorID],
               [ValueDate],
               [RawValue],
               [DataValue],
               [Comment],
               [PhenomenonOfferingID],
               [PhenomenonUOMID],
               [UserId],
               [AddedDate],
               [ID],
               [ImportBatchID]
        FROM   [dbo].[Observation];
    END

DROP TABLE [dbo].[Observation];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Observation]', N'Observation';

EXECUTE sp_rename N'[dbo].[Observation].[tmp_ms_xx_index_CX_Observation1]', N'CX_Observation', N'INDEX';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_Observation1]', N'PK_Observation', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_Observation1]', N'UX_Observation', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating [dbo].[Observation].[IX_Observation]...';


GO
CREATE NONCLUSTERED INDEX [IX_Observation]
    ON [dbo].[Observation]([SensorID] ASC, [ValueDate] ASC, [RawValue] ASC);


GO
PRINT N'Creating [dbo].[Observation].[IX_Observation_ImportBatchID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Observation_ImportBatchID]
    ON [dbo].[Observation]([ImportBatchID] ASC);


GO
PRINT N'Creating [dbo].[Observation].[IX_Observation_SensorID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Observation_SensorID]
    ON [dbo].[Observation]([SensorID] ASC);


GO
PRINT N'Creating [dbo].[Observation].[IX_Observation_PhenomenonOfferingID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Observation_PhenomenonOfferingID]
    ON [dbo].[Observation]([PhenomenonOfferingID] ASC);


GO
PRINT N'Creating [dbo].[Observation].[IX_Observation_PhenomenonUOMID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Observation_PhenomenonUOMID]
    ON [dbo].[Observation]([PhenomenonUOMID] ASC);


GO
PRINT N'Creating [dbo].[Observation].[IX_Observation_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Observation_UserId]
    ON [dbo].[Observation]([UserId] ASC);


GO
PRINT N'Creating [dbo].[Observation].[IX_Observation_AddedDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_Observation_AddedDate]
    ON [dbo].[Observation]([SensorID] ASC, [AddedDate] ASC);


GO
PRINT N'Creating [dbo].[Observation].[IX_Observation_ValueDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_Observation_ValueDate]
    ON [dbo].[Observation]([SensorID] ASC, [ValueDate] ASC);


GO
PRINT N'Creating [dbo].[Observation].[IX_Observation_StatusID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Observation_StatusID]
    ON [dbo].[Observation]([StatusID] ASC);


GO
PRINT N'Creating [dbo].[Observation].[IX_Observation_StatusReasonID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Observation_StatusReasonID]
    ON [dbo].[Observation]([StatusReasonID] ASC);


GO
PRINT N'Creating [dbo].[Observation].[IX_Observation_Comment]...';


GO
CREATE NONCLUSTERED INDEX [IX_Observation_Comment]
    ON [dbo].[Observation]([Comment] ASC) WHERE Comment is not null;


GO
PRINT N'Creating [dbo].[Observation].[IX_Observation_Comment_Null]...';


GO
CREATE NONCLUSTERED INDEX [IX_Observation_Comment_Null]
    ON [dbo].[Observation]([Comment] ASC) WHERE Comment is null;


GO
PRINT N'Starting rebuilding table [dbo].[Offering]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Offering] (
    [ID]          UNIQUEIDENTIFIER CONSTRAINT [DF_Offering_ID] DEFAULT (newid()) NOT NULL,
    [Code]        VARCHAR (50)     NOT NULL,
    [Name]        VARCHAR (150)    NOT NULL,
    [Description] VARCHAR (5000)   NULL,
    [UserId]      UNIQUEIDENTIFIER NOT NULL,
    [AddedAt]     DATETIME         CONSTRAINT [DF_Offering_AddedAt] DEFAULT GetDate() NULL,
    [UpdatedAt]   DATETIME         CONSTRAINT [DF_Offering_UpdatedAt] DEFAULT GetDate() NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_Offering1] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_Offering_Name1] UNIQUE NONCLUSTERED ([Name] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_Offering_Code1] UNIQUE NONCLUSTERED ([Code] ASC)
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_CX_Offering1]
    ON [dbo].[tmp_ms_xx_Offering]([AddedAt] ASC);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Offering])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_Offering] ([ID], [Code], [Name], [Description], [UserId])
        SELECT [ID],
               [Code],
               [Name],
               [Description],
               [UserId]
        FROM   [dbo].[Offering];
    END

DROP TABLE [dbo].[Offering];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Offering]', N'Offering';

EXECUTE sp_rename N'[dbo].[Offering].[tmp_ms_xx_index_CX_Offering1]', N'CX_Offering', N'INDEX';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_Offering1]', N'PK_Offering', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_Offering_Name1]', N'UX_Offering_Name', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_Offering_Code1]', N'UX_Offering_Code', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating [dbo].[Offering].[IX_Offering_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Offering_UserId]
    ON [dbo].[Offering]([UserId] ASC);


GO
PRINT N'Starting rebuilding table [dbo].[OrganisationRole]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_OrganisationRole] (
    [ID]          UNIQUEIDENTIFIER CONSTRAINT [DF_OrganisationRole_ID] DEFAULT newid() NOT NULL,
    [Code]        VARCHAR (50)     NOT NULL,
    [Name]        VARCHAR (150)    NOT NULL,
    [Description] VARCHAR (5000)   NULL,
    [UserId]      UNIQUEIDENTIFIER NOT NULL,
    [AddedAt]     DATETIME         CONSTRAINT [DF_OrganisationRole_AddedAt] DEFAULT GetDate() NULL,
    [UpdatedAt]   DATETIME         CONSTRAINT [DF_OrganisationRole_UpdatedAt] DEFAULT GetDate() NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_OrganisationRole1] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_OrganisationRole_Code1] UNIQUE NONCLUSTERED ([Code] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_OrganisationRole_Name1] UNIQUE NONCLUSTERED ([Name] ASC)
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_CX_OrganisationRole1]
    ON [dbo].[tmp_ms_xx_OrganisationRole]([AddedAt] ASC);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[OrganisationRole])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_OrganisationRole] ([ID], [Code], [Name], [Description], [UserId])
        SELECT [ID],
               [Code],
               [Name],
               [Description],
               [UserId]
        FROM   [dbo].[OrganisationRole];
    END

DROP TABLE [dbo].[OrganisationRole];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_OrganisationRole]', N'OrganisationRole';

EXECUTE sp_rename N'[dbo].[OrganisationRole].[tmp_ms_xx_index_CX_OrganisationRole1]', N'CX_OrganisationRole', N'INDEX';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_OrganisationRole1]', N'PK_OrganisationRole', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_OrganisationRole_Code1]', N'UX_OrganisationRole_Code', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_OrganisationRole_Name1]', N'UX_OrganisationRole_Name', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[OrganisationRole].[IX_OrganisationRole_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_OrganisationRole_UserId]
    ON [dbo].[OrganisationRole]([UserId] ASC);


GO
PRINT N'Starting rebuilding table [dbo].[Phenomenon]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Phenomenon] (
    [ID]          UNIQUEIDENTIFIER CONSTRAINT [DF_Phenomenon_ID] DEFAULT (newid()) NOT NULL,
    [Code]        VARCHAR (50)     NOT NULL,
    [Name]        VARCHAR (150)    NOT NULL,
    [Description] VARCHAR (5000)   NULL,
    [Url]         VARCHAR (250)    NULL,
    [UserId]      UNIQUEIDENTIFIER NOT NULL,
    [AddedAt]     DATETIME         CONSTRAINT [DF_Phenomenon_AddedAt] DEFAULT GetDate() NULL,
    [UpdatedAt]   DATETIME         CONSTRAINT [DF_Phenomenon_UpdatedAt] DEFAULT GetDate() NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_Phenomenon1] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_Phenomenon_Code1] UNIQUE NONCLUSTERED ([Code] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_Phenomenon_Name1] UNIQUE NONCLUSTERED ([Name] ASC)
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_CX_Phenomenon1]
    ON [dbo].[tmp_ms_xx_Phenomenon]([AddedAt] ASC);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Phenomenon])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_Phenomenon] ([ID], [Code], [Name], [Description], [Url], [UserId])
        SELECT [ID],
               [Code],
               [Name],
               [Description],
               [Url],
               [UserId]
        FROM   [dbo].[Phenomenon];
    END

DROP TABLE [dbo].[Phenomenon];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Phenomenon]', N'Phenomenon';

EXECUTE sp_rename N'[dbo].[Phenomenon].[tmp_ms_xx_index_CX_Phenomenon1]', N'CX_Phenomenon', N'INDEX';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_Phenomenon1]', N'PK_Phenomenon', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_Phenomenon_Code1]', N'UX_Phenomenon_Code', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_Phenomenon_Name1]', N'UX_Phenomenon_Name', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating [dbo].[Phenomenon].[IX_Phenomenon_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Phenomenon_UserId]
    ON [dbo].[Phenomenon]([UserId] ASC);


GO
PRINT N'Starting rebuilding table [dbo].[PhenomenonOffering]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_PhenomenonOffering] (
    [ID]           UNIQUEIDENTIFIER CONSTRAINT [DF_PhenomenonOffering_ID] DEFAULT (newid()) NOT NULL,
    [PhenomenonID] UNIQUEIDENTIFIER NOT NULL,
    [OfferingID]   UNIQUEIDENTIFIER NOT NULL,
    [UserId]       UNIQUEIDENTIFIER NULL,
    [AddedAt]      DATETIME         CONSTRAINT [DF_PhenomenonOffering_AddedAt] DEFAULT GetDate() NULL,
    [UpdatedAt]    DATETIME         CONSTRAINT [DF_PhenomenonOffering_UpdatedAt] DEFAULT GetDate() NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_PhenomenonOffering1] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_PhenomenonOffering1] UNIQUE NONCLUSTERED ([PhenomenonID] ASC, [OfferingID] ASC)
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_CX_PhenomenonOffering1]
    ON [dbo].[tmp_ms_xx_PhenomenonOffering]([AddedAt] ASC);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[PhenomenonOffering])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_PhenomenonOffering] ([ID], [PhenomenonID], [OfferingID], [UserId])
        SELECT [ID],
               [PhenomenonID],
               [OfferingID],
               [UserId]
        FROM   [dbo].[PhenomenonOffering];
    END

DROP TABLE [dbo].[PhenomenonOffering];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_PhenomenonOffering]', N'PhenomenonOffering';

EXECUTE sp_rename N'[dbo].[PhenomenonOffering].[tmp_ms_xx_index_CX_PhenomenonOffering1]', N'CX_PhenomenonOffering', N'INDEX';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_PhenomenonOffering1]', N'PK_PhenomenonOffering', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_PhenomenonOffering1]', N'UX_PhenomenonOffering', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating [dbo].[PhenomenonOffering].[IX_PhenomenonOffering_PhenomenonID]...';


GO
CREATE NONCLUSTERED INDEX [IX_PhenomenonOffering_PhenomenonID]
    ON [dbo].[PhenomenonOffering]([PhenomenonID] ASC);


GO
PRINT N'Creating [dbo].[PhenomenonOffering].[IX_PhenomenonOffering_OfferingID]...';


GO
CREATE NONCLUSTERED INDEX [IX_PhenomenonOffering_OfferingID]
    ON [dbo].[PhenomenonOffering]([OfferingID] ASC);


GO
PRINT N'Creating [dbo].[PhenomenonOffering].[IX_PhenomenonOffering_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_PhenomenonOffering_UserId]
    ON [dbo].[PhenomenonOffering]([UserId] ASC);


GO
PRINT N'Starting rebuilding table [dbo].[PhenomenonUOM]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_PhenomenonUOM] (
    [ID]              UNIQUEIDENTIFIER CONSTRAINT [DF_PhenomenonUOM_ID] DEFAULT (newid()) NOT NULL,
    [PhenomenonID]    UNIQUEIDENTIFIER NOT NULL,
    [UnitOfMeasureID] UNIQUEIDENTIFIER NOT NULL,
    [IsDefault]       BIT              CONSTRAINT [DF_PhenomenonUOM_IsDefault] DEFAULT ((0)) NOT NULL,
    [UserId]          UNIQUEIDENTIFIER NULL,
    [AddedAt]         DATETIME         CONSTRAINT [DF_PhenomenonUOM_AddedAt] DEFAULT GetDate() NULL,
    [UpdatedAt]       DATETIME         CONSTRAINT [DF_PhenomenonUOM_UpdatedAt] DEFAULT GetDate() NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_PhenomenonUOM1] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_PhenomenonUOM1] UNIQUE NONCLUSTERED ([PhenomenonID] ASC, [UnitOfMeasureID] ASC)
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_CX_PhenomenonUOM1]
    ON [dbo].[tmp_ms_xx_PhenomenonUOM]([AddedAt] ASC);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[PhenomenonUOM])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_PhenomenonUOM] ([ID], [PhenomenonID], [UnitOfMeasureID], [IsDefault], [UserId])
        SELECT [ID],
               [PhenomenonID],
               [UnitOfMeasureID],
               [IsDefault],
               [UserId]
        FROM   [dbo].[PhenomenonUOM];
    END

DROP TABLE [dbo].[PhenomenonUOM];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_PhenomenonUOM]', N'PhenomenonUOM';

EXECUTE sp_rename N'[dbo].[PhenomenonUOM].[tmp_ms_xx_index_CX_PhenomenonUOM1]', N'CX_PhenomenonUOM', N'INDEX';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_PhenomenonUOM1]', N'PK_PhenomenonUOM', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_PhenomenonUOM1]', N'UX_PhenomenonUOM', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating [dbo].[PhenomenonUOM].[IX_PhenomenonUOM_PhenomenonID]...';


GO
CREATE NONCLUSTERED INDEX [IX_PhenomenonUOM_PhenomenonID]
    ON [dbo].[PhenomenonUOM]([PhenomenonID] ASC);


GO
PRINT N'Creating [dbo].[PhenomenonUOM].[IX_PhenomenonUOM_UnitOfMeasureID]...';


GO
CREATE NONCLUSTERED INDEX [IX_PhenomenonUOM_UnitOfMeasureID]
    ON [dbo].[PhenomenonUOM]([UnitOfMeasureID] ASC);


GO
PRINT N'Creating [dbo].[PhenomenonUOM].[IX_PhenomenonUOM_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_PhenomenonUOM_UserId]
    ON [dbo].[PhenomenonUOM]([UserId] ASC);


GO
PRINT N'Starting rebuilding table [dbo].[Sensor]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Sensor] (
    [ID]           UNIQUEIDENTIFIER CONSTRAINT [DF_Sensor_ID] DEFAULT (newid()) NOT NULL,
    [Code]         VARCHAR (50)     NOT NULL,
    [Name]         VARCHAR (150)    NOT NULL,
    [Description]  VARCHAR (5000)   NULL,
    [Url]          VARCHAR (250)    NULL,
    [StationID]    UNIQUEIDENTIFIER NOT NULL,
    [PhenomenonID] UNIQUEIDENTIFIER NOT NULL,
    [DataSourceID] UNIQUEIDENTIFIER NOT NULL,
    [DataSchemaID] UNIQUEIDENTIFIER NULL,
    [UserId]       UNIQUEIDENTIFIER NOT NULL,
    [AddedAt]      DATETIME         CONSTRAINT [DF_Sensor_AddedAt] DEFAULT GetDate() NULL,
    [UpdatedAt]    DATETIME         CONSTRAINT [DF_Sensor_UpdatedAt] DEFAULT GetDate() NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_Sensor1] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_Sensor_Code1] UNIQUE NONCLUSTERED ([Code] ASC)
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_CX_Sensor1]
    ON [dbo].[tmp_ms_xx_Sensor]([AddedAt] ASC);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Sensor])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_Sensor] ([ID], [Code], [Name], [Description], [Url], [StationID], [PhenomenonID], [DataSourceID], [DataSchemaID], [UserId])
        SELECT [ID],
               [Code],
               [Name],
               [Description],
               [Url],
               [StationID],
               [PhenomenonID],
               [DataSourceID],
               [DataSchemaID],
               [UserId]
        FROM   [dbo].[Sensor];
    END

DROP TABLE [dbo].[Sensor];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Sensor]', N'Sensor';

EXECUTE sp_rename N'[dbo].[Sensor].[tmp_ms_xx_index_CX_Sensor1]', N'CX_Sensor', N'INDEX';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_Sensor1]', N'PK_Sensor', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_Sensor_Code1]', N'UX_Sensor_Code', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating [dbo].[Sensor].[IX_Sensor_StationID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Sensor_StationID]
    ON [dbo].[Sensor]([StationID] ASC);


GO
PRINT N'Creating [dbo].[Sensor].[IX_Sensor_PhenomenonID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Sensor_PhenomenonID]
    ON [dbo].[Sensor]([PhenomenonID] ASC);


GO
PRINT N'Creating [dbo].[Sensor].[IX_Sensor_DataSourceID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Sensor_DataSourceID]
    ON [dbo].[Sensor]([DataSourceID] ASC);


GO
PRINT N'Creating [dbo].[Sensor].[IX_Sensor_DataSchemaID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Sensor_DataSchemaID]
    ON [dbo].[Sensor]([DataSchemaID] ASC);


GO
PRINT N'Creating [dbo].[Sensor].[IX_Sensor_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Sensor_UserId]
    ON [dbo].[Sensor]([UserId] ASC);


GO
PRINT N'Starting rebuilding table [dbo].[Status]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Status] (
    [ID]          UNIQUEIDENTIFIER CONSTRAINT [DF_Status_ID] DEFAULT (newid()) NOT NULL,
    [Code]        VARCHAR (50)     NOT NULL,
    [Name]        VARCHAR (150)    NOT NULL,
    [Description] VARCHAR (500)    NOT NULL,
    [UserId]      UNIQUEIDENTIFIER NULL,
    [AddedAt]     DATETIME         CONSTRAINT [DF_Status_AddedAt] DEFAULT GetDate() NULL,
    [UpdatedAt]   DATETIME         CONSTRAINT [DF_Status_UpdatedAt] DEFAULT GetDate() NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_Status1] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_Status_Code1] UNIQUE NONCLUSTERED ([Code] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_Status_Name1] UNIQUE NONCLUSTERED ([Name] ASC)
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_CX_Status1]
    ON [dbo].[tmp_ms_xx_Status]([AddedAt] ASC);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Status])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_Status] ([ID], [Code], [Name], [Description], [UserId])
        SELECT [ID],
               [Code],
               [Name],
               [Description],
               [UserId]
        FROM   [dbo].[Status];
    END

DROP TABLE [dbo].[Status];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Status]', N'Status';

EXECUTE sp_rename N'[dbo].[Status].[tmp_ms_xx_index_CX_Status1]', N'CX_Status', N'INDEX';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_Status1]', N'PK_Status', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_Status_Code1]', N'UX_Status_Code', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_Status_Name1]', N'UX_Status_Name', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating [dbo].[Status].[IX_Status_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Status_UserId]
    ON [dbo].[Status]([UserId] ASC);


GO
PRINT N'Starting rebuilding table [dbo].[TransformationType]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_TransformationType] (
    [ID]          UNIQUEIDENTIFIER CONSTRAINT [DF_TransformationType_ID] DEFAULT (newid()) NOT NULL,
    [Code]        VARCHAR (50)     NOT NULL,
    [Name]        VARCHAR (150)    NOT NULL,
    [Description] VARCHAR (500)    NOT NULL,
    [iorder]      INT              NULL,
    [UserId]      UNIQUEIDENTIFIER NULL,
    [AddedAt]     DATETIME         CONSTRAINT [DF_TransformationType_AddedAt] DEFAULT GetDate() NULL,
    [UpdatedAt]   DATETIME         CONSTRAINT [DF_TransformationType_UpdatedAt] DEFAULT GetDate() NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_TransformationType1] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_TransformationType_Code1] UNIQUE NONCLUSTERED ([Code] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_TransformationType_Name1] UNIQUE NONCLUSTERED ([Name] ASC)
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_CX_TransformationType1]
    ON [dbo].[tmp_ms_xx_TransformationType]([AddedAt] ASC);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[TransformationType])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_TransformationType] ([ID], [Code], [Name], [Description], [iorder], [UserId])
        SELECT [ID],
               [Code],
               [Name],
               [Description],
               [iorder],
               [UserId]
        FROM   [dbo].[TransformationType];
    END

DROP TABLE [dbo].[TransformationType];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_TransformationType]', N'TransformationType';

EXECUTE sp_rename N'[dbo].[TransformationType].[tmp_ms_xx_index_CX_TransformationType1]', N'CX_TransformationType', N'INDEX';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_TransformationType1]', N'PK_TransformationType', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_TransformationType_Code1]', N'UX_TransformationType_Code', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_TransformationType_Name1]', N'UX_TransformationType_Name', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating [dbo].[TransformationType].[IX_TransformationType_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_TransformationType_UserId]
    ON [dbo].[TransformationType]([UserId] ASC);


GO
PRINT N'Starting rebuilding table [dbo].[UnitOfMeasure]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_UnitOfMeasure] (
    [ID]         UNIQUEIDENTIFIER CONSTRAINT [DF_UnitOfMeasure_ID] DEFAULT (newid()) NOT NULL,
    [Code]       VARCHAR (50)     NOT NULL,
    [Unit]       VARCHAR (100)    NOT NULL,
    [UnitSymbol] VARCHAR (20)     NOT NULL,
    [UserId]     UNIQUEIDENTIFIER NOT NULL,
    [AddedAt]    DATETIME         CONSTRAINT [DF_UnitOfMeasure_AddedAt] DEFAULT GetDate() NULL,
    [UpdatedAt]  DATETIME         CONSTRAINT [DF_UnitOfMeasure_UpdatedAt] DEFAULT GetDate() NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_UnitOfMeasure1] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_UnitOfMeasure_Code1] UNIQUE NONCLUSTERED ([Code] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_UnitOfMeasure_Unit1] UNIQUE NONCLUSTERED ([Unit] ASC)
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_CX_UnitOfMeasure1]
    ON [dbo].[tmp_ms_xx_UnitOfMeasure]([AddedAt] ASC);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[UnitOfMeasure])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_UnitOfMeasure] ([ID], [Code], [Unit], [UnitSymbol], [UserId])
        SELECT [ID],
               [Code],
               [Unit],
               [UnitSymbol],
               [UserId]
        FROM   [dbo].[UnitOfMeasure];
    END

DROP TABLE [dbo].[UnitOfMeasure];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_UnitOfMeasure]', N'UnitOfMeasure';

EXECUTE sp_rename N'[dbo].[UnitOfMeasure].[tmp_ms_xx_index_CX_UnitOfMeasure1]', N'CX_UnitOfMeasure', N'INDEX';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_UnitOfMeasure1]', N'PK_UnitOfMeasure', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_UnitOfMeasure_Code1]', N'UX_UnitOfMeasure_Code', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_UnitOfMeasure_Unit1]', N'UX_UnitOfMeasure_Unit', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating [dbo].[UnitOfMeasure].[IX_UnitOfMeasure_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_UnitOfMeasure_UserId]
    ON [dbo].[UnitOfMeasure]([UserId] ASC);


GO
PRINT N'Starting rebuilding table [dbo].[DataSource]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_DataSource] (
    [ID]               UNIQUEIDENTIFIER CONSTRAINT [DF_DataSource_ID] DEFAULT (newid()) NOT NULL,
    [Code]             VARCHAR (50)     NOT NULL,
    [Name]             VARCHAR (150)    NOT NULL,
    [Description]      VARCHAR (5000)   NULL,
    [Url]              VARCHAR (250)    NOT NULL,
    [DefaultNullValue] FLOAT (53)       NULL,
    [ErrorEstimate]    FLOAT (53)       NULL,
    [UpdateFreq]       INT              NOT NULL,
    [StartDate]        DATETIME         NULL,
    [EndDate]          DATETIME         NULL,
    [LastUpdate]       DATETIME         NOT NULL,
    [DataSchemaID]     UNIQUEIDENTIFIER NULL,
    [UserId]           UNIQUEIDENTIFIER NOT NULL,
    [AddedAt]          DATETIME         CONSTRAINT [DF_DataSource_AddedAt] DEFAULT GetDate() NULL,
    [UpdatedAt]        DATETIME         CONSTRAINT [DF_DataSource_UpdatedAt] DEFAULT GetDate() NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_DataSource1] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_DataSource_Code1] UNIQUE NONCLUSTERED ([Code] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_DataSource_Name1] UNIQUE NONCLUSTERED ([Name] ASC)
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_CX_DataSource1]
    ON [dbo].[tmp_ms_xx_DataSource]([AddedAt] ASC);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[DataSource])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_DataSource] ([AddedAt], [ID], [Code], [Name], [Description], [Url], [DefaultNullValue], [ErrorEstimate], [UpdateFreq], [StartDate], [EndDate], [LastUpdate], [DataSchemaID], [UserId], [UpdatedAt])
        SELECT   [AddedAt],
                 [ID],
                 [Code],
                 [Name],
                 [Description],
                 [Url],
                 [DefaultNullValue],
                 [ErrorEstimate],
                 [UpdateFreq],
                 [StartDate],
                 [EndDate],
                 [LastUpdate],
                 [DataSchemaID],
                 [UserId],
                 [UpdatedAt]
        FROM     [dbo].[DataSource]
        ORDER BY [AddedAt] ASC;
    END

DROP TABLE [dbo].[DataSource];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_DataSource]', N'DataSource';

EXECUTE sp_rename N'[dbo].[DataSource].[tmp_ms_xx_index_CX_DataSource1]', N'CX_DataSource', N'INDEX';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_DataSource1]', N'PK_DataSource', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_DataSource_Code1]', N'UX_DataSource_Code', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_DataSource_Name1]', N'UX_DataSource_Name', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating [dbo].[DataSource].[IX_DataSource_DataSchemaID]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataSource_DataSchemaID]
    ON [dbo].[DataSource]([DataSchemaID] ASC);


GO
PRINT N'Creating [dbo].[DataSource].[IX_DataSource_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataSource_UserId]
    ON [dbo].[DataSource]([UserId] ASC);


GO
PRINT N'Creating [dbo].[DataSource].[IX_DataSource_StartDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataSource_StartDate]
    ON [dbo].[DataSource]([StartDate] ASC);


GO
PRINT N'Creating [dbo].[DataSource].[IX_DataSource_EndDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_DataSource_EndDate]
    ON [dbo].[DataSource]([EndDate] ASC);


GO
PRINT N'Starting rebuilding table [dbo].[Instrument]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Instrument] (
    [ID]          UNIQUEIDENTIFIER CONSTRAINT [DF_Instrument_ID] DEFAULT newid() NOT NULL,
    [Code]        VARCHAR (50)     NOT NULL,
    [Name]        VARCHAR (150)    NOT NULL,
    [Description] VARCHAR (5000)   NULL,
    [Url]         VARCHAR (250)    NULL,
    [StartDate]   DATETIME         NULL,
    [EndDate]     DATETIME         NULL,
    [UserId]      UNIQUEIDENTIFIER NOT NULL,
    [AddedAt]     DATETIME         CONSTRAINT [DF_Instrument_AddedAt] DEFAULT GetDate() NULL,
    [UpdatedAt]   DATETIME         CONSTRAINT [DF_Instrument_UpdatedAt] DEFAULT GetDate() NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_Instrument1] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_Instrument_Code1] UNIQUE NONCLUSTERED ([Code] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_Instrument_Name1] UNIQUE NONCLUSTERED ([Name] ASC)
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_CX_Instrument1]
    ON [dbo].[tmp_ms_xx_Instrument]([AddedAt] ASC);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Instrument])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_Instrument] ([AddedAt], [ID], [Code], [Name], [Description], [Url], [StartDate], [EndDate], [UserId], [UpdatedAt])
        SELECT   [AddedAt],
                 [ID],
                 [Code],
                 [Name],
                 [Description],
                 [Url],
                 [StartDate],
                 [EndDate],
                 [UserId],
                 [UpdatedAt]
        FROM     [dbo].[Instrument]
        ORDER BY [AddedAt] ASC;
    END

DROP TABLE [dbo].[Instrument];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Instrument]', N'Instrument';

EXECUTE sp_rename N'[dbo].[Instrument].[tmp_ms_xx_index_CX_Instrument1]', N'CX_Instrument', N'INDEX';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_Instrument1]', N'PK_Instrument', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_Instrument_Code1]', N'UX_Instrument_Code', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_Instrument_Name1]', N'UX_Instrument_Name', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[Instrument].[IX_Instrument_StartDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_Instrument_StartDate]
    ON [dbo].[Instrument]([StartDate] ASC);


GO
PRINT N'Creating [dbo].[Instrument].[IX_Instrument_EndDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_Instrument_EndDate]
    ON [dbo].[Instrument]([EndDate] ASC);


GO
PRINT N'Creating [dbo].[Instrument].[IX_Instrument_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Instrument_UserId]
    ON [dbo].[Instrument]([UserId] ASC);


GO
PRINT N'Starting rebuilding table [dbo].[Site]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Site] (
    [ID]          UNIQUEIDENTIFIER CONSTRAINT [DF_Site_ID] DEFAULT newid() NOT NULL,
    [Code]        VARCHAR (50)     NOT NULL,
    [Name]        VARCHAR (150)    NOT NULL,
    [Description] VARCHAR (5000)   NULL,
    [Url]         VARCHAR (250)    NULL,
    [StartDate]   DATETIME         NULL,
    [EndDate]     DATETIME         NULL,
    [UserId]      UNIQUEIDENTIFIER NOT NULL,
    [AddedAt]     DATETIME         CONSTRAINT [DF_Site_AddedAt] DEFAULT GetDate() NULL,
    [UpdatedAt]   DATETIME         CONSTRAINT [DF_Site_UpdatedAt] DEFAULT GetDate() NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_Site1] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_Site_Code1] UNIQUE NONCLUSTERED ([Code] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_Site_Name1] UNIQUE NONCLUSTERED ([Name] ASC)
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_CX_Site1]
    ON [dbo].[tmp_ms_xx_Site]([AddedAt] ASC);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Site])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_Site] ([AddedAt], [ID], [Code], [Name], [Description], [Url], [StartDate], [EndDate], [UserId], [UpdatedAt])
        SELECT   [AddedAt],
                 [ID],
                 [Code],
                 [Name],
                 [Description],
                 [Url],
                 [StartDate],
                 [EndDate],
                 [UserId],
                 [UpdatedAt]
        FROM     [dbo].[Site]
        ORDER BY [AddedAt] ASC;
    END

DROP TABLE [dbo].[Site];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Site]', N'Site';

EXECUTE sp_rename N'[dbo].[Site].[tmp_ms_xx_index_CX_Site1]', N'CX_Site', N'INDEX';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_Site1]', N'PK_Site', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_Site_Code1]', N'UX_Site_Code', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_Site_Name1]', N'UX_Site_Name', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[Site].[IX_Site_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Site_UserId]
    ON [dbo].[Site]([UserId] ASC);


GO
PRINT N'Creating [dbo].[Site].[IX_Site_StartDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_Site_StartDate]
    ON [dbo].[Site]([StartDate] ASC);


GO
PRINT N'Creating [dbo].[Site].[IX_Site_EndDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_Site_EndDate]
    ON [dbo].[Site]([EndDate] ASC);


GO
PRINT N'Starting rebuilding table [dbo].[Station]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Station] (
    [ID]            UNIQUEIDENTIFIER CONSTRAINT [DF_Station_ID] DEFAULT (newid()) NOT NULL,
    [Code]          VARCHAR (50)     NOT NULL,
    [Name]          VARCHAR (150)    NOT NULL,
    [Description]   VARCHAR (5000)   NULL,
    [Url]           VARCHAR (250)    NULL,
    [Latitude]      FLOAT (53)       NULL,
    [Longitude]     FLOAT (53)       NULL,
    [Elevation]     INT              NULL,
    [ProjectSiteID] UNIQUEIDENTIFIER NULL,
    [UserId]        UNIQUEIDENTIFIER NOT NULL,
    [SiteID]        UNIQUEIDENTIFIER NULL,
    [StartDate]     DATETIME         NULL,
    [EndDate]       DATETIME         NULL,
    [AddedAt]       DATETIME         CONSTRAINT [DF_Station_AddedAt] DEFAULT GetDate() NULL,
    [UpdatedAt]     DATETIME         CONSTRAINT [DF_Station_UpdatedAt] DEFAULT GetDate() NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PKStation1] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_Station_SiteID_Code1] UNIQUE NONCLUSTERED ([SiteID] ASC, [Code] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UX_Station_SiteID_Name1] UNIQUE NONCLUSTERED ([SiteID] ASC, [Name] ASC)
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_CX_Station1]
    ON [dbo].[tmp_ms_xx_Station]([AddedAt] ASC);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Station])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_Station] ([AddedAt], [ID], [Code], [Name], [Description], [Url], [Latitude], [Longitude], [Elevation], [ProjectSiteID], [UserId], [SiteID], [StartDate], [EndDate], [UpdatedAt])
        SELECT   [AddedAt],
                 [ID],
                 [Code],
                 [Name],
                 [Description],
                 [Url],
                 [Latitude],
                 [Longitude],
                 [Elevation],
                 [ProjectSiteID],
                 [UserId],
                 [SiteID],
                 [StartDate],
                 [EndDate],
                 [UpdatedAt]
        FROM     [dbo].[Station]
        ORDER BY [AddedAt] ASC;
    END

DROP TABLE [dbo].[Station];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Station]', N'Station';

EXECUTE sp_rename N'[dbo].[Station].[tmp_ms_xx_index_CX_Station1]', N'CX_Station', N'INDEX';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PKStation1]', N'PKStation', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_Station_SiteID_Code1]', N'UX_Station_SiteID_Code', N'OBJECT';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UX_Station_SiteID_Name1]', N'UX_Station_SiteID_Name', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating [dbo].[Station].[IX_Station_ProjectSiteID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Station_ProjectSiteID]
    ON [dbo].[Station]([ProjectSiteID] ASC);


GO
PRINT N'Creating [dbo].[Station].[IX_Station_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Station_UserId]
    ON [dbo].[Station]([UserId] ASC);


GO
PRINT N'Creating [dbo].[Station].[IX_Station_SiteID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Station_SiteID]
    ON [dbo].[Station]([SiteID] ASC);


GO
PRINT N'Creating [dbo].[Instrument_DataSource]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TABLE [dbo].[Instrument_DataSource] (
    [ID]           UNIQUEIDENTIFIER NOT NULL,
    [InstrumentID] UNIQUEIDENTIFIER NOT NULL,
    [DataSourceID] UNIQUEIDENTIFIER NOT NULL,
    [StartDate]    DATETIME         NULL,
    [EndDate]      DATETIME         NULL,
    [UserId]       UNIQUEIDENTIFIER NOT NULL,
    [AddedAt]      DATETIME         NULL,
    [UpdatedAt]    DATETIME         NULL,
    CONSTRAINT [PK_Instrument_DataSource] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [UX_Instrument_DataSource] UNIQUE NONCLUSTERED ([InstrumentID] ASC, [DataSourceID] ASC, [StartDate] ASC, [EndDate] ASC)
);


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[Instrument_DataSource].[CX_Instrument_DataSource]...';


GO
CREATE CLUSTERED INDEX [CX_Instrument_DataSource]
    ON [dbo].[Instrument_DataSource]([AddedAt] ASC);


GO
PRINT N'Creating [dbo].[Instrument_DataSource].[IX_Instrument_DataSource_InstrumentID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Instrument_DataSource_InstrumentID]
    ON [dbo].[Instrument_DataSource]([InstrumentID] ASC);


GO
PRINT N'Creating [dbo].[Instrument_DataSource].[IX_Instrument_DataSource_DataSourceID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Instrument_DataSource_DataSourceID]
    ON [dbo].[Instrument_DataSource]([DataSourceID] ASC);


GO
PRINT N'Creating [dbo].[Instrument_DataSource].[IX_Instrument_DataSource_StartDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_Instrument_DataSource_StartDate]
    ON [dbo].[Instrument_DataSource]([StartDate] ASC);


GO
PRINT N'Creating [dbo].[Instrument_DataSource].[IX_Instrument_DataSource_EndDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_Instrument_DataSource_EndDate]
    ON [dbo].[Instrument_DataSource]([EndDate] ASC);


GO
PRINT N'Creating [dbo].[Instrument_DataSource].[IX_Instrument_DataSource_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Instrument_DataSource_UserId]
    ON [dbo].[Instrument_DataSource]([UserId] ASC);


GO
PRINT N'Creating [dbo].[Instrument_Sensor]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TABLE [dbo].[Instrument_Sensor] (
    [ID]           UNIQUEIDENTIFIER NOT NULL,
    [InstrumentID] UNIQUEIDENTIFIER NOT NULL,
    [SensorID]     UNIQUEIDENTIFIER NOT NULL,
    [StartDate]    DATETIME         NULL,
    [EndDate]      DATETIME         NULL,
    [UserId]       UNIQUEIDENTIFIER NOT NULL,
    [AddedAt]      DATETIME         NULL,
    [UpdatedAt]    DATETIME         NULL,
    CONSTRAINT [PK_Instrument_Sensor] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [UX_Instrument_Sensor] UNIQUE NONCLUSTERED ([InstrumentID] ASC, [SensorID] ASC, [StartDate] ASC, [EndDate] ASC)
);


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[Instrument_Sensor].[CX_Instrument_Sensor]...';


GO
CREATE CLUSTERED INDEX [CX_Instrument_Sensor]
    ON [dbo].[Instrument_Sensor]([AddedAt] ASC);


GO
PRINT N'Creating [dbo].[Instrument_Sensor].[IX_Instrument_Sensor_InstrumentID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Instrument_Sensor_InstrumentID]
    ON [dbo].[Instrument_Sensor]([InstrumentID] ASC);


GO
PRINT N'Creating [dbo].[Instrument_Sensor].[IX_Instrument_Sensor_SensorID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Instrument_Sensor_SensorID]
    ON [dbo].[Instrument_Sensor]([SensorID] ASC);


GO
PRINT N'Creating [dbo].[Instrument_Sensor].[IX_Instrument_Sensor_StartDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_Instrument_Sensor_StartDate]
    ON [dbo].[Instrument_Sensor]([StartDate] ASC);


GO
PRINT N'Creating [dbo].[Instrument_Sensor].[IX_Instrument_Sensor_EndDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_Instrument_Sensor_EndDate]
    ON [dbo].[Instrument_Sensor]([EndDate] ASC);


GO
PRINT N'Creating [dbo].[Instrument_Sensor].[IX_Instrument_Sensor_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Instrument_Sensor_UserId]
    ON [dbo].[Instrument_Sensor]([UserId] ASC);


GO
PRINT N'Creating [dbo].[Organisation_Instrument]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TABLE [dbo].[Organisation_Instrument] (
    [ID]                 UNIQUEIDENTIFIER NOT NULL,
    [OrganisationID]     UNIQUEIDENTIFIER NOT NULL,
    [InstrumentID]       UNIQUEIDENTIFIER NOT NULL,
    [OrganisationRoleID] UNIQUEIDENTIFIER NOT NULL,
    [StartDate]          DATETIME         NULL,
    [EndDate]            DATETIME         NULL,
    [UserId]             UNIQUEIDENTIFIER NOT NULL,
    [AddedAt]            DATETIME         NULL,
    [UpdatedAt]          DATETIME         NULL,
    CONSTRAINT [PK_Organisation_Instrument] PRIMARY KEY CLUSTERED ([ID] ASC),
    CONSTRAINT [UX_Organisation_Instrument] UNIQUE NONCLUSTERED ([OrganisationID] ASC, [InstrumentID] ASC, [OrganisationRoleID] ASC, [StartDate] ASC, [EndDate] ASC)
);


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[Organisation_Instrument].[IX_Organisation_Instrument_InstrumentID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Organisation_Instrument_InstrumentID]
    ON [dbo].[Organisation_Instrument]([InstrumentID] ASC);


GO
PRINT N'Creating [dbo].[Organisation_Instrument].[IX_Organisation_Instrument_OrganisationRoleID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Organisation_Instrument_OrganisationRoleID]
    ON [dbo].[Organisation_Instrument]([OrganisationRoleID] ASC);


GO
PRINT N'Creating [dbo].[Organisation_Instrument].[IX_Organisation_Instrument_OrganisationID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Organisation_Instrument_OrganisationID]
    ON [dbo].[Organisation_Instrument]([OrganisationID] ASC);


GO
PRINT N'Creating [dbo].[Organisation_Instrument].[IX_Organisation_Instrument_StartDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_Organisation_Instrument_StartDate]
    ON [dbo].[Organisation_Instrument]([StartDate] ASC);


GO
PRINT N'Creating [dbo].[Organisation_Instrument].[IX_Organisation_Instrument_EndDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_Organisation_Instrument_EndDate]
    ON [dbo].[Organisation_Instrument]([EndDate] ASC);


GO
PRINT N'Creating [dbo].[Organisation_Instrument].[IX_Organisation_Instrument_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Organisation_Instrument_UserId]
    ON [dbo].[Organisation_Instrument]([UserId] ASC);


GO
PRINT N'Creating [dbo].[Organisation_Site]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TABLE [dbo].[Organisation_Site] (
    [ID]                 UNIQUEIDENTIFIER NOT NULL,
    [OrganisationID]     UNIQUEIDENTIFIER NOT NULL,
    [SiteID]             UNIQUEIDENTIFIER NOT NULL,
    [OrganisationRoleID] UNIQUEIDENTIFIER NOT NULL,
    [StartDate]          DATETIME         NULL,
    [EndDate]            DATETIME         NULL,
    [UserId]             UNIQUEIDENTIFIER NOT NULL,
    [AddedAt]            DATETIME         NULL,
    [UpdatedAt]          DATETIME         NULL,
    CONSTRAINT [PK_Organisation_Site] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [UX_Organisation_Site] UNIQUE NONCLUSTERED ([OrganisationID] ASC, [SiteID] ASC, [OrganisationRoleID] ASC, [StartDate] ASC, [EndDate] ASC)
);


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[Organisation_Site].[CX_Organisation_Site]...';


GO
CREATE CLUSTERED INDEX [CX_Organisation_Site]
    ON [dbo].[Organisation_Site]([AddedAt] ASC);


GO
PRINT N'Creating [dbo].[Organisation_Site].[IX_Organisation_Site_OrganisationID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Organisation_Site_OrganisationID]
    ON [dbo].[Organisation_Site]([OrganisationID] ASC);


GO
PRINT N'Creating [dbo].[Organisation_Site].[IX_Organisation_Site_SiteID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Organisation_Site_SiteID]
    ON [dbo].[Organisation_Site]([SiteID] ASC);


GO
PRINT N'Creating [dbo].[Organisation_Site].[IX_Organisation_Site_OrganisationRoleID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Organisation_Site_OrganisationRoleID]
    ON [dbo].[Organisation_Site]([OrganisationRoleID] ASC);


GO
PRINT N'Creating [dbo].[Organisation_Site].[IX_Organisation_Site_StartDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_Organisation_Site_StartDate]
    ON [dbo].[Organisation_Site]([StartDate] ASC);


GO
PRINT N'Creating [dbo].[Organisation_Site].[IX_Organisation_Site_EndDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_Organisation_Site_EndDate]
    ON [dbo].[Organisation_Site]([EndDate] ASC);


GO
PRINT N'Creating [dbo].[Organisation_Site].[IX_Organisation_Site_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Organisation_Site_UserId]
    ON [dbo].[Organisation_Site]([UserId] ASC);


GO
PRINT N'Creating [dbo].[Organisation_Station]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TABLE [dbo].[Organisation_Station] (
    [ID]                 UNIQUEIDENTIFIER NOT NULL,
    [OrganisationID]     UNIQUEIDENTIFIER NOT NULL,
    [StationID]          UNIQUEIDENTIFIER NOT NULL,
    [OrganisationRoleID] UNIQUEIDENTIFIER NOT NULL,
    [StartDate]          DATETIME         NULL,
    [EndDate]            DATETIME         NULL,
    [UserId]             UNIQUEIDENTIFIER NOT NULL,
    [AddedAt]            DATETIME         NULL,
    [UpdatedAt]          DATETIME         NULL,
    CONSTRAINT [PK_Organisation_Station] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [UX_Organisation_Station] UNIQUE NONCLUSTERED ([OrganisationID] ASC, [StationID] ASC, [OrganisationRoleID] ASC, [StartDate] ASC, [EndDate] ASC)
);


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[Organisation_Station].[CX_Organisation_Station]...';


GO
CREATE CLUSTERED INDEX [CX_Organisation_Station]
    ON [dbo].[Organisation_Station]([AddedAt] ASC);


GO
PRINT N'Creating [dbo].[Organisation_Station].[IX_Organisation_Station_OrganisationID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Organisation_Station_OrganisationID]
    ON [dbo].[Organisation_Station]([OrganisationID] ASC);


GO
PRINT N'Creating [dbo].[Organisation_Station].[IX_Organisation_Station_StationID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Organisation_Station_StationID]
    ON [dbo].[Organisation_Station]([StationID] ASC);


GO
PRINT N'Creating [dbo].[Organisation_Station].[IX_Organisation_Station_OrganisationRoleID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Organisation_Station_OrganisationRoleID]
    ON [dbo].[Organisation_Station]([OrganisationRoleID] ASC);


GO
PRINT N'Creating [dbo].[Organisation_Station].[IX_Organisation_Station_StartDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_Organisation_Station_StartDate]
    ON [dbo].[Organisation_Station]([StartDate] ASC);


GO
PRINT N'Creating [dbo].[Organisation_Station].[IX_Organisation_Station_EndDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_Organisation_Station_EndDate]
    ON [dbo].[Organisation_Station]([EndDate] ASC);


GO
PRINT N'Creating [dbo].[Organisation_Station].[IX_Organisation_Station_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Organisation_Station_UserId]
    ON [dbo].[Organisation_Station]([UserId] ASC);


GO
PRINT N'Creating [dbo].[Programme]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TABLE [dbo].[Programme] (
    [ID]          UNIQUEIDENTIFIER NOT NULL,
    [Code]        VARCHAR (50)     NOT NULL,
    [Name]        VARCHAR (150)    NOT NULL,
    [Description] VARCHAR (5000)   NULL,
    [Url]         VARCHAR (250)    NULL,
    [StartDate]   DATETIME         NULL,
    [EndDate]     DATETIME         NULL,
    [UserId]      UNIQUEIDENTIFIER NOT NULL,
    [AddedAt]     DATETIME         NULL,
    [UpdatedAt]   DATETIME         NULL,
    CONSTRAINT [PK_Programme] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [UX_Programme_Code] UNIQUE NONCLUSTERED ([Code] ASC),
    CONSTRAINT [UX_Programme_Name] UNIQUE NONCLUSTERED ([Name] ASC)
);


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[Programme].[CX_Programme]...';


GO
CREATE CLUSTERED INDEX [CX_Programme]
    ON [dbo].[Programme]([AddedAt] ASC);


GO
PRINT N'Creating [dbo].[Programme].[IX_Programme_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Programme_UserId]
    ON [dbo].[Programme]([UserId] ASC);


GO
PRINT N'Creating [dbo].[Programme].[IX_Programme_StartDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_Programme_StartDate]
    ON [dbo].[Programme]([StartDate] ASC);


GO
PRINT N'Creating [dbo].[Programme].[IX_Programme_EndDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_Programme_EndDate]
    ON [dbo].[Programme]([EndDate] ASC);


GO
PRINT N'Creating [dbo].[Progress]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TABLE [dbo].[Progress] (
    [ImportBatchID]        UNIQUEIDENTIFIER NULL,
    [StartDate]            DATETIME         NULL,
    [EndDate]              DATETIME         NULL,
    [DateUploaded]         DATETIME         NULL,
    [Observations]         BIGINT           NULL,
    [UserId]               UNIQUEIDENTIFIER NULL,
    [SensorID]             UNIQUEIDENTIFIER NULL,
    [PhenomenonOfferingID] UNIQUEIDENTIFIER NULL
);


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[Progress].[IX_Progress_ImportBatchID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Progress_ImportBatchID]
    ON [dbo].[Progress]([ImportBatchID] ASC);


GO
PRINT N'Creating [dbo].[Progress].[IX_Progress_SensorID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Progress_SensorID]
    ON [dbo].[Progress]([SensorID] ASC);


GO
PRINT N'Creating [dbo].[Progress].[IX_Progress_PhenomenonOfferingID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Progress_PhenomenonOfferingID]
    ON [dbo].[Progress]([PhenomenonOfferingID] ASC);


GO
PRINT N'Creating [dbo].[Progress].[IX_Progress_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Progress_UserId]
    ON [dbo].[Progress]([UserId] ASC);


GO
PRINT N'Creating [dbo].[Project]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TABLE [dbo].[Project] (
    [ID]          UNIQUEIDENTIFIER NOT NULL,
    [ProgrammeID] UNIQUEIDENTIFIER NULL,
    [Code]        VARCHAR (50)     NOT NULL,
    [Name]        VARCHAR (150)    NOT NULL,
    [Description] VARCHAR (5000)   NULL,
    [Url]         VARCHAR (250)    NULL,
    [StartDate]   DATETIME         NULL,
    [EndDate]     DATETIME         NULL,
    [UserId]      UNIQUEIDENTIFIER NOT NULL,
    [AddedAt]     DATETIME         NULL,
    [UpdatedAt]   DATETIME         NULL,
    CONSTRAINT [PK_Project] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [UX_Project_ProgramID_Code] UNIQUE NONCLUSTERED ([ProgrammeID] ASC, [Code] ASC),
    CONSTRAINT [UX_Project_ProgramID_Name] UNIQUE NONCLUSTERED ([ProgrammeID] ASC, [Name] ASC)
);


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[Project].[CX_Project]...';


GO
CREATE CLUSTERED INDEX [CX_Project]
    ON [dbo].[Project]([AddedAt] ASC);


GO
PRINT N'Creating [dbo].[Project].[IX_Project_ProgrammeID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Project_ProgrammeID]
    ON [dbo].[Project]([ProgrammeID] ASC);


GO
PRINT N'Creating [dbo].[Project].[IX_Project_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Project_UserId]
    ON [dbo].[Project]([UserId] ASC);


GO
PRINT N'Creating [dbo].[Project].[IX_Project_StartDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_Project_StartDate]
    ON [dbo].[Project]([StartDate] ASC);


GO
PRINT N'Creating [dbo].[Project].[IX_Project_EndDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_Project_EndDate]
    ON [dbo].[Project]([EndDate] ASC);


GO
PRINT N'Creating [dbo].[Project_Station]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TABLE [dbo].[Project_Station] (
    [ID]        UNIQUEIDENTIFIER NOT NULL,
    [ProjectID] UNIQUEIDENTIFIER NOT NULL,
    [StationID] UNIQUEIDENTIFIER NOT NULL,
    [StartDate] DATETIME         NULL,
    [EndDate]   DATETIME         NULL,
    [UserId]    UNIQUEIDENTIFIER NOT NULL,
    [AddedAt]   DATETIME         NULL,
    [UpdatedAt] DATETIME         NULL,
    CONSTRAINT [PK_Project_Station] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [UX_Project_Station] UNIQUE NONCLUSTERED ([ProjectID] ASC, [StationID] ASC, [StartDate] ASC, [EndDate] ASC)
);


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[Project_Station].[CX_Project_Station]...';


GO
CREATE CLUSTERED INDEX [CX_Project_Station]
    ON [dbo].[Project_Station]([AddedAt] ASC);


GO
PRINT N'Creating [dbo].[Project_Station].[IX_Project_Station_ProjectID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Project_Station_ProjectID]
    ON [dbo].[Project_Station]([ProjectID] ASC);


GO
PRINT N'Creating [dbo].[Project_Station].[IX_Project_Station_StationID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Project_Station_StationID]
    ON [dbo].[Project_Station]([StationID] ASC);


GO
PRINT N'Creating [dbo].[Project_Station].[IX_Project_Station_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Project_Station_UserId]
    ON [dbo].[Project_Station]([UserId] ASC);


GO
PRINT N'Creating [dbo].[Project_Station].[IX_Project_Station_StartDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_Project_Station_StartDate]
    ON [dbo].[Project_Station]([StartDate] ASC);


GO
PRINT N'Creating [dbo].[Project_Station].[IX_Project_Station_EndDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_Project_Station_EndDate]
    ON [dbo].[Project_Station]([EndDate] ASC);


GO
PRINT N'Creating [dbo].[SchemaColumn]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TABLE [dbo].[SchemaColumn] (
    [ID]                   UNIQUEIDENTIFIER NOT NULL,
    [DataSchemaID]         UNIQUEIDENTIFIER NOT NULL,
    [Number]               INT              NOT NULL,
    [Name]                 VARCHAR (100)    NOT NULL,
    [SchemaColumnTypeID]   UNIQUEIDENTIFIER NOT NULL,
    [Width]                INT              NULL,
    [Format]               VARCHAR (50)     NULL,
    [PhenomenonID]         UNIQUEIDENTIFIER NULL,
    [PhenomenonOfferingID] UNIQUEIDENTIFIER NULL,
    [PhenomenonUOMID]      UNIQUEIDENTIFIER NULL,
    [FixedTime]            VARCHAR (50)     NULL,
    [EmptyValue]           VARCHAR (50)     NULL,
    [UserId]               UNIQUEIDENTIFIER NOT NULL,
    [AddedAt]              DATETIME         NULL,
    [UpdatedAt]            DATETIME         NULL,
    CONSTRAINT [PK_SchemaColumn] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [UX_SchemaColumn_Name] UNIQUE NONCLUSTERED ([DataSchemaID] ASC, [Name] ASC),
    CONSTRAINT [UX_SchemaColumn_Number] UNIQUE NONCLUSTERED ([DataSchemaID] ASC, [Number] ASC)
);


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[SchemaColumn].[CX_SchemaColumn]...';


GO
CREATE CLUSTERED INDEX [CX_SchemaColumn]
    ON [dbo].[SchemaColumn]([AddedAt] ASC);


GO
PRINT N'Creating [dbo].[SchemaColumn].[IX_SchemaColumn_DataSchemaID]...';


GO
CREATE NONCLUSTERED INDEX [IX_SchemaColumn_DataSchemaID]
    ON [dbo].[SchemaColumn]([DataSchemaID] ASC);


GO
PRINT N'Creating [dbo].[SchemaColumn].[IX_SchemaColumn_SchemaColumnTypeID]...';


GO
CREATE NONCLUSTERED INDEX [IX_SchemaColumn_SchemaColumnTypeID]
    ON [dbo].[SchemaColumn]([SchemaColumnTypeID] ASC);


GO
PRINT N'Creating [dbo].[SchemaColumn].[IX_SchemaColumn_PhenomenonID]...';


GO
CREATE NONCLUSTERED INDEX [IX_SchemaColumn_PhenomenonID]
    ON [dbo].[SchemaColumn]([PhenomenonID] ASC);


GO
PRINT N'Creating [dbo].[SchemaColumn].[IX_SchemaColumn_PhenomenonOfferingID]...';


GO
CREATE NONCLUSTERED INDEX [IX_SchemaColumn_PhenomenonOfferingID]
    ON [dbo].[SchemaColumn]([PhenomenonOfferingID] ASC);


GO
PRINT N'Creating [dbo].[SchemaColumn].[IX_SchemaColumn_PhenomenonUOMID]...';


GO
CREATE NONCLUSTERED INDEX [IX_SchemaColumn_PhenomenonUOMID]
    ON [dbo].[SchemaColumn]([PhenomenonUOMID] ASC);


GO
PRINT N'Creating [dbo].[SchemaColumn].[IX_SchemaColumn_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_SchemaColumn_UserId]
    ON [dbo].[SchemaColumn]([UserId] ASC);


GO
PRINT N'Creating [dbo].[SchemaColumnType]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TABLE [dbo].[SchemaColumnType] (
    [ID]          UNIQUEIDENTIFIER NOT NULL,
    [Name]        VARCHAR (50)     NOT NULL,
    [Description] VARCHAR (250)    NOT NULL,
    [UserId]      UNIQUEIDENTIFIER NOT NULL,
    [AddedAt]     DATETIME         NULL,
    [UpdatedAt]   DATETIME         NULL,
    CONSTRAINT [PK_SchemaColumnType] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [UX_SchemaColumnType] UNIQUE NONCLUSTERED ([Name] ASC)
);


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[SchemaColumnType].[CX_SchemaColumnType]...';


GO
CREATE CLUSTERED INDEX [CX_SchemaColumnType]
    ON [dbo].[SchemaColumnType]([AddedAt] ASC);


GO
PRINT N'Creating [dbo].[SchemaColumnType].[IX_SchemaColumnType_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_SchemaColumnType_UserId]
    ON [dbo].[SchemaColumnType]([UserId] ASC);


GO
PRINT N'Creating [dbo].[Station_Instrument]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TABLE [dbo].[Station_Instrument] (
    [ID]           UNIQUEIDENTIFIER NOT NULL,
    [StationID]    UNIQUEIDENTIFIER NOT NULL,
    [InstrumentID] UNIQUEIDENTIFIER NOT NULL,
    [StartDate]    DATETIME         NULL,
    [EndDate]      DATETIME         NULL,
    [UserId]       UNIQUEIDENTIFIER NOT NULL,
    [AddedAt]      DATETIME         NULL,
    [UpdatedAt]    DATETIME         NULL,
    CONSTRAINT [PK_Station_Instrument] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [UX_Station_Instrument] UNIQUE NONCLUSTERED ([StationID] ASC, [InstrumentID] ASC, [StartDate] ASC, [EndDate] ASC)
);


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[Station_Instrument].[CX_Station_Instrument]...';


GO
CREATE CLUSTERED INDEX [CX_Station_Instrument]
    ON [dbo].[Station_Instrument]([AddedAt] ASC);


GO
PRINT N'Creating [dbo].[Station_Instrument].[IX_Station_Instrument_StationID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Station_Instrument_StationID]
    ON [dbo].[Station_Instrument]([StationID] ASC);


GO
PRINT N'Creating [dbo].[Station_Instrument].[IX_Station_Instrument_InstrumentID]...';


GO
CREATE NONCLUSTERED INDEX [IX_Station_Instrument_InstrumentID]
    ON [dbo].[Station_Instrument]([InstrumentID] ASC);


GO
PRINT N'Creating [dbo].[Station_Instrument].[IX_Station_Instrument_StartDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_Station_Instrument_StartDate]
    ON [dbo].[Station_Instrument]([StartDate] ASC);


GO
PRINT N'Creating [dbo].[Station_Instrument].[IX_Station_Instrument_EndDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_Station_Instrument_EndDate]
    ON [dbo].[Station_Instrument]([EndDate] ASC);


GO
PRINT N'Creating [dbo].[Station_Instrument].[IX_Station_Instrument_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Station_Instrument_UserId]
    ON [dbo].[Station_Instrument]([UserId] ASC);


GO
PRINT N'Creating [dbo].[StatusReason]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TABLE [dbo].[StatusReason] (
    [ID]          UNIQUEIDENTIFIER NOT NULL,
    [Code]        VARCHAR (50)     NOT NULL,
    [Name]        VARCHAR (150)    NOT NULL,
    [Description] VARCHAR (500)    NOT NULL,
    [UserId]      UNIQUEIDENTIFIER NOT NULL,
    [AddedAt]     DATETIME         NULL,
    [UpdatedAt]   DATETIME         NULL,
    CONSTRAINT [PK_StatusReason] PRIMARY KEY NONCLUSTERED ([ID] ASC),
    CONSTRAINT [UX_StatusReason_Code] UNIQUE NONCLUSTERED ([Code] ASC),
    CONSTRAINT [UX_StatusReason_Name] UNIQUE NONCLUSTERED ([Name] ASC)
);


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[StatusReason].[CX_StatusReason]...';


GO
CREATE CLUSTERED INDEX [CX_StatusReason]
    ON [dbo].[StatusReason]([AddedAt] ASC);


GO
PRINT N'Creating [dbo].[StatusReason].[IX_StatusReason_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_StatusReason_UserId]
    ON [dbo].[StatusReason]([UserId] ASC);


GO
PRINT N'Creating [dbo].[UX_RoleModule]...';


GO
ALTER TABLE [dbo].[RoleModule]
    ADD CONSTRAINT [UX_RoleModule] UNIQUE NONCLUSTERED ([RoleId] ASC, [ModuleID] ASC);


GO
PRINT N'Creating [dbo].[DF_Instrument_DataSource_ID]...';


GO
ALTER TABLE [dbo].[Instrument_DataSource]
    ADD CONSTRAINT [DF_Instrument_DataSource_ID] DEFAULT newid() FOR [ID];


GO
PRINT N'Creating [dbo].[DF_Instrument_DataSource_AddedAt]...';


GO
ALTER TABLE [dbo].[Instrument_DataSource]
    ADD CONSTRAINT [DF_Instrument_DataSource_AddedAt] DEFAULT GetDate() FOR [AddedAt];


GO
PRINT N'Creating [dbo].[DF_Instrument_DataSource_UpdatedAt]...';


GO
ALTER TABLE [dbo].[Instrument_DataSource]
    ADD CONSTRAINT [DF_Instrument_DataSource_UpdatedAt] DEFAULT GetDate() FOR [UpdatedAt];


GO
PRINT N'Creating [dbo].[DF_Instrument_Sensor_ID]...';


GO
ALTER TABLE [dbo].[Instrument_Sensor]
    ADD CONSTRAINT [DF_Instrument_Sensor_ID] DEFAULT newid() FOR [ID];


GO
PRINT N'Creating [dbo].[DF_Instrument_Sensor_AddedAt]...';


GO
ALTER TABLE [dbo].[Instrument_Sensor]
    ADD CONSTRAINT [DF_Instrument_Sensor_AddedAt] DEFAULT GetDate() FOR [AddedAt];


GO
PRINT N'Creating [dbo].[DF_Instrument_Sensor_UpdatedAt]...';


GO
ALTER TABLE [dbo].[Instrument_Sensor]
    ADD CONSTRAINT [DF_Instrument_Sensor_UpdatedAt] DEFAULT GetDate() FOR [UpdatedAt];


GO
PRINT N'Creating [dbo].[DF_Organisation_Instrument_ID]...';


GO
ALTER TABLE [dbo].[Organisation_Instrument]
    ADD CONSTRAINT [DF_Organisation_Instrument_ID] DEFAULT newid() FOR [ID];


GO
PRINT N'Creating [dbo].[DF_Organisation_Instrument_AddedAt]...';


GO
ALTER TABLE [dbo].[Organisation_Instrument]
    ADD CONSTRAINT [DF_Organisation_Instrument_AddedAt] DEFAULT GetDate() FOR [AddedAt];


GO
PRINT N'Creating [dbo].[DF_Organisation_Instrument_UpdatedAt]...';


GO
ALTER TABLE [dbo].[Organisation_Instrument]
    ADD CONSTRAINT [DF_Organisation_Instrument_UpdatedAt] DEFAULT GetDate() FOR [UpdatedAt];


GO
PRINT N'Creating [dbo].[DF_Organisation_Site_ID]...';


GO
ALTER TABLE [dbo].[Organisation_Site]
    ADD CONSTRAINT [DF_Organisation_Site_ID] DEFAULT newid() FOR [ID];


GO
PRINT N'Creating [dbo].[DF_Organisation_Site_AddedAt]...';


GO
ALTER TABLE [dbo].[Organisation_Site]
    ADD CONSTRAINT [DF_Organisation_Site_AddedAt] DEFAULT GetDate() FOR [AddedAt];


GO
PRINT N'Creating [dbo].[DF_Organisation_Site_UpdatedAt]...';


GO
ALTER TABLE [dbo].[Organisation_Site]
    ADD CONSTRAINT [DF_Organisation_Site_UpdatedAt] DEFAULT GetDate() FOR [UpdatedAt];


GO
PRINT N'Creating [dbo].[DF_Organisation_Station_ID]...';


GO
ALTER TABLE [dbo].[Organisation_Station]
    ADD CONSTRAINT [DF_Organisation_Station_ID] DEFAULT newid() FOR [ID];


GO
PRINT N'Creating [dbo].[DF_Organisation_Station_AddedAt]...';


GO
ALTER TABLE [dbo].[Organisation_Station]
    ADD CONSTRAINT [DF_Organisation_Station_AddedAt] DEFAULT GetDate() FOR [AddedAt];


GO
PRINT N'Creating [dbo].[DF_Organisation_Station_UpdatedAt]...';


GO
ALTER TABLE [dbo].[Organisation_Station]
    ADD CONSTRAINT [DF_Organisation_Station_UpdatedAt] DEFAULT GetDate() FOR [UpdatedAt];


GO
PRINT N'Creating [dbo].[DF_Programme_ID]...';


GO
ALTER TABLE [dbo].[Programme]
    ADD CONSTRAINT [DF_Programme_ID] DEFAULT newid() FOR [ID];


GO
PRINT N'Creating [dbo].[DF_Programme_AddedAt]...';


GO
ALTER TABLE [dbo].[Programme]
    ADD CONSTRAINT [DF_Programme_AddedAt] DEFAULT GetDate() FOR [AddedAt];


GO
PRINT N'Creating [dbo].[DF_Programme_UpdatedAt]...';


GO
ALTER TABLE [dbo].[Programme]
    ADD CONSTRAINT [DF_Programme_UpdatedAt] DEFAULT GetDate() FOR [UpdatedAt];


GO
PRINT N'Creating [dbo].[DF_Project_ID]...';


GO
ALTER TABLE [dbo].[Project]
    ADD CONSTRAINT [DF_Project_ID] DEFAULT newid() FOR [ID];


GO
PRINT N'Creating [dbo].[DF_Project_AddedAt]...';


GO
ALTER TABLE [dbo].[Project]
    ADD CONSTRAINT [DF_Project_AddedAt] DEFAULT GetDate() FOR [AddedAt];


GO
PRINT N'Creating [dbo].[DF_Project_UpdatedAt]...';


GO
ALTER TABLE [dbo].[Project]
    ADD CONSTRAINT [DF_Project_UpdatedAt] DEFAULT GetDate() FOR [UpdatedAt];


GO
PRINT N'Creating [dbo].[DF_Project_Station_ID]...';


GO
ALTER TABLE [dbo].[Project_Station]
    ADD CONSTRAINT [DF_Project_Station_ID] DEFAULT newid() FOR [ID];


GO
PRINT N'Creating [dbo].[DF_Project_Station_AddedAt]...';


GO
ALTER TABLE [dbo].[Project_Station]
    ADD CONSTRAINT [DF_Project_Station_AddedAt] DEFAULT GetDate() FOR [AddedAt];


GO
PRINT N'Creating [dbo].[DF_Project_Station__UpdatedAt]...';


GO
ALTER TABLE [dbo].[Project_Station]
    ADD CONSTRAINT [DF_Project_Station__UpdatedAt] DEFAULT GetDate() FOR [UpdatedAt];


GO
PRINT N'Creating [dbo].[DF_SchemaColumn_ID]...';


GO
ALTER TABLE [dbo].[SchemaColumn]
    ADD CONSTRAINT [DF_SchemaColumn_ID] DEFAULT newid() FOR [ID];


GO
PRINT N'Creating [dbo].[DF_SchemaColumn_AddedAt]...';


GO
ALTER TABLE [dbo].[SchemaColumn]
    ADD CONSTRAINT [DF_SchemaColumn_AddedAt] DEFAULT GetDate() FOR [AddedAt];


GO
PRINT N'Creating [dbo].[DF_SchemaColumn_UpdatedAt]...';


GO
ALTER TABLE [dbo].[SchemaColumn]
    ADD CONSTRAINT [DF_SchemaColumn_UpdatedAt] DEFAULT GetDate() FOR [UpdatedAt];


GO
PRINT N'Creating [dbo].[DF_SchemaColumnType_ID]...';


GO
ALTER TABLE [dbo].[SchemaColumnType]
    ADD CONSTRAINT [DF_SchemaColumnType_ID] DEFAULT newid() FOR [ID];


GO
PRINT N'Creating [dbo].[DF_SchemaColumnType_AddedAt]...';


GO
ALTER TABLE [dbo].[SchemaColumnType]
    ADD CONSTRAINT [DF_SchemaColumnType_AddedAt] DEFAULT GetDate() FOR [AddedAt];


GO
PRINT N'Creating [dbo].[DF_SchemaColumnType_UpdatedAt]...';


GO
ALTER TABLE [dbo].[SchemaColumnType]
    ADD CONSTRAINT [DF_SchemaColumnType_UpdatedAt] DEFAULT GetDate() FOR [UpdatedAt];


GO
PRINT N'Creating [dbo].[DF_Station_Instrument_ID]...';


GO
ALTER TABLE [dbo].[Station_Instrument]
    ADD CONSTRAINT [DF_Station_Instrument_ID] DEFAULT newid() FOR [ID];


GO
PRINT N'Creating [dbo].[DF_Station_Instrument_AddedAt]...';


GO
ALTER TABLE [dbo].[Station_Instrument]
    ADD CONSTRAINT [DF_Station_Instrument_AddedAt] DEFAULT GetDate() FOR [AddedAt];


GO
PRINT N'Creating [dbo].[DF_Station_Instrument_UpdatedAt]...';


GO
ALTER TABLE [dbo].[Station_Instrument]
    ADD CONSTRAINT [DF_Station_Instrument_UpdatedAt] DEFAULT GetDate() FOR [UpdatedAt];


GO
PRINT N'Creating [dbo].[DF_StatusReason_ID]...';


GO
ALTER TABLE [dbo].[StatusReason]
    ADD CONSTRAINT [DF_StatusReason_ID] DEFAULT (newid()) FOR [ID];


GO
PRINT N'Creating [dbo].[DF_StatusReason_AddedAt]...';


GO
ALTER TABLE [dbo].[StatusReason]
    ADD CONSTRAINT [DF_StatusReason_AddedAt] DEFAULT GetDate() FOR [AddedAt];


GO
PRINT N'Creating [dbo].[DF_StatusReason_UpdatedAt]...';


GO
ALTER TABLE [dbo].[StatusReason]
    ADD CONSTRAINT [DF_StatusReason_UpdatedAt] DEFAULT GetDate() FOR [UpdatedAt];


GO
PRINT N'Creating [dbo].[DF_Organisation_ID]...';


GO
ALTER TABLE [dbo].[Organisation]
    ADD CONSTRAINT [DF_Organisation_ID] DEFAULT (newid()) FOR [ID];


GO
PRINT N'Creating [dbo].[FK_DataLog_DataSourceTransformation]...';


GO
ALTER TABLE [dbo].[DataLog] WITH NOCHECK
    ADD CONSTRAINT [FK_DataLog_DataSourceTransformation] FOREIGN KEY ([DataSourceTransformationID]) REFERENCES [dbo].[DataSourceTransformation] ([ID]);


GO
PRINT N'Creating [dbo].[FK_DataLog_Sensor]...';


GO
ALTER TABLE [dbo].[DataLog] WITH NOCHECK
    ADD CONSTRAINT [FK_DataLog_Sensor] FOREIGN KEY ([SensorID]) REFERENCES [dbo].[Sensor] ([ID]);


GO
PRINT N'Creating [dbo].[FK_DataLog_aspnet_Users]...';


GO
ALTER TABLE [dbo].[DataLog] WITH NOCHECK
    ADD CONSTRAINT [FK_DataLog_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_DataLog_Status]...';


GO
ALTER TABLE [dbo].[DataLog] WITH NOCHECK
    ADD CONSTRAINT [FK_DataLog_Status] FOREIGN KEY ([StatusID]) REFERENCES [dbo].[Status] ([ID]);


GO
PRINT N'Creating [dbo].[FK_DataLog_PhenomenonOffering]...';


GO
ALTER TABLE [dbo].[DataLog] WITH NOCHECK
    ADD CONSTRAINT [FK_DataLog_PhenomenonOffering] FOREIGN KEY ([PhenomenonOfferingID]) REFERENCES [dbo].[PhenomenonOffering] ([ID]);


GO
PRINT N'Creating [dbo].[FK_DataLog_PhenomenonUOM]...';


GO
ALTER TABLE [dbo].[DataLog] WITH NOCHECK
    ADD CONSTRAINT [FK_DataLog_PhenomenonUOM] FOREIGN KEY ([PhenomenonUOMID]) REFERENCES [dbo].[PhenomenonUOM] ([ID]);


GO
PRINT N'Creating [dbo].[FK_DataLog_ImportBatch]...';


GO
ALTER TABLE [dbo].[DataLog] WITH NOCHECK
    ADD CONSTRAINT [FK_DataLog_ImportBatch] FOREIGN KEY ([ImportBatchID]) REFERENCES [dbo].[ImportBatch] ([ID]);


GO
PRINT N'Creating [dbo].[FK_DataLog_StatusReason]...';


GO
ALTER TABLE [dbo].[DataLog] WITH NOCHECK
    ADD CONSTRAINT [FK_DataLog_StatusReason] FOREIGN KEY ([StatusReasonID]) REFERENCES [dbo].[StatusReason] ([ID]);


GO
PRINT N'Creating [dbo].[FK_ImportBatch_aspnet_Users]...';


GO
ALTER TABLE [dbo].[ImportBatch] WITH NOCHECK
    ADD CONSTRAINT [FK_ImportBatch_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_ImportBatch_DataSource]...';


GO
ALTER TABLE [dbo].[ImportBatch] WITH NOCHECK
    ADD CONSTRAINT [FK_ImportBatch_DataSource] FOREIGN KEY ([DataSourceID]) REFERENCES [dbo].[DataSource] ([ID]);


GO
PRINT N'Creating [dbo].[FK_ImportBatch_Status]...';


GO
ALTER TABLE [dbo].[ImportBatch] WITH NOCHECK
    ADD CONSTRAINT [FK_ImportBatch_Status] FOREIGN KEY ([StatusID]) REFERENCES [dbo].[Status] ([ID]);


GO
PRINT N'Creating [dbo].[FK_ImportBatch_StatusReason]...';


GO
ALTER TABLE [dbo].[ImportBatch] WITH NOCHECK
    ADD CONSTRAINT [FK_ImportBatch_StatusReason] FOREIGN KEY ([StatusReasonID]) REFERENCES [dbo].[StatusReason] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Observation_Sensor]...';


GO
ALTER TABLE [dbo].[Observation] WITH NOCHECK
    ADD CONSTRAINT [FK_Observation_Sensor] FOREIGN KEY ([SensorID]) REFERENCES [dbo].[Sensor] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Observation_PhenomenonOffering]...';


GO
ALTER TABLE [dbo].[Observation] WITH NOCHECK
    ADD CONSTRAINT [FK_Observation_PhenomenonOffering] FOREIGN KEY ([PhenomenonOfferingID]) REFERENCES [dbo].[PhenomenonOffering] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Observation_PhenomenonUOM]...';


GO
ALTER TABLE [dbo].[Observation] WITH NOCHECK
    ADD CONSTRAINT [FK_Observation_PhenomenonUOM] FOREIGN KEY ([PhenomenonUOMID]) REFERENCES [dbo].[PhenomenonUOM] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Observation_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Observation] WITH NOCHECK
    ADD CONSTRAINT [FK_Observation_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Observation_ImportBatch]...';


GO
ALTER TABLE [dbo].[Observation] WITH NOCHECK
    ADD CONSTRAINT [FK_Observation_ImportBatch] FOREIGN KEY ([ImportBatchID]) REFERENCES [dbo].[ImportBatch] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Observation_Status]...';


GO
ALTER TABLE [dbo].[Observation] WITH NOCHECK
    ADD CONSTRAINT [FK_Observation_Status] FOREIGN KEY ([StatusID]) REFERENCES [dbo].[Status] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Observation_StatusReason]...';


GO
ALTER TABLE [dbo].[Observation] WITH NOCHECK
    ADD CONSTRAINT [FK_Observation_StatusReason] FOREIGN KEY ([StatusReasonID]) REFERENCES [dbo].[StatusReason] ([ID]);


GO
PRINT N'Creating [dbo].[FK_DataSource_DataSchema]...';


GO
ALTER TABLE [dbo].[DataSource] WITH NOCHECK
    ADD CONSTRAINT [FK_DataSource_DataSchema] FOREIGN KEY ([DataSchemaID]) REFERENCES [dbo].[DataSchema] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Sensor_DataSchema]...';


GO
ALTER TABLE [dbo].[Sensor] WITH NOCHECK
    ADD CONSTRAINT [FK_Sensor_DataSchema] FOREIGN KEY ([DataSchemaID]) REFERENCES [dbo].[DataSchema] ([ID]);


GO
PRINT N'Creating [dbo].[FK_DataSchema_DataSourceType]...';


GO
ALTER TABLE [dbo].[DataSchema] WITH NOCHECK
    ADD CONSTRAINT [FK_DataSchema_DataSourceType] FOREIGN KEY ([DataSourceTypeID]) REFERENCES [dbo].[DataSourceType] ([ID]);


GO
PRINT N'Creating [dbo].[FK_DataSchema_aspnet_Users]...';


GO
ALTER TABLE [dbo].[DataSchema] WITH NOCHECK
    ADD CONSTRAINT [FK_DataSchema_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_DataSourceTransformation_DataSource]...';


GO
ALTER TABLE [dbo].[DataSourceTransformation] WITH NOCHECK
    ADD CONSTRAINT [FK_DataSourceTransformation_DataSource] FOREIGN KEY ([DataSourceID]) REFERENCES [dbo].[DataSource] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Sensor_DataSource]...';


GO
ALTER TABLE [dbo].[Sensor] WITH NOCHECK
    ADD CONSTRAINT [FK_Sensor_DataSource] FOREIGN KEY ([DataSourceID]) REFERENCES [dbo].[DataSource] ([ID]);


GO
PRINT N'Creating [dbo].[FK_DataSourceRole_DataSource]...';


GO
ALTER TABLE [dbo].[DataSourceRole] WITH NOCHECK
    ADD CONSTRAINT [FK_DataSourceRole_DataSource] FOREIGN KEY ([DataSourceID]) REFERENCES [dbo].[DataSource] ([ID]);


GO
PRINT N'Creating [dbo].[FK_DataSource_aspnet_Users]...';


GO
ALTER TABLE [dbo].[DataSource] WITH NOCHECK
    ADD CONSTRAINT [FK_DataSource_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_DataSourceRole_aspnet_Users]...';


GO
ALTER TABLE [dbo].[DataSourceRole] WITH NOCHECK
    ADD CONSTRAINT [FK_DataSourceRole_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_DataSourceRole_aspnet_Roles]...';


GO
ALTER TABLE [dbo].[DataSourceRole] WITH NOCHECK
    ADD CONSTRAINT [FK_DataSourceRole_aspnet_Roles] FOREIGN KEY ([RoleId]) REFERENCES [dbo].[aspnet_Roles] ([RoleId]);


GO
PRINT N'Creating [dbo].[FK_DataSourceTransformation_Sensor]...';


GO
ALTER TABLE [dbo].[DataSourceTransformation] WITH NOCHECK
    ADD CONSTRAINT [FK_DataSourceTransformation_Sensor] FOREIGN KEY ([SensorID]) REFERENCES [dbo].[Sensor] ([ID]);


GO
PRINT N'Creating [dbo].[FK_DataSourceTransformation_aspnet_Users]...';


GO
ALTER TABLE [dbo].[DataSourceTransformation] WITH NOCHECK
    ADD CONSTRAINT [FK_DataSourceTransformation_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_DataSourceTransformation_Phenomenon]...';


GO
ALTER TABLE [dbo].[DataSourceTransformation] WITH NOCHECK
    ADD CONSTRAINT [FK_DataSourceTransformation_Phenomenon] FOREIGN KEY ([PhenomenonID]) REFERENCES [dbo].[Phenomenon] ([ID]);


GO
PRINT N'Creating [dbo].[FK_DataSourceTransformation_TransformationType]...';


GO
ALTER TABLE [dbo].[DataSourceTransformation] WITH NOCHECK
    ADD CONSTRAINT [FK_DataSourceTransformation_TransformationType] FOREIGN KEY ([TransformationTypeID]) REFERENCES [dbo].[TransformationType] ([ID]);


GO
PRINT N'Creating [dbo].[FK_DataSourceTransformation_PhenomenonOffering]...';


GO
ALTER TABLE [dbo].[DataSourceTransformation] WITH NOCHECK
    ADD CONSTRAINT [FK_DataSourceTransformation_PhenomenonOffering] FOREIGN KEY ([PhenomenonOfferingID]) REFERENCES [dbo].[PhenomenonOffering] ([ID]);


GO
PRINT N'Creating [dbo].[FK_DataSourceTransformation_PhenomenonUOM]...';


GO
ALTER TABLE [dbo].[DataSourceTransformation] WITH NOCHECK
    ADD CONSTRAINT [FK_DataSourceTransformation_PhenomenonUOM] FOREIGN KEY ([PhenomenonUOMID]) REFERENCES [dbo].[PhenomenonUOM] ([ID]);


GO
PRINT N'Creating [dbo].[FK_DataSourceTransformation_NewPhenomenonOffering]...';


GO
ALTER TABLE [dbo].[DataSourceTransformation] WITH NOCHECK
    ADD CONSTRAINT [FK_DataSourceTransformation_NewPhenomenonOffering] FOREIGN KEY ([NewPhenomenonOfferingID]) REFERENCES [dbo].[PhenomenonOffering] ([ID]);


GO
PRINT N'Creating [dbo].[FK_DataSourceTransformation_NewPhenomenonUOM]...';


GO
ALTER TABLE [dbo].[DataSourceTransformation] WITH NOCHECK
    ADD CONSTRAINT [FK_DataSourceTransformation_NewPhenomenonUOM] FOREIGN KEY ([NewPhenomenonUOMID]) REFERENCES [dbo].[PhenomenonUOM] ([ID]);


GO
PRINT N'Creating [dbo].[FK_DataSourceType_aspnet_Users]...';


GO
ALTER TABLE [dbo].[DataSourceType] WITH NOCHECK
    ADD CONSTRAINT [FK_DataSourceType_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Instrument_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Instrument] WITH NOCHECK
    ADD CONSTRAINT [FK_Instrument_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_PhenomenonOffering_Offering]...';


GO
ALTER TABLE [dbo].[PhenomenonOffering] WITH NOCHECK
    ADD CONSTRAINT [FK_PhenomenonOffering_Offering] FOREIGN KEY ([OfferingID]) REFERENCES [dbo].[Offering] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Offering_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Offering] WITH NOCHECK
    ADD CONSTRAINT [FK_Offering_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_OrganisationRole_aspnet_Users]...';


GO
ALTER TABLE [dbo].[OrganisationRole] WITH NOCHECK
    ADD CONSTRAINT [FK_OrganisationRole_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_PhenomenonOffering_Phenomenon]...';


GO
ALTER TABLE [dbo].[PhenomenonOffering] WITH NOCHECK
    ADD CONSTRAINT [FK_PhenomenonOffering_Phenomenon] FOREIGN KEY ([PhenomenonID]) REFERENCES [dbo].[Phenomenon] ([ID]);


GO
PRINT N'Creating [dbo].[FK_PhenomenonUOM_PhenomenonUOM]...';


GO
ALTER TABLE [dbo].[PhenomenonUOM] WITH NOCHECK
    ADD CONSTRAINT [FK_PhenomenonUOM_PhenomenonUOM] FOREIGN KEY ([PhenomenonID]) REFERENCES [dbo].[Phenomenon] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Sensor_Phenomenon]...';


GO
ALTER TABLE [dbo].[Sensor] WITH NOCHECK
    ADD CONSTRAINT [FK_Sensor_Phenomenon] FOREIGN KEY ([PhenomenonID]) REFERENCES [dbo].[Phenomenon] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Phenomenon_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Phenomenon] WITH NOCHECK
    ADD CONSTRAINT [FK_Phenomenon_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_PhenomenonOffering_aspnet_Users]...';


GO
ALTER TABLE [dbo].[PhenomenonOffering] WITH NOCHECK
    ADD CONSTRAINT [FK_PhenomenonOffering_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_PhenomenonUOM_aspnet_Users]...';


GO
ALTER TABLE [dbo].[PhenomenonUOM] WITH NOCHECK
    ADD CONSTRAINT [FK_PhenomenonUOM_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_PhenomenonUOM_UnitOfMeasure]...';


GO
ALTER TABLE [dbo].[PhenomenonUOM] WITH NOCHECK
    ADD CONSTRAINT [FK_PhenomenonUOM_UnitOfMeasure] FOREIGN KEY ([UnitOfMeasureID]) REFERENCES [dbo].[UnitOfMeasure] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Sensor_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Sensor] WITH NOCHECK
    ADD CONSTRAINT [FK_Sensor_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Sensor_Station]...';


GO
ALTER TABLE [dbo].[Sensor] WITH NOCHECK
    ADD CONSTRAINT [FK_Sensor_Station] FOREIGN KEY ([StationID]) REFERENCES [dbo].[Station] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Station_Site]...';


GO
ALTER TABLE [dbo].[Station] WITH NOCHECK
    ADD CONSTRAINT [FK_Station_Site] FOREIGN KEY ([SiteID]) REFERENCES [dbo].[Site] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Site_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Site] WITH NOCHECK
    ADD CONSTRAINT [FK_Site_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Station_ProjectSite]...';


GO
ALTER TABLE [dbo].[Station] WITH NOCHECK
    ADD CONSTRAINT [FK_Station_ProjectSite] FOREIGN KEY ([ProjectSiteID]) REFERENCES [dbo].[ProjectSite] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Station_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Station] WITH NOCHECK
    ADD CONSTRAINT [FK_Station_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Status_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Status] WITH NOCHECK
    ADD CONSTRAINT [FK_Status_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_TransformationType_aspnet_Users]...';


GO
ALTER TABLE [dbo].[TransformationType] WITH NOCHECK
    ADD CONSTRAINT [FK_TransformationType_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_UnitOfMeasure_aspnet_Users]...';


GO
ALTER TABLE [dbo].[UnitOfMeasure] WITH NOCHECK
    ADD CONSTRAINT [FK_UnitOfMeasure_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Instrument_DataSource_Instrument]...';


GO
ALTER TABLE [dbo].[Instrument_DataSource] WITH NOCHECK
    ADD CONSTRAINT [FK_Instrument_DataSource_Instrument] FOREIGN KEY ([InstrumentID]) REFERENCES [dbo].[Instrument] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Instrument_DataSource_DataSource]...';


GO
ALTER TABLE [dbo].[Instrument_DataSource] WITH NOCHECK
    ADD CONSTRAINT [FK_Instrument_DataSource_DataSource] FOREIGN KEY ([DataSourceID]) REFERENCES [dbo].[DataSource] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Instrument_DataSource_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Instrument_DataSource] WITH NOCHECK
    ADD CONSTRAINT [FK_Instrument_DataSource_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Instrument_Sensor_Instrument]...';


GO
ALTER TABLE [dbo].[Instrument_Sensor] WITH NOCHECK
    ADD CONSTRAINT [FK_Instrument_Sensor_Instrument] FOREIGN KEY ([InstrumentID]) REFERENCES [dbo].[Instrument] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Instrument_Sensor_Sensor]...';


GO
ALTER TABLE [dbo].[Instrument_Sensor] WITH NOCHECK
    ADD CONSTRAINT [FK_Instrument_Sensor_Sensor] FOREIGN KEY ([SensorID]) REFERENCES [dbo].[Sensor] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Instrument_Sensor_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Instrument_Sensor] WITH NOCHECK
    ADD CONSTRAINT [FK_Instrument_Sensor_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Organisation_Instrument_Organisation]...';


GO
ALTER TABLE [dbo].[Organisation_Instrument] WITH NOCHECK
    ADD CONSTRAINT [FK_Organisation_Instrument_Organisation] FOREIGN KEY ([OrganisationID]) REFERENCES [dbo].[Organisation] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Organisation_Instrument_Instrument]...';


GO
ALTER TABLE [dbo].[Organisation_Instrument] WITH NOCHECK
    ADD CONSTRAINT [FK_Organisation_Instrument_Instrument] FOREIGN KEY ([InstrumentID]) REFERENCES [dbo].[Instrument] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Organisation_Instrument_OrganisationRole]...';


GO
ALTER TABLE [dbo].[Organisation_Instrument] WITH NOCHECK
    ADD CONSTRAINT [FK_Organisation_Instrument_OrganisationRole] FOREIGN KEY ([OrganisationRoleID]) REFERENCES [dbo].[OrganisationRole] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Organisation_Instrument_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Organisation_Instrument] WITH NOCHECK
    ADD CONSTRAINT [FK_Organisation_Instrument_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Organisation_Site_Organisation]...';


GO
ALTER TABLE [dbo].[Organisation_Site] WITH NOCHECK
    ADD CONSTRAINT [FK_Organisation_Site_Organisation] FOREIGN KEY ([OrganisationID]) REFERENCES [dbo].[Organisation] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Organisation_Site_Site]...';


GO
ALTER TABLE [dbo].[Organisation_Site] WITH NOCHECK
    ADD CONSTRAINT [FK_Organisation_Site_Site] FOREIGN KEY ([SiteID]) REFERENCES [dbo].[Site] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Organisation_Site_OrganisationRole]...';


GO
ALTER TABLE [dbo].[Organisation_Site] WITH NOCHECK
    ADD CONSTRAINT [FK_Organisation_Site_OrganisationRole] FOREIGN KEY ([OrganisationRoleID]) REFERENCES [dbo].[OrganisationRole] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Organisation_Site_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Organisation_Site] WITH NOCHECK
    ADD CONSTRAINT [FK_Organisation_Site_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Organisation_Station_Organisation]...';


GO
ALTER TABLE [dbo].[Organisation_Station] WITH NOCHECK
    ADD CONSTRAINT [FK_Organisation_Station_Organisation] FOREIGN KEY ([OrganisationID]) REFERENCES [dbo].[Organisation] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Organisation_Station_Station]...';


GO
ALTER TABLE [dbo].[Organisation_Station] WITH NOCHECK
    ADD CONSTRAINT [FK_Organisation_Station_Station] FOREIGN KEY ([StationID]) REFERENCES [dbo].[Station] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Organisation_Station_OrganisationRole]...';


GO
ALTER TABLE [dbo].[Organisation_Station] WITH NOCHECK
    ADD CONSTRAINT [FK_Organisation_Station_OrganisationRole] FOREIGN KEY ([OrganisationRoleID]) REFERENCES [dbo].[OrganisationRole] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Organisation_Station_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Organisation_Station] WITH NOCHECK
    ADD CONSTRAINT [FK_Organisation_Station_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Programme_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Programme] WITH NOCHECK
    ADD CONSTRAINT [FK_Programme_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Progress_ImportBatch]...';


GO
ALTER TABLE [dbo].[Progress] WITH NOCHECK
    ADD CONSTRAINT [FK_Progress_ImportBatch] FOREIGN KEY ([ImportBatchID]) REFERENCES [dbo].[ImportBatch] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Progress_Sensor]...';


GO
ALTER TABLE [dbo].[Progress] WITH NOCHECK
    ADD CONSTRAINT [FK_Progress_Sensor] FOREIGN KEY ([SensorID]) REFERENCES [dbo].[Sensor] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Progress_PhenomenonOffering]...';


GO
ALTER TABLE [dbo].[Progress] WITH NOCHECK
    ADD CONSTRAINT [FK_Progress_PhenomenonOffering] FOREIGN KEY ([PhenomenonOfferingID]) REFERENCES [dbo].[PhenomenonOffering] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Progress_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Progress] WITH NOCHECK
    ADD CONSTRAINT [FK_Progress_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Project_Programme]...';


GO
ALTER TABLE [dbo].[Project] WITH NOCHECK
    ADD CONSTRAINT [FK_Project_Programme] FOREIGN KEY ([ProgrammeID]) REFERENCES [dbo].[Programme] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Project_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Project] WITH NOCHECK
    ADD CONSTRAINT [FK_Project_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Project_Station_ProjectID]...';


GO
ALTER TABLE [dbo].[Project_Station] WITH NOCHECK
    ADD CONSTRAINT [FK_Project_Station_ProjectID] FOREIGN KEY ([ProjectID]) REFERENCES [dbo].[Project] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Project_Station_StationID]...';


GO
ALTER TABLE [dbo].[Project_Station] WITH NOCHECK
    ADD CONSTRAINT [FK_Project_Station_StationID] FOREIGN KEY ([StationID]) REFERENCES [dbo].[Station] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Project_Station_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Project_Station] WITH NOCHECK
    ADD CONSTRAINT [FK_Project_Station_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_SchemaColumn_DataSchema]...';


GO
ALTER TABLE [dbo].[SchemaColumn] WITH NOCHECK
    ADD CONSTRAINT [FK_SchemaColumn_DataSchema] FOREIGN KEY ([DataSchemaID]) REFERENCES [dbo].[DataSchema] ([ID]);


GO
PRINT N'Creating [dbo].[FK_SchemaColumn_SchemaColumnType]...';


GO
ALTER TABLE [dbo].[SchemaColumn] WITH NOCHECK
    ADD CONSTRAINT [FK_SchemaColumn_SchemaColumnType] FOREIGN KEY ([SchemaColumnTypeID]) REFERENCES [dbo].[SchemaColumnType] ([ID]);


GO
PRINT N'Creating [dbo].[FK_SchemaColumn_Phenomenon]...';


GO
ALTER TABLE [dbo].[SchemaColumn] WITH NOCHECK
    ADD CONSTRAINT [FK_SchemaColumn_Phenomenon] FOREIGN KEY ([PhenomenonID]) REFERENCES [dbo].[Phenomenon] ([ID]);


GO
PRINT N'Creating [dbo].[FK_SchemaColumn_PhenomenonOffering]...';


GO
ALTER TABLE [dbo].[SchemaColumn] WITH NOCHECK
    ADD CONSTRAINT [FK_SchemaColumn_PhenomenonOffering] FOREIGN KEY ([PhenomenonOfferingID]) REFERENCES [dbo].[PhenomenonOffering] ([ID]);


GO
PRINT N'Creating [dbo].[FK_SchemaColumn_PhenomenonUOM]...';


GO
ALTER TABLE [dbo].[SchemaColumn] WITH NOCHECK
    ADD CONSTRAINT [FK_SchemaColumn_PhenomenonUOM] FOREIGN KEY ([PhenomenonUOMID]) REFERENCES [dbo].[PhenomenonUOM] ([ID]);


GO
PRINT N'Creating [dbo].[FK_SchemaColumn_aspnet_Users]...';


GO
ALTER TABLE [dbo].[SchemaColumn] WITH NOCHECK
    ADD CONSTRAINT [FK_SchemaColumn_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_SchemaColumnType_aspnet_Users]...';


GO
ALTER TABLE [dbo].[SchemaColumnType] WITH NOCHECK
    ADD CONSTRAINT [FK_SchemaColumnType_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Station_Instrument_Station]...';


GO
ALTER TABLE [dbo].[Station_Instrument] WITH NOCHECK
    ADD CONSTRAINT [FK_Station_Instrument_Station] FOREIGN KEY ([StationID]) REFERENCES [dbo].[Station] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Station_Instrument_Instrument]...';


GO
ALTER TABLE [dbo].[Station_Instrument] WITH NOCHECK
    ADD CONSTRAINT [FK_Station_Instrument_Instrument] FOREIGN KEY ([InstrumentID]) REFERENCES [dbo].[Instrument] ([ID]);


GO
PRINT N'Creating [dbo].[FK_Station_Instrument_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Station_Instrument] WITH NOCHECK
    ADD CONSTRAINT [FK_Station_Instrument_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_StatusReason_aspnet_Users]...';


GO
ALTER TABLE [dbo].[StatusReason] WITH NOCHECK
    ADD CONSTRAINT [FK_StatusReason_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[TR_DataLog_Insert]...';


GO
CREATE TRIGGER [dbo].[TR_DataLog_Insert] ON [dbo].[DataLog]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update 
        src 
    set 
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins 
        inner join DataLog src
            on (ins.ID = src.ID)
END
GO
PRINT N'Creating [dbo].[TR_DataLog_Update]...';


GO
CREATE TRIGGER [dbo].[TR_DataLog_Update] ON [dbo].[DataLog]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update 
        src 
    set 
        UpdatedAt = GETDATE()
    from
        inserted ins 
        inner join DataLog src
            on (ins.ID = src.ID)
END
--< Added 2.0.8 20160708 TimPN
GO
PRINT N'Creating [dbo].[TR_ImportBatch_Insert]...';


GO
CREATE TRIGGER [dbo].[TR_ImportBatch_Insert] ON [dbo].[ImportBatch]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update
        src
    set
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins
        inner join ImportBatch src
            on (ins.ID = src.ID)
END
GO
PRINT N'Creating [dbo].[TR_ImportBatch_Update]...';


GO
CREATE TRIGGER [dbo].[TR_ImportBatch_Update] ON [dbo].[ImportBatch]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update
        src
    set
        UpdatedAt = GETDATE()
    from
        inserted ins
        inner join ImportBatch src
            on (ins.ID = src.ID)
END
--< Added 2.0.8 20160715 TimPN
GO
PRINT N'Creating [dbo].[TR_Observation_Insert]...';


GO
CREATE TRIGGER [dbo].[TR_Observation_Insert] ON [dbo].[Observation]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update
        src
    set
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins
        inner join Observation src
            on (ins.ID = src.ID)
END
GO
PRINT N'Creating [dbo].[TR_Observation_Update]...';


GO
CREATE TRIGGER [dbo].[TR_Observation_Update] ON [dbo].[Observation]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update
        src
    set
        UpdatedAt = GETDATE()
    from
        inserted ins
        inner join Observation src
            on (ins.ID = src.ID)
END
--< Added 2.0.8 20160718 TimPN
GO
PRINT N'Creating [dbo].[TR_DataSchema_Insert]...';


GO
CREATE TRIGGER [dbo].[TR_DataSchema_Insert] ON [dbo].[DataSchema]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update 
        src 
    set 
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins 
        inner join DataSchema src
            on (ins.ID = src.ID)
END
GO
PRINT N'Creating [dbo].[TR_DataSchema_Update]...';


GO
CREATE TRIGGER [dbo].[TR_DataSchema_Update] ON [dbo].[DataSchema]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update 
        src 
    set 
        UpdatedAt = GETDATE()
    from
        inserted ins 
        inner join DataSchema src
            on (ins.ID = src.ID)
END
--< Added 2.0.8 20160715 TimPN
GO
PRINT N'Creating [dbo].[TR_DataSource_Insert]...';


GO
CREATE TRIGGER [dbo].[TR_DataSource_Insert] ON [dbo].[DataSource]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update
        src
    set
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins
        inner join DataSource src
            on (ins.ID = src.ID)
END
GO
PRINT N'Creating [dbo].[TR_DataSource_Update]...';


GO
CREATE TRIGGER [dbo].[TR_DataSource_Update] ON [dbo].[DataSource]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update
        src
    set
        UpdatedAt = GETDATE()
    from
        inserted ins
        inner join DataSource src
            on (ins.ID = src.ID)
END
--< Added 2.0.3 20160421 TimPN
GO
PRINT N'Creating [dbo].[TR_DataSourceRole_Insert]...';


GO
CREATE TRIGGER [dbo].[TR_DataSourceRole_Insert] ON [dbo].[DataSourceRole]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update
        src
    set
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins
        inner join DataSourceRole src
            on (ins.ID = src.ID)
END
GO
PRINT N'Creating [dbo].[TR_DataSourceRole_Update]...';


GO
CREATE TRIGGER [dbo].[TR_DataSourceRole_Update] ON [dbo].[DataSourceRole]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update
        src
    set
        UpdatedAt = GETDATE()
    from
        inserted ins
        inner join DataSourceRole src
            on (ins.ID = src.ID)
END
--< Added 2.0.8 20160715 TimPN
GO
PRINT N'Creating [dbo].[TR_DataSourceTransformation_Insert]...';


GO
CREATE TRIGGER [dbo].[TR_DataSourceTransformation_Insert] ON [dbo].[DataSourceTransformation]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update
        src
    set
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins
        inner join DataSourceTransformation src
            on (ins.ID = src.ID)
END
GO
PRINT N'Creating [dbo].[TR_DataSourceTransformation_Update]...';


GO
CREATE TRIGGER [dbo].[TR_DataSourceTransformation_Update] ON [dbo].[DataSourceTransformation]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update
        src
    set
        UpdatedAt = GETDATE()
    from
        inserted ins
        inner join DataSourceTransformation src
            on (ins.ID = src.ID)
END
--< Added 2.0.8 20160715 TimPN
GO
PRINT N'Creating [dbo].[TR_DataSourceType_Insert]...';


GO
CREATE TRIGGER [dbo].[TR_DataSourceType_Insert] ON [dbo].[DataSourceType]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update
        src
    set
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins
        inner join DataSourceType src
            on (ins.ID = src.ID)
END
GO
PRINT N'Creating [dbo].[TR_DataSourceType_Update]...';


GO
CREATE TRIGGER [dbo].[TR_DataSourceType_Update] ON [dbo].[DataSourceType]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update
        src
    set
        UpdatedAt = GETDATE()
    from
        inserted ins
        inner join DataSourceType src
            on (ins.ID = src.ID)
END
--< Added 2.0.8 20160715 TimPN
GO
PRINT N'Creating [dbo].[TR_Instrument_Insert]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_Instrument_Insert] ON [dbo].[Instrument]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update 
        src 
    set 
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins 
        inner join Instrument src
            on (ins.ID = src.ID)
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_Instrument_Update]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_Instrument_Update] ON [dbo].[Instrument]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update 
        src 
    set 
        UpdatedAt = GETDATE()
    from
        inserted ins 
        inner join Instrument src
            on (ins.ID = src.ID)
END
--< Added 2.0.4 20160508 TimPN
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_Offering_Insert]...';


GO
CREATE TRIGGER [dbo].[TR_Offering_Insert] ON [dbo].[Offering]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update
        src
    set
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins
        inner join Offering src
            on (ins.ID = src.ID)
END
GO
PRINT N'Creating [dbo].[TR_Offering_Update]...';


GO
CREATE TRIGGER [dbo].[TR_Offering_Update] ON [dbo].[Offering]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update
        src
    set
        UpdatedAt = GETDATE()
    from
        inserted ins
        inner join Offering src
            on (ins.ID = src.ID)
END
--< Added 2.0.8 20160718 TimPN
GO
PRINT N'Creating [dbo].[TR_OrganisationRole]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_OrganisationRole] ON [dbo].[OrganisationRole]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update
        src
    set
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins
        inner join OrganisationRole src
            on (ins.ID = src.ID)
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_OrganisationRole_Update]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_OrganisationRole_Update] ON [dbo].[OrganisationRole]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update
        src
    set
        UpdatedAt = GETDATE()
    from
        inserted ins
        inner join OrganisationRole src
            on (ins.ID = src.ID)
END
--< Added 2.0.8 20160718 TimPN
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_Phenomenon_Insert]...';


GO
CREATE TRIGGER [dbo].[TR_Phenomenon_Insert] ON [dbo].[Phenomenon]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update
        src
    set
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins
        inner join Phenomenon src
            on (ins.ID = src.ID)
END
GO
PRINT N'Creating [dbo].[TR_Phenomenon_Update]...';


GO
CREATE TRIGGER [dbo].[TR_Phenomenon_Update] ON [dbo].[Phenomenon]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update
        src
    set
        UpdatedAt = GETDATE()
    from
        inserted ins
        inner join Phenomenon src
            on (ins.ID = src.ID)
END
--< Added 2.0.8 20160718 TimPN
GO
PRINT N'Creating [dbo].[TR_PhenomenonOffering_Insert]...';


GO
CREATE TRIGGER [dbo].[TR_PhenomenonOffering_Insert] ON [dbo].[PhenomenonOffering]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update
        src
    set
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins
        inner join PhenomenonOffering src
            on (ins.ID = src.ID)
END
GO
PRINT N'Creating [dbo].[TR_PhenomenonOffering_Update]...';


GO
CREATE TRIGGER [dbo].[TR_PhenomenonOffering_Update] ON [dbo].[PhenomenonOffering]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update
        src
    set
        UpdatedAt = GETDATE()
    from
        inserted ins
        inner join PhenomenonOffering src
            on (ins.ID = src.ID)
END
--< Added 2.0.8 20160718 TimPN
GO
PRINT N'Creating [dbo].[TR_PhenomenonUPM_Insert]...';


GO
CREATE TRIGGER [dbo].[TR_PhenomenonUPM_Insert] ON [dbo].[PhenomenonUOM]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update
        src
    set
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins
        inner join PhenomenonUOM src
            on (ins.ID = src.ID)
END
GO
PRINT N'Creating [dbo].[TR_PhenomenonUOM_Update]...';


GO
CREATE TRIGGER [dbo].[TR_PhenomenonUOM_Update] ON [dbo].[PhenomenonUOM]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update
        src
    set
        UpdatedAt = GETDATE()
    from
        inserted ins
        inner join PhenomenonUOM src
            on (ins.ID = src.ID)
END
--< Added 2.0.8 20160718 TimPN
GO
PRINT N'Creating [dbo].[TR_Sensor_Insert]...';


GO
CREATE TRIGGER [dbo].[TR_Sensor_Insert] ON [dbo].[Sensor]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update
        src
    set
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins
        inner join Sensor src
            on (ins.ID = src.ID)
END
GO
PRINT N'Creating [dbo].[TR_Sensor_Update]...';


GO
CREATE TRIGGER [dbo].[TR_Sensor_Update] ON [dbo].[Sensor]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update
        src
    set
        UpdatedAt = GETDATE()
    from
        inserted ins
        inner join Sensor src
            on (ins.ID = src.ID)
END
--< Added 2.0.8 20160718 TimPN
GO
PRINT N'Creating [dbo].[TR_Site_Insert]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_Site_Insert] ON [dbo].[Site]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update 
        src 
    set 
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins 
        inner join Site src
            on (ins.ID = src.ID)
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_Site_Update]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_Site_Update] ON [dbo].[Site]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update 
        src 
    set 
        UpdatedAt = GETDATE()
    from
        inserted ins 
        inner join Site src
            on (ins.ID = src.ID)
END
--< Added 2.0.3 20160421 TimPN
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_Station_Insert]...';


GO
CREATE TRIGGER [dbo].[TR_Station_Insert] ON [dbo].[Station]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update
        src
    set
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins
        inner join Station src
            on (ins.ID = src.ID)
END
GO
PRINT N'Creating [dbo].[TR_Station_Update]...';


GO
CREATE TRIGGER [dbo].[TR_Station_Update] ON [dbo].[Station]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update
        src
    set
        UpdatedAt = GETDATE()
    from
        inserted ins
        inner join Station src
            on (ins.ID = src.ID)
END
--< Added 2.0.3 20160421 TimPN
GO
PRINT N'Creating [dbo].[TR_Status_Insert]...';


GO
CREATE TRIGGER [dbo].[TR_Status_Insert] ON [dbo].[Status]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update
        src
    set
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins
        inner join Status src
            on (ins.ID = src.ID)
END
GO
PRINT N'Creating [dbo].[TR_Status_Update]...';


GO
CREATE TRIGGER [dbo].[TR_Status_Update] ON [dbo].[Status]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update
        src
    set
        UpdatedAt = GETDATE()
    from
        inserted ins
        inner join Status src
            on (ins.ID = src.ID)
END
--< Added 2.0.8 20160718 TimPN
GO
PRINT N'Creating [dbo].[TR_TransformationType_Insert]...';


GO
CREATE TRIGGER [dbo].[TR_TransformationType_Insert] ON [dbo].[TransformationType]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update
        src
    set
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins
        inner join TransformationType src
            on (ins.ID = src.ID)
END
GO
PRINT N'Creating [dbo].[TR_TransformationType_Update]...';


GO
CREATE TRIGGER [dbo].[TR_TransformationType_Update] ON [dbo].[TransformationType]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update
        src
    set
        UpdatedAt = GETDATE()
    from
        inserted ins
        inner join TransformationType src
            on (ins.ID = src.ID)
END
--< Added 2.0.8 20160718 TimPN
GO
PRINT N'Creating [dbo].[TR_UnitOfMeasure_Insert]...';


GO
CREATE TRIGGER [dbo].[TR_UnitOfMeasure_Insert] ON [dbo].[UnitOfMeasure]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update
        src
    set
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins
        inner join UnitOfMeasure src
            on (ins.ID = src.ID)
END
GO
PRINT N'Creating [dbo].[TR_UnitOfMeasure_Update]...';


GO
CREATE TRIGGER [dbo].[TR_UnitOfMeasure_Update] ON [dbo].[UnitOfMeasure]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update
        src
    set
        UpdatedAt = GETDATE()
    from
        inserted ins
        inner join UnitOfMeasure src
            on (ins.ID = src.ID)
END
--< Added 2.0.8 20160718 TimPN
GO
PRINT N'Creating [dbo].[TR_Instrument_DataSource_Insert]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_Instrument_DataSource_Insert] ON [dbo].[Instrument_DataSource]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update
        src
    set
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins
        inner join Instrument_DataSource src
            on (ins.ID = src.ID)
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_Instrument_DataSource_Update]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_Instrument_DataSource_Update] ON [dbo].[Instrument_DataSource]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update
        src
    set
        UpdatedAt = GETDATE()
    from
        inserted ins
        inner join Instrument_DataSource src
            on (ins.ID = src.ID)
END
--< Added 2.0.9 20160727 TimPN
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_Instrument_Sensor_Insert]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_Instrument_Sensor_Insert] ON [dbo].[Instrument_Sensor]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update
        src
    set
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins
        inner join Instrument_Sensor src
            on (ins.ID = src.ID)
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_Instrument_Sensor_Update]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_Instrument_Sensor_Update] ON [dbo].[Instrument_Sensor]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update
        src
    set
        UpdatedAt = GETDATE()
    from
        inserted ins
        inner join Instrument_Sensor src
            on (ins.ID = src.ID)
END
--> Added 2.0.5 20160530 TimPN
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_Organisation_Instrument_Insert]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_Organisation_Instrument_Insert] ON [dbo].[Organisation_Instrument]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update
        src
    set
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins
        inner join Organisation_Instrument src
            on (ins.ID = src.ID)
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_Organisation_Instrument_Update]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_Organisation_Instrument_Update] ON [dbo].[Organisation_Instrument]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update
        src
    set
        UpdatedAt = GETDATE()
    from
        inserted ins
        inner join Organisation_Instrument src
            on (ins.ID = src.ID)
END
--< Added 2.0.5 20160530 TimPN
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_Organisation_Site_Insert]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_Organisation_Site_Insert] ON [dbo].[Organisation_Site]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update
        src
    set
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins
        inner join Organisation_Site src
            on (ins.ID = src.ID)
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_Organisation_Site_Update]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_Organisation_Site_Update] ON [dbo].[Organisation_Site]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update
        src
    set
        UpdatedAt = GETDATE()
    from
        inserted ins
        inner join Organisation_Site src
            on (ins.ID = src.ID)
END
--< Added 2.0.5 20160530 TimPN
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_Organisation_Station_Insert]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_Organisation_Station_Insert] ON [dbo].[Organisation_Station]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update
        src
    set
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins
        inner join Organisation_Station src
            on (ins.ID = src.ID)
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_Organisation_Station_Update]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_Organisation_Station_Update] ON [dbo].[Organisation_Station]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update
        src
    set
        UpdatedAt = GETDATE()
    from
        inserted ins
        inner join Organisation_Station src
            on (ins.ID = src.ID)
END
--< Added 2.0.5 20160530 TimPN
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_Programme_Insert]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_Programme_Insert] ON [dbo].[Programme]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update 
        src 
    set 
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins 
        inner join Programme src
            on (ins.ID = src.ID)
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_Programme_Update]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_Programme_Update] ON [dbo].[Programme]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update 
        src 
    set 
        UpdatedAt = GETDATE()
    from
        inserted ins 
        inner join Programme src
            on (ins.ID = src.ID)
END
--< Added 2.0.5 20160511 TimPN
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_Project_Insert]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_Project_Insert] ON [dbo].[Project]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update 
        src 
    set 
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins 
        inner join Project src
            on (ins.ID = src.ID)
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_Project_Update]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_Project_Update] ON [dbo].[Project]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update 
        src 
    set 
        UpdatedAt = GETDATE()
    from
        inserted ins 
        inner join Project src
            on (ins.ID = src.ID)
END
--< Added 2.0.5 20160511 TimPN
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_Project_Station_Insert]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_Project_Station_Insert] ON [dbo].[Project_Station]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update 
        src 
    set 
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins 
        inner join Project_Station src
            on (ins.ID = src.ID)
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_Project_Station_Update]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_Project_Station_Update] ON [dbo].[Project_Station]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update 
        src 
    set 
        UpdatedAt = GETDATE()
    from
        inserted ins 
        inner join Project_Station src
            on (ins.ID = src.ID)
END
--< Added 2.0.5 20160527 TimPN
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_SchemaColumn_Insert]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_SchemaColumn_Insert] ON [dbo].[SchemaColumn]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update
        src
    set
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins
        inner join SchemaColumn src
            on (ins.ID = src.ID)
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_SchemaColumn_Update]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_SchemaColumn_Update] ON [dbo].[SchemaColumn]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update
        src
    set
        UpdatedAt = GETDATE()
    from
        inserted ins
        inner join SchemaColumn src
            on (ins.ID = src.ID)
END
--< Added 2.0.11 20160908 TimPN
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_SchemaColumnType_Insert]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_SchemaColumnType_Insert] ON [dbo].[SchemaColumnType]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update
        src
    set
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins
        inner join SchemaColumnType src
            on (ins.ID = src.ID)
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_SchemaColumnType_Update]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_SchemaColumnType_Update] ON [dbo].[SchemaColumnType]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update
        src
    set
        UpdatedAt = GETDATE()
    from
        inserted ins
        inner join SchemaColumnType src
            on (ins.ID = src.ID)
END
--< Added 2.0.11 20160908 TimPN
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_Station_Instrument_Insert]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_Station_Instrument_Insert] ON [dbo].[Station_Instrument]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update
        src
    set
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins
        inner join Station_Instrument src
            on (ins.ID = src.ID)
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_Station_Instrument_Update]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_Station_Instrument_Update] ON [dbo].[Station_Instrument]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update
        src
    set
        UpdatedAt = GETDATE()
    from
        inserted ins
        inner join Station_Instrument src
            on (ins.ID = src.ID)
END
--< Added 2.0.5 20160512 TimPN
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_StatusReason_Insert]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_StatusReason_Insert] ON [dbo].[StatusReason]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update
        src
    set
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins
        inner join StatusReason src
            on (ins.ID = src.ID)
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_StatusReason_Update]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_StatusReason_Update] ON [dbo].[StatusReason]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update
        src
    set
        UpdatedAt = GETDATE()
    from
        inserted ins
        inner join StatusReason src
            on (ins.ID = src.ID)
END
--> Added 2.0.9 20160823 TimPN
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_AuditLog_Insert]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_AuditLog_Insert] ON [dbo].[AuditLog]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update 
        src 
    set 
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins 
        inner join AuditLog src
            on (ins.ID = src.ID)
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_AuditLog_Update]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE TRIGGER [dbo].[TR_AuditLog_Update] ON [dbo].[AuditLog]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    if UPDATE(UpdatedAt) RAISERROR ('Cannot update UpdatedAt.', 16, 1)
    if not UPDATE(AddedAt) and not UPDATE(UpdatedAt)
        Update 
            src 
        set 
            UpdatedAt = GETDATE()
        from
            inserted ins 
            inner join AuditLog src
                on (ins.ID = src.ID)
END
--< Added 2.0.3 20160421 TimPN
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[TR_Organisation_Insert]...';


GO
CREATE TRIGGER [dbo].[TR_Organisation_Insert] ON [dbo].[Organisation]
FOR INSERT
AS
BEGIN
    SET NoCount ON
    Update 
        src 
    set 
        AddedAt = GETDATE(),
        UpdatedAt = NULL
    from
        inserted ins 
        inner join Organisation src
            on (ins.ID = src.ID)
END
GO
PRINT N'Creating [dbo].[TR_Organisation_Update]...';


GO
CREATE TRIGGER [dbo].[TR_Organisation_Update] ON [dbo].[Organisation]
FOR UPDATE
AS
BEGIN
    SET NoCount ON
    --if UPDATE(AddedAt) RAISERROR ('Cannot update AddedAt.', 16, 1)
    Update 
        src 
    set 
        UpdatedAt = GETDATE()
    from
        inserted ins 
        inner join Organisation src
            on (ins.ID = src.ID)
END
--< Added 2.0.4 20160508 TimPN
GO
PRINT N'Altering [dbo].[vDataLog]...';


GO
--> Changed 2.0.3 20160503 TimPN
--Renamed SensorProcedure to Sensor
--< Changed 2.0.3 20160503 TimPN
ALTER VIEW [dbo].[vDataLog]
AS

SELECT 
d.ID, 
d.ImportDate,

org.Name Organisation,
ps.[Description] ProjectSite,
st.Name StationName,
d.SensorID,
sp.Name SensorName,
CASE 
    WHEN d.SensorID is null then 1
    ELSE 0
END SensorInvalid,

d.ValueDate,
d.InvalidDateValue, 
CASE 
    WHEN ValueDate is null then 1
    ELSE 0
END DateValueInvalid,

d.InvalidTimeValue, 
CASE 
    WHEN InvalidTimeValue is not null then 1
    ELSE 0
END TimeValueInvalid,

CASE 
    WHEN InvalidDateValue is null AND InvalidTimeValue IS NULL Then ValueDate
    WHEN ValueTime is not null then ValueTime 
END ValueTime,


d.RawValue,
d.ValueText,
CASE
    WHEN d.RawValue is null then 1
    ELSE 0
END RawValueInvalid,	

d.DataValue,
d.TransformValueText, 
CASE
    WHEN d.DataValue is null then 1
    ELSE 0
END DataValueInvalid,

d.PhenomenonOfferingID, 
CASE
    WHEN d.PhenomenonOfferingID is null then 1
    ELSE 0
END OfferingInvalid,

--> Changed 2.0.3 20160421 TimPN
--d.PhenonmenonUOMID, 
d.PhenomenonUOMID, 
--< Changed 2.0.3 20160421 TimPN
CASE
--> Changed 2.0.3 20160421 TimPN
--    WHEN d.PhenonmenonUOMID is null then 1
    WHEN d.PhenomenonUOMID is null then 1
--< Changed 2.0.3 20160421 TimPN
    ELSE 0
END UOMInvalid,

p.Name PhenomenonName,
o.Name OfferingName,
uom.Unit,

d.DataSourceTransformationID,
tt.Name Transformation,
d.StatusID,
s.Name [Status],
d.ImportBatchID,
d.RawFieldValue,
d.Comment

FROM DataLog d
LEFT JOIN Sensor sp
    on d.SensorID = sp.ID
LEFT JOIN Station st
    on sp.StationID = st.ID
LEFT JOIN ProjectSite ps
    on st.ProjectSiteID = ps.ID
LEFT JOIN Organisation org
    on ps.OrganisationID = org.ID
LEFT JOIN PhenomenonOffering po
 ON d.PhenomenonOfferingID = po.ID
LEFT JOIN Phenomenon p
    on po.PhenomenonID = p.ID
LEFT JOIN Offering o
    on po.OfferingID = o.ID
LEFT JOIN PhenomenonUOM pu
--> Changed 2.0.3 20160421 TimPN
--    on d.PhenonmenonUOMID = pu.ID
    on d.PhenomenonUOMID = pu.ID
--< Changed 2.0.3 20160421 TimPN
LEFT JOIN UnitOfMeasure uom
    on pu.UnitOfMeasureID = uom.ID
LEFT JOIN DataSourceTransformation ds
    on d.DataSourceTransformationID = ds.ID
LEFT JOIN TransformationType tt
    on ds.TransformationTypeID = tt.ID
INNER JOIN [Status] s
    on d.StatusID = s.ID
GO
PRINT N'Refreshing [dbo].[vDataSchema]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[vDataSchema]';


GO
PRINT N'Refreshing [dbo].[vDataSource]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[vDataSource]';


GO
PRINT N'Altering [dbo].[vObservation]...';


GO
--> Changed 2.0.3 20160503 TimPN
--Renamed SensorProcedure to Sensor
--< Changed 2.0.3 20160503 TimPN
ALTER VIEW [dbo].[vObservation]
AS
--> Changed 2.0.3 20160421 TimPN
--SELECT     o.ID, o.SensorID, o.PhenonmenonOfferingID, o.PhenonmenonUOMID, o.UserId, o.RawValue, o.DataValue, o.ImportBatchID, o.ValueDate, 
SELECT     o.ID, o.SensorID, o.PhenomenonOfferingID, o.PhenomenonUOMID, o.UserId, o.RawValue, o.DataValue, o.ImportBatchID, o.ValueDate, 
--< Changed 2.0.3 20160421 TimPN
                      sp.Code AS spCode, sp.Description AS spDesc, sp.Name AS spName, sp.Url AS spURL, sp.DataSchemaID, sp.DataSourceID, sp.PhenomenonID, sp.StationID, 
                      ph.Name AS phName, st.Name AS stName, ds.Name AS dsName, ISNULL(dschema.Name,dschema1.Name) AS dschemaName, offer.Name AS offName, offer.ID AS offID, ps.Name AS psName, 
                      ps.ID AS psID, org.Name AS orgName, org.ID AS orgID, uom.Unit AS uomUnit, uom.UnitSymbol AS uomSymbol, users.UserName,
                      o.Comment
FROM         dbo.Observation AS o INNER JOIN
                      dbo.Sensor AS sp ON sp.ID = o.SensorID INNER JOIN
                      dbo.Phenomenon AS ph ON ph.ID = sp.PhenomenonID INNER JOIN
--> Changed 2.0.3 20160421 TimPN
--                      dbo.PhenomenonOffering AS phOff ON phOff.ID = o.PhenonmenonOfferingID INNER JOIN  
                      dbo.PhenomenonOffering AS phOff ON phOff.ID = o.PhenomenonOfferingID INNER JOIN  
--< Changed 2.0.3 20160421 TimPN
                      dbo.Offering AS offer ON offer.ID = phOff.OfferingID INNER JOIN
--> Changed 2.0.3 20160421 TimPN
--                      dbo.PhenomenonUOM AS puom ON puom.ID = o.PhenonmenonUOMID INNER JOIN
                      dbo.PhenomenonUOM AS puom ON puom.ID = o.PhenomenonUOMID INNER JOIN
--< Changed 2.0.3 20160421 TimPN
                      dbo.Station AS st ON st.ID = sp.StationID INNER JOIN
                      dbo.DataSource AS ds ON ds.ID = sp.DataSourceID LEFT JOIN
                      dbo.DataSchema AS dschema1 ON dschema1.ID = ds.DataSchemaID LEFT JOIN
                      dbo.DataSchema AS dschema ON dschema.ID = sp.DataSchemaID INNER JOIN                   
                      dbo.ProjectSite AS ps ON ps.ID = st.ProjectSiteID INNER JOIN
                      dbo.Organisation AS org ON org.ID = ps.OrganisationID INNER JOIN
                      dbo.UnitOfMeasure AS uom ON uom.ID = puom.UnitOfMeasureID INNER JOIN
                      dbo.aspnet_Users AS users ON users.UserId = o.UserId
GO
PRINT N'Altering [dbo].[vSensor]...';


GO
--> Changed 2.0.3 20160503 TimPN
--Renamed SensorProcedure to Sensor
--< Changed 2.0.3 20160503 TimPN
ALTER VIEW [dbo].[vSensor]
AS
SELECT 
s.ID,
s.Code,
s.Name,
s.[Description],
s.Url,
s.StationID,
s.DataSourceID,
s.PhenomenonID,
--> Added 2.0.7 20160609 TimPN
  [Phenomenon].Name PhenomenonName,
--< Added 2.0.7 20160609 TimPN
s.UserId,
st.Name AS StationName,
d.Name AS DataSourceName,
ds.[Description] DataSchemaName
FROM Sensor s
INNER JOIN DataSource d
    on s.DataSourceID = d.ID
INNER JOIN Station st
    on s.StationID = st.ID
LEFT JOIN DataSchema ds
    on s.DataSchemaID = ds.ID
--> Added 2.0.7 20160609 TimPN
  inner join [Phenomenon]
    on (s.PhenomenonID = [Phenomenon].ID)
--< Added 2.0.7 20160609 TimPN
GO
PRINT N'Altering [dbo].[vObservationRoles]...';


GO
--> Changed 2.0.3 20160503 TimPN
--Renamed SensorProcedure to Sensor
--< Changed 2.0.3 20160503 TimPN
ALTER VIEW [dbo].[vObservationRoles]
AS
--> Changed 2.0.3 20160421 TimPN
--SELECT     vo.ID, vo.SensorID, vo.PhenonmenonOfferingID, vo.PhenonmenonUOMID, vo.UserId, vo.RawValue, vo.DataValue, vo.ImportBatchID, vo.ValueDate, 
SELECT     vo.ID, vo.SensorID, vo.PhenomenonOfferingID, vo.PhenomenonUOMID, vo.UserId, vo.RawValue, vo.DataValue, vo.ImportBatchID, vo.ValueDate, 
--> Changed 2.0.3 20160421 TimPN
                      vo.spCode, vo.spDesc, vo.spName, vo.spURL, vo.DataSchemaID, vo.DataSourceID, vo.PhenomenonID, vo.StationID, vo.phName, vo.stName, vo.dsName, 
                      vo.dschemaName, vo.offName, vo.offID, vo.psName, vo.psID, vo.orgName, vo.orgID, vo.uomUnit, vo.uomSymbol, vo.UserName,
                      dr.DataSourceID AS Expr2, dr.DateStart, dr.DateEnd,
                      ur.UserId AS Expr5, vo.Comment
FROM         dbo.vObservation AS vo 
INNER JOIN 
(
 SELECT dr.DataSourceID,
        ur.UserId,
        MIN(dr.DateStart) DateStart,
        MAX(dr.DateEnd) DateEnd
 FROM DataSourceRole dr
 INNER JOIN    dbo.aspnet_Roles AS ar ON dr.RoleId = ar.RoleId INNER JOIN
               dbo.aspnet_UsersInRoles AS ur ON ar.RoleId = ur.RoleId
 GROUP By dr.DataSourceID,ur.UserId
) dr
ON vo.DataSourceID = dr.DataSourceID 
AND vo.ValueDate >= dr.DateStart AND vo.ValueDate <= dr.DateEnd
INNER JOIN aspnet_Users ur
 ON dr.UserId = ur.UserId
GO
PRINT N'Refreshing [dbo].[vDataSourceTransformation]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[vDataSourceTransformation]';


GO
PRINT N'Altering [dbo].[progress_Progress_Resolved]...';


GO
--> Changed 2.0.3 20160503 TimPN
--Renamed SensorProcedure to Sensor
--< Changed 2.0.3 20160503 TimPN
ALTER VIEW dbo.progress_Progress_Resolved
AS
SELECT     dbo.ImportBatch.ImportDate, dbo.ImportBatch.FileName, dbo.Progress.StartDate, dbo.Progress.EndDate, dbo.Progress.Observations, dbo.Progress.DateUploaded, 
                      dbo.aspnet_Users.UserName, dbo.Sensor.Name AS Sensor, dbo.Sensor.StationID, dbo.Station.Name AS Station
FROM         dbo.Sensor FULL OUTER JOIN
                      dbo.Station ON dbo.Sensor.StationID = dbo.Station.ID FULL OUTER JOIN
                      dbo.Progress LEFT OUTER JOIN
                      dbo.aspnet_Users ON dbo.Progress.UserId = dbo.aspnet_Users.UserId LEFT OUTER JOIN
                      dbo.ImportBatch ON dbo.Progress.ImportBatchID = dbo.ImportBatch.ID ON dbo.Sensor.ID = dbo.Progress.SensorID
GO
PRINT N'Refreshing [dbo].[vImportBatch]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[vImportBatch]';


GO
PRINT N'Altering [dbo].[vInventory]...';


GO
--> Changed 2.0.3 20160503 TimPN
--Renamed SensorProcedure to Sensor
--< Changed 2.0.3 20160503 TimPN
ALTER VIEW [dbo].[vInventory]
AS
Select 
 ps.Name Site,
 s.Name Station,
 sp.Name Sensor,
 p.Name Phenomenon,
 d.StartDate,
 d.EndDate
FROM Station s with (nolock)
 INNER Join ProjectSite ps with (nolock)
 on  ps.ID=  s.ProjectSiteID
INNER Join Sensor sp with (nolock)
 on s.ID = sp.StationID
INNER Join Phenomenon p with (nolock)
 on  sp.PhenomenonID = p.ID 

INNER JOIN 
(
 SELECT SensorID,MIN(ValueDate) StartDate,MAX(ValueDate) EndDate
  FROM Observation with (nolock)
 Group By SensorID
)d
ON sp.ID = d.SensorID
GO
PRINT N'Altering [dbo].[vDataQuery]...';


GO
--> Changed 2.0.3 20160503 TimPN
--Renamed SensorProcedure to Sensor
--< Changed 2.0.3 20160503 TimPN
ALTER VIEW [dbo].[vDataQuery]
AS
SELECT     TOP (100) PERCENT NEWID() AS ID, dbo.Organisation.ID AS OrganisationID, dbo.Organisation.Name AS Organisation, 
                      dbo.Organisation.Description AS OrganisationDesc, dbo.ProjectSite.ID AS ProjectSiteID, dbo.ProjectSite.Name AS ProjectSite, 
                      dbo.ProjectSite.Description AS ProjectSiteDesc, dbo.Station.ID AS StationID, dbo.Station.Name AS Station, dbo.Station.Description AS StationDesc, 
                      dbo.Sensor.ID AS SensorID, dbo.Sensor.Name AS Sensor, dbo.Sensor.Description AS SensorDesc, 
                      dbo.Phenomenon.ID AS PhenomenonID, dbo.Phenomenon.Name AS Phenomenon, dbo.Phenomenon.Description AS PhenomenonDesc, dbo.Offering.ID AS OfferingID, 
                      dbo.Offering.Name AS Offering, dbo.Offering.Description AS OfferingDesc
FROM         dbo.Station INNER JOIN
                      dbo.Sensor ON dbo.Sensor.StationID = dbo.Station.ID INNER JOIN
                      dbo.Phenomenon ON dbo.Phenomenon.ID = dbo.Sensor.PhenomenonID INNER JOIN
                      dbo.PhenomenonOffering ON dbo.PhenomenonOffering.PhenomenonID = dbo.Phenomenon.ID INNER JOIN
                      dbo.Offering ON dbo.Offering.ID = dbo.PhenomenonOffering.OfferingID INNER JOIN
                      dbo.ProjectSite ON dbo.ProjectSite.ID = dbo.Station.ProjectSiteID INNER JOIN
                      dbo.Organisation ON dbo.Organisation.ID = dbo.ProjectSite.OrganisationID
ORDER BY Organisation, ProjectSite, Station, Sensor, Phenomenon, Offering
GO
PRINT N'Altering [dbo].[vInstrumentOrganisation]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
--> Added 2.0.6 20160607 TimPN
ALTER VIEW [dbo].[vInstrumentOrganisation]
AS
Select
  [Organisation_Site].ID,
  OrganisationID,
  [Organisation].Code OrganisationCode,
  [Organisation].Name OrganisationName,
  [Instrument].ID InstrumentID,
  [Instrument].Code InstrumentCode,
  [Instrument].Name InstrumentName,
  OrganisationRoleID, 
  [OrganisationRole].Code OrganisationRoleCode,
  [OrganisationRole].Name OrganisationRoleName,
  [Organisation_Site].StartDate,
  [Organisation_Site].EndDate,
  'Site' [Level],
  [Site].Code LevelCode,
  [Site].Name LevelName,
  0 [Weight],
  CAST(1 as bit) [IsReadOnly]
from
  [Organisation_Site]
  inner join [Site]
    on ([Organisation_Site].SiteID = [Site].ID)
  inner join [Organisation]
    on ([Organisation_Site].OrganisationID = [Organisation].ID)
  inner join [Station] 
    on ([Organisation_Site].SiteID = [Station].SiteID)
  inner join [Station_Instrument]
    on ([Station_Instrument].StationID = [Station].ID)
  inner join [Instrument]
    on ([Station_Instrument].InstrumentID = [Instrument].ID)
  inner join [OrganisationRole]
    on ([Organisation_Site].OrganisationRoleID = [OrganisationRole].ID)
union
Select 
  [Organisation_Station].ID,
  OrganisationID,
  [Organisation].Code OrganisationCode,
  [Organisation].Name OrganisationName,
  InstrumentID,
  [Instrument].Code InstrumentCode,
  [Instrument].Name InstrumentName,
  OrganisationRoleID,
  [OrganisationRole].Code OrganisationRoleCode,
  [OrganisationRole].Name OrganisationRoleName,
  [Organisation_Station].StartDate,
  [Organisation_Station].EndDate,
  'Station' [Level],
  [Station].Code LevelCode,
  [Station].Name LevelName,
  1 [Weight],
  CAST(1 as bit) [IsReadOnly]
from 
  [Organisation_Station]
  inner join [Station] 
    on ([Organisation_Station].StationID = [Station].ID)
  inner join [Station_Instrument]
    on ([Organisation_Station].StationID = [Station_Instrument].StationID)
  inner join Instrument
    on ([Station_Instrument].InstrumentID = [Instrument].ID)
  inner join [Organisation]
    on ([Organisation_Station].OrganisationID = [Organisation].ID)
  inner join [OrganisationRole]
    on ([Organisation_Station].OrganisationRoleID = [OrganisationRole].ID)
union
Select
  [Organisation_Instrument].ID,
  OrganisationID,
  [Organisation].Code OrganisationCode,
  [Organisation].Name OrganisationName,
  InstrumentID,
  [Instrument].Code InstrumentCode,
  [Instrument].Name InstrumentName,
  OrganisationRoleID,
  [OrganisationRole].Code OrganisationRoleCode,
  [OrganisationRole].Name OrganisationRoleName,
  [Organisation_Instrument].StartDate,
  [Organisation_Instrument].EndDate,
  'Instrument' [Level],
  [Instrument].Code LevelCode,
  [Instrument].Name LevelName,
  2 [Weight],
  CAST(0 as bit) [IsReadOnly]
from
  [Organisation_Instrument]
  inner join [Instrument]
    on ( [Organisation_Instrument].InstrumentID = [Instrument].ID)
  inner join [Organisation]
    on ( [Organisation_Instrument].OrganisationID = [Organisation].ID)
  inner join [OrganisationRole]
    on ( [Organisation_Instrument].OrganisationRoleID = [OrganisationRole].ID)
--< Added 2.0.6 20160607 TimPN
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Altering [dbo].[vSiteOrganisation]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
--> Added 2.0.6 20160607 TimPN
ALTER VIEW [dbo].[vSiteOrganisation]
AS 
Select
  [Organisation_Site].ID,
  OrganisationID,
  [Organisation].Code OrganisationCode,
  [Organisation].Name OrganisationName,
  SiteID,
  [Site].Code SiteCode,
  [Site].Name SiteName,
  OrganisationRoleID, 
  [OrganisationRole].Code OrganisationRoleCode,
  [OrganisationRole].Name OrganisationRoleName,
  [Organisation_Site].StartDate,
  [Organisation_Site].EndDate,
  'Site' [Level],
  [Site].Code LevelCode,
  [Site].Name LevelName,
  0 [Weight],
  CAST(0 as bit) [IsReadOnly]
from
  [Organisation_Site]
  inner join [Site]
    on ([Organisation_Site].SiteID = [Site].ID)
  inner join [Organisation]
    on ([Organisation_Site].OrganisationID = [Organisation].ID)
  inner join [OrganisationRole]
    on ([Organisation_Site].OrganisationRoleID = [OrganisationRole].ID)
union
Select
  [Organisation_Station].ID,
  OrganisationID,
  [Organisation].Code OrganisationCode,
  [Organisation].Name OrganisationName,
  SiteID,
  [Site].Code SiteCode,
  [Site].Name SiteName,
  OrganisationRoleID,
  [OrganisationRole].Code OrganisationRoleCode,
  [OrganisationRole].Name OrganisationRoleName,
  [Organisation_Station].StartDate,
  [Organisation_Station].EndDate,
  'Station' [Level],
  [Station].Code LevelCode,
  [Station].Name LevelName,
  1 [Weight],
  CAST(1 as bit) [IsReadOnly]
from
  [Organisation_Station]
  inner join [Station]
    on ([Organisation_Station].StationID = [Station].ID)
  inner join [Organisation]
    on ([Organisation_Station].OrganisationID = [Organisation].ID)
  inner join [Site]
    on ([Station].SiteID = [Site].ID)
  inner join [OrganisationRole]
    on ([Organisation_Station].OrganisationRoleID = [OrganisationRole].ID)
union
Select
  [Organisation_Instrument].ID,
  OrganisationID,
  [Organisation].Code OrganisationCode,
  [Organisation].Name OrganisationName,
  SiteID,
  [Site].Code SiteCode,
  [Site].Name SiteName,
  OrganisationRoleID,
  [OrganisationRole].Code OrganisationRoleCode,
  [OrganisationRole].Name OrganisationRoleName,
  [Organisation_Instrument].StartDate,
  [Organisation_Instrument].EndDate,
  'Instrument' [Level],
  [Instrument].Code LevelCode,
  [Instrument].Name LevelName,
  2 [Weight],
  CAST(1 as bit) [IsReadOnly]
from
  [Organisation_Instrument]
  inner join [Instrument]
    on ([Organisation_Instrument].InstrumentID = [Instrument].ID)
  inner join [Organisation]
    on ([Organisation_Instrument].OrganisationID = [Organisation].ID)
  inner join [Station_Instrument]
    on ([Organisation_Instrument].InstrumentID = [Station_Instrument].InstrumentID)
  inner join [Station]
    on ([Station_Instrument].StationID = [Station].ID)
  inner join [Site]
    on ([Station].SiteID = [Site].ID)
  inner join [OrganisationRole]
    on ([Organisation_Instrument].OrganisationRoleID = [OrganisationRole].ID)
--< Added 2.0.6 20160607 TimPN
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Altering [dbo].[vStationOrganisation]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
--> Added 2.0.6 20160607 TimPN
ALTER VIEW [dbo].[vStationOrganisation]
AS
Select
  [Organisation_Site].ID,
  OrganisationID,
  [Organisation].Code OrganisationCode,
  [Organisation].Name OrganisationName,
  [Station].ID StationID,
  [Station].Code StationCode,
  [Station].Name StationName,
  OrganisationRoleID, 
  [OrganisationRole].Code OrganisationRoleCode,
  [OrganisationRole].Name OrganisationRoleName,
  [Organisation_Site].StartDate,
  [Organisation_Site].EndDate,
  'Site' [Level],
  [Site].Code LevelCode,
  [Site].Name LevelName,
  0 [Weight],
  CAST(1 as bit) [IsReadOnly]
from
  [Organisation_Site]
  inner join [Site]
    on ([Organisation_Site].SiteID = [Site].ID)
  inner join [Organisation]
    on ([Organisation_Site].OrganisationID = [Organisation].ID)
  inner join [Station] 
    on ([Organisation_Site].SiteID = [Station].SiteID)
  inner join [OrganisationRole]
    on ([Organisation_Site].OrganisationRoleID = [OrganisationRole].ID)
union
Select 
  [Organisation_Station].ID,
  OrganisationID,
  [Organisation].Code OrganisationCode,
  [Organisation].Name OrganisationName,
  StationID,
  [Station].Code StationCode,
  [Station].Name StationName,
  OrganisationRoleID,
  [OrganisationRole].Code OrganisationRoleCode,
  [OrganisationRole].Name OrganisationRoleName,
  [Organisation_Station].StartDate,
  [Organisation_Station].EndDate,
  'Station' [Level],
  [Station].Code LevelCode,
  [Station].Name LevelName,
  1 [Weight],
  CAST(0 as bit) [IsReadOnly]
from 
  [Organisation_Station]
  inner join [Station] 
    on ([Organisation_Station].StationID = [Station].ID)
  inner join [Organisation]
    on ([Organisation_Station].OrganisationID = [Organisation].ID)
  inner join [OrganisationRole]
    on ([Organisation_Station].OrganisationRoleID = [OrganisationRole].ID)
union
Select
  [Organisation_Instrument].ID,
  OrganisationID,
  [Organisation].Code OrganisationCode,
  [Organisation].Name OrganisationName,
  [Station].ID StationID,
  [Station].Code StationCode,
  [Station].Name StationName,
  OrganisationRoleID,
  [OrganisationRole].Code OrganisationRoleCode,
  [OrganisationRole].Name OrganisationRoleName,
  [Organisation_Instrument].StartDate,
  [Organisation_Instrument].EndDate,
  'Instrument' [Level],
  [Instrument].Code LevelCode,
  [Instrument].Name LevelName,
  2 [Weight],
  CAST(1 as bit) [IsReadOnly]
from
  [Organisation_Instrument]
  inner join [Instrument]
    on ([Organisation_Instrument].InstrumentID = [Instrument].ID)
  inner join [Organisation]
    on ( [Organisation_Instrument].OrganisationID = [Organisation].ID)
  inner join [Station_Instrument]
    on ( [Organisation_Instrument].InstrumentID = [Station_Instrument].InstrumentID)
  inner join [Station]
    on ( [Station_Instrument].StationID = [Station].ID)
  inner join [OrganisationRole]
    on ( [Organisation_Instrument].OrganisationRoleID = [OrganisationRole].ID)
--< Added 2.0.6 20160607 TimPN
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Altering [dbo].[vStation]...';


GO
ALTER VIEW [dbo].[vStation]
AS
SELECT 
  Station.*,
  p.Code + ' - ' + p.Name ProjectSiteName,
  s.Code SiteCode,
  s.Name SiteName
FROM 
  Station
  LEFT JOIN ProjectSite p -- Must be removed once all stations have sites
    on (Station.ProjectSiteID = p.ID)
  LEFT JOIN [Site] s 
    on (Station.SiteID = s.ID)
GO
PRINT N'Creating [dbo].[vInstrumentDataSource]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
--> Added 2.0.9 20160727 TimPN
CREATE VIEW [dbo].[vInstrumentDataSource] AS 
SELECT 
  src.*, 
  [Instrument].Code InstrumentCode,
  [Instrument].Name InstrumentName,
  [DataSource].Code DataSourceCode,
  [DataSource].Name DataSourceName
FROM 
  [Instrument_DataSource] src
  inner join [Instrument] 
    on (src.InstrumentID = [Instrument].ID)
  inner join [DataSource]
    on (src.DataSourceID = [DataSource].ID)
--< Added 2.0.9 20160727 TimPN
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[vInstrumentSensor]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
--> Added 2.0.5 20160531 TimPN
CREATE VIEW [dbo].[vInstrumentSensor] AS 
SELECT 
  src.*, 
  [Instrument].Code InstrumentCode,
  [Instrument].Name InstrumentName,
  [Sensor].Code SensorCode,
  [Sensor].Name SensorName
FROM 
  [Instrument_Sensor] src
  inner join [Instrument] 
    on (src.InstrumentID = [Instrument].ID)
  inner join [Sensor]
    on (src.SensorID = [Sensor].ID)
--< Added 2.0.5 20160531 TimPN
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[vOrganisationInstrument]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
--> Added 2.0.5 20160527 TimPN
CREATE VIEW [dbo].[vOrganisationInstrument]
AS 
SELECT 
  src.*,
  [Organisation].Code OrganisationCode,
  [Organisation].Name OrganisationName,
  [Instrument].Code InstrumentCode,
  [Instrument].Name InstrumentName,
  [OrganisationRole].Code OrganisationRoleCode,
  [OrganisationRole].Name OrganisationRoleName
FROM 
  [Organisation_Instrument] src
  inner join [Organisation]
    on (src.OrganisationID = [Organisation].ID)
  inner join [Instrument]
    on (src.InstrumentID = [Instrument].ID)
  inner join [OrganisationRole]
    on (src.OrganisationRoleID = [OrganisationRole].ID)
--< Added 2.0.5 20160527 TimPN
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[vOrganisationSite]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
--> Added 2.0.5 20160527 TimPN
CREATE VIEW [dbo].[vOrganisationSite]
AS 
SELECT 
  src.*,
  [Organisation].Code OrganisationCode,
  [Organisation].Name OrganisationName,
  [Site].Code SiteCode,
  [Site].Name SiteName,
  [OrganisationRole].Code OrganisationRoleCode,
  [OrganisationRole].Name OrganisationRoleName
FROM 
  [Organisation_Site] src
  inner join [Organisation]
    on (src.OrganisationID = [Organisation].ID)
  inner join [Site]
    on (src.SiteID = [Site].ID)
  inner join [OrganisationRole]
    on (src.OrganisationRoleID = [OrganisationRole].ID)
--< Added 2.0.5 20160527 TimPN
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[vOrganisationStation]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
--> Added 2.0.5 20160527 TimPN
CREATE VIEW [dbo].[vOrganisationStation]
AS 
SELECT 
  src.*,
  [Organisation].Code OrganisationCode,
  [Organisation].Name OrganisationName,
  [Station].Code StationCode,
  [Station].Name StationName,
  [OrganisationRole].Code OrganisationRoleCode,
  [OrganisationRole].Name OrganisationRoleName
FROM 
  [Organisation_Station] src
  inner join [Organisation]
    on (src.OrganisationID = [Organisation].ID)
  inner join [Station]
    on (src.StationID = [Station].ID)
  inner join [OrganisationRole]
    on (src.OrganisationRoleID = [OrganisationRole].ID)
--< Added 2.0.5 20160527 TimPN
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[vProject]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
--> Added 2.0.5 20160512 TimPN
CREATE VIEW [dbo].[vProject]
AS
SELECT 
  src.*, 
  [Programme].Code ProgrammeCode,
  [Programme].Name ProgrammeName
FROM 
  [Project] src
  left join [Programme]
    on (src.ProgrammeID = [Programme].ID)
--< Added 2.0.5 20160512 TimPN
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[vProjectStation]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
--> Added 2.0.5 20160527 TimPN
CREATE VIEW [dbo].[vProjectStation]
AS
SELECT 
  src.*, 
  [Project].Code ProjectCode,
  [Project].Name ProjectName,
  [Station].Code StationCode,
  [Station].Name StationName
FROM 
  [Project_Station] src
  inner join [Project]
    on (src.ProjectID = [Project].ID)
  inner join [Station]
    on (src.StationID = [Station].ID)
--< Added 2.0.5 20160527 TimPN
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[vSchemaColumn]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
CREATE VIEW [dbo].[vSchemaColumn]
AS 
SELECT 
  SchemaColumn.*,
  SchemaColumnType.Name ColumnType, 
  Phenomenon.Name PhenomenonName,
  Offering.Name OfferingName,
  UnitOfMeasure.Unit UnitOfMeasureName
FROM 
  SchemaColumn
  inner join SchemaColumnType 
    on (SchemaColumn.SchemaColumnTypeID = SchemaColumnType.ID)
  left join Phenomenon
    on (SchemaColumn.PhenomenonID = Phenomenon.ID)
  left join PhenomenonOffering
    on (SchemaColumn.PhenomenonOfferingID = PhenomenonOffering.ID)
  left join Offering
    on (PhenomenonOffering.OfferingID = Offering.ID)
  left join PhenomenonUOM 
    on (SchemaColumn.PhenomenonUOMID = PhenomenonUOM.ID)
  left join  UnitOfMeasure
    on (PhenomenonUOM.UnitOfMeasureID = UnitOfMeasure.ID)
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating [dbo].[vStationInstrument]...';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER OFF;


GO
--> Added 2.0.5 20160512 TimPN
CREATE VIEW [dbo].[vStationInstrument] AS 
SELECT 
  src.*, 
  [Station].Code StationCode,
  [Station].Name StationName,
  [Instrument].Code InstrumentCode,
  [Instrument].Name InstrumentName
FROM 
  [Station_Instrument] src
  inner join [Station]
    on (src.StationID = [Station].ID)
  inner join [Instrument] 
    on (src.InstrumentID = [Instrument].ID)
--< Added 2.0.5 20160512 TimPN
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Altering [dbo].[progress_Status_Raw]...';


GO
-- =============================================
-- Author:		Wim Hugo
-- Create date: 20-06-2014
-- Description:	Create Progress Table - Raw Data
-- =============================================

--> Changed 2.0.3 20160503 TimPN
--Renamed SensorProcedure to Sensor
--< Changed 2.0.3 20160503 TimPN

ALTER PROCEDURE progress_Status_Raw 
    -- Add the parameters for the stored procedure here

AS
BEGIN
    -- SET NOCOUNT ON added to prevent extra result sets from
    -- interfering with SELECT statements.
    SET NOCOUNT ON;
    
    DROP Table dbo.Progress
    
    CREATE TABLE [dbo].Progress(
    [ImportBatchID] [uniqueidentifier],
    [StartDate] [datetime],
    [EndDate] [datetime],
    [DateUploaded] [datetime],
    [Observations] [bigint],
    [UserId] [uniqueidentifier],
    [SensorID] [uniqueidentifier],
--> Changed 2.0.3 20160421 TimPN
--    [PhenonmenonOfferingID] [uniqueidentifier]
    [PhenomenonOfferingID] [uniqueidentifier]
--< Changed 2.0.3 20160421 TimPN
    )

    -- Insert statements for procedure here
    INSERT INTO [dbo].[Progress]
    (
    [ImportBatchID],
    [StartDate],
    [EndDate],
    [DateUploaded],
    [Observations],
    [UserId],
    [SensorID],
--> Changed 2.0.3 20160421 TimPN
--    [PhenonmenonOfferingID]
    [PhenomenonOfferingID]
--< Changed 2.0.3 20160421 TimPN
    )
   
    SELECT     
        ImportBatchID, 
        MIN(ValueDate) AS StartDate, 
        MAX(ValueDate) AS EndDate, 
        MIN(AddedDate) AS DateUploaded, 
        COUNT(ID) AS Observations, 
        UserId, 
        SensorID, 
--> Changed 2.0.3 20160421 TimPN
--        PhenonmenonOfferingID
        PhenomenonOfferingID
--< Changed 2.0.3 20160421 TimPN
FROM    dbo.Observation
--> Changed 2.0.3 20160421 TimPN
--GROUP BY PhenonmenonOfferingID, PhenonmenonUOMID, ImportBatchID, UserId, SensorID
GROUP BY PhenomenonOfferingID, PhenomenonUOMID, ImportBatchID, UserId, SensorID
--< Changed 2.0.3 20160421 TimPN
END
GO
PRINT N'Checking existing data against newly created constraints';


GO
USE [$(DatabaseName)];


GO
ALTER TABLE [dbo].[DataLog] WITH CHECK CHECK CONSTRAINT [FK_DataLog_DataSourceTransformation];

ALTER TABLE [dbo].[DataLog] WITH CHECK CHECK CONSTRAINT [FK_DataLog_Sensor];

ALTER TABLE [dbo].[DataLog] WITH CHECK CHECK CONSTRAINT [FK_DataLog_aspnet_Users];

ALTER TABLE [dbo].[DataLog] WITH CHECK CHECK CONSTRAINT [FK_DataLog_Status];

ALTER TABLE [dbo].[DataLog] WITH CHECK CHECK CONSTRAINT [FK_DataLog_PhenomenonOffering];

ALTER TABLE [dbo].[DataLog] WITH CHECK CHECK CONSTRAINT [FK_DataLog_PhenomenonUOM];

ALTER TABLE [dbo].[DataLog] WITH CHECK CHECK CONSTRAINT [FK_DataLog_ImportBatch];

ALTER TABLE [dbo].[DataLog] WITH CHECK CHECK CONSTRAINT [FK_DataLog_StatusReason];

ALTER TABLE [dbo].[ImportBatch] WITH CHECK CHECK CONSTRAINT [FK_ImportBatch_aspnet_Users];

ALTER TABLE [dbo].[ImportBatch] WITH CHECK CHECK CONSTRAINT [FK_ImportBatch_DataSource];

ALTER TABLE [dbo].[ImportBatch] WITH CHECK CHECK CONSTRAINT [FK_ImportBatch_Status];

ALTER TABLE [dbo].[ImportBatch] WITH CHECK CHECK CONSTRAINT [FK_ImportBatch_StatusReason];

ALTER TABLE [dbo].[Observation] WITH CHECK CHECK CONSTRAINT [FK_Observation_Sensor];

ALTER TABLE [dbo].[Observation] WITH CHECK CHECK CONSTRAINT [FK_Observation_PhenomenonOffering];

ALTER TABLE [dbo].[Observation] WITH CHECK CHECK CONSTRAINT [FK_Observation_PhenomenonUOM];

ALTER TABLE [dbo].[Observation] WITH CHECK CHECK CONSTRAINT [FK_Observation_aspnet_Users];

ALTER TABLE [dbo].[Observation] WITH CHECK CHECK CONSTRAINT [FK_Observation_ImportBatch];

ALTER TABLE [dbo].[Observation] WITH CHECK CHECK CONSTRAINT [FK_Observation_Status];

ALTER TABLE [dbo].[Observation] WITH CHECK CHECK CONSTRAINT [FK_Observation_StatusReason];

ALTER TABLE [dbo].[DataSource] WITH CHECK CHECK CONSTRAINT [FK_DataSource_DataSchema];

ALTER TABLE [dbo].[Sensor] WITH CHECK CHECK CONSTRAINT [FK_Sensor_DataSchema];

ALTER TABLE [dbo].[DataSchema] WITH CHECK CHECK CONSTRAINT [FK_DataSchema_DataSourceType];

ALTER TABLE [dbo].[DataSchema] WITH CHECK CHECK CONSTRAINT [FK_DataSchema_aspnet_Users];

ALTER TABLE [dbo].[DataSourceTransformation] WITH CHECK CHECK CONSTRAINT [FK_DataSourceTransformation_DataSource];

ALTER TABLE [dbo].[Sensor] WITH CHECK CHECK CONSTRAINT [FK_Sensor_DataSource];

ALTER TABLE [dbo].[DataSourceRole] WITH CHECK CHECK CONSTRAINT [FK_DataSourceRole_DataSource];

ALTER TABLE [dbo].[DataSource] WITH CHECK CHECK CONSTRAINT [FK_DataSource_aspnet_Users];

ALTER TABLE [dbo].[DataSourceRole] WITH CHECK CHECK CONSTRAINT [FK_DataSourceRole_aspnet_Users];

ALTER TABLE [dbo].[DataSourceRole] WITH CHECK CHECK CONSTRAINT [FK_DataSourceRole_aspnet_Roles];

ALTER TABLE [dbo].[DataSourceTransformation] WITH CHECK CHECK CONSTRAINT [FK_DataSourceTransformation_Sensor];

ALTER TABLE [dbo].[DataSourceTransformation] WITH CHECK CHECK CONSTRAINT [FK_DataSourceTransformation_aspnet_Users];

ALTER TABLE [dbo].[DataSourceTransformation] WITH CHECK CHECK CONSTRAINT [FK_DataSourceTransformation_Phenomenon];

ALTER TABLE [dbo].[DataSourceTransformation] WITH CHECK CHECK CONSTRAINT [FK_DataSourceTransformation_TransformationType];

ALTER TABLE [dbo].[DataSourceTransformation] WITH CHECK CHECK CONSTRAINT [FK_DataSourceTransformation_PhenomenonOffering];

ALTER TABLE [dbo].[DataSourceTransformation] WITH CHECK CHECK CONSTRAINT [FK_DataSourceTransformation_PhenomenonUOM];

ALTER TABLE [dbo].[DataSourceTransformation] WITH CHECK CHECK CONSTRAINT [FK_DataSourceTransformation_NewPhenomenonOffering];

ALTER TABLE [dbo].[DataSourceTransformation] WITH CHECK CHECK CONSTRAINT [FK_DataSourceTransformation_NewPhenomenonUOM];

ALTER TABLE [dbo].[DataSourceType] WITH CHECK CHECK CONSTRAINT [FK_DataSourceType_aspnet_Users];

ALTER TABLE [dbo].[Instrument] WITH CHECK CHECK CONSTRAINT [FK_Instrument_aspnet_Users];

ALTER TABLE [dbo].[PhenomenonOffering] WITH CHECK CHECK CONSTRAINT [FK_PhenomenonOffering_Offering];

ALTER TABLE [dbo].[Offering] WITH CHECK CHECK CONSTRAINT [FK_Offering_aspnet_Users];

ALTER TABLE [dbo].[OrganisationRole] WITH CHECK CHECK CONSTRAINT [FK_OrganisationRole_aspnet_Users];

ALTER TABLE [dbo].[PhenomenonOffering] WITH CHECK CHECK CONSTRAINT [FK_PhenomenonOffering_Phenomenon];

ALTER TABLE [dbo].[PhenomenonUOM] WITH CHECK CHECK CONSTRAINT [FK_PhenomenonUOM_PhenomenonUOM];

ALTER TABLE [dbo].[Sensor] WITH CHECK CHECK CONSTRAINT [FK_Sensor_Phenomenon];

ALTER TABLE [dbo].[Phenomenon] WITH CHECK CHECK CONSTRAINT [FK_Phenomenon_aspnet_Users];

ALTER TABLE [dbo].[PhenomenonOffering] WITH CHECK CHECK CONSTRAINT [FK_PhenomenonOffering_aspnet_Users];

ALTER TABLE [dbo].[PhenomenonUOM] WITH CHECK CHECK CONSTRAINT [FK_PhenomenonUOM_aspnet_Users];

ALTER TABLE [dbo].[PhenomenonUOM] WITH CHECK CHECK CONSTRAINT [FK_PhenomenonUOM_UnitOfMeasure];

ALTER TABLE [dbo].[Sensor] WITH CHECK CHECK CONSTRAINT [FK_Sensor_aspnet_Users];

ALTER TABLE [dbo].[Sensor] WITH CHECK CHECK CONSTRAINT [FK_Sensor_Station];

ALTER TABLE [dbo].[Station] WITH CHECK CHECK CONSTRAINT [FK_Station_Site];

ALTER TABLE [dbo].[Site] WITH CHECK CHECK CONSTRAINT [FK_Site_aspnet_Users];

ALTER TABLE [dbo].[Station] WITH CHECK CHECK CONSTRAINT [FK_Station_ProjectSite];

ALTER TABLE [dbo].[Station] WITH CHECK CHECK CONSTRAINT [FK_Station_aspnet_Users];

ALTER TABLE [dbo].[Status] WITH CHECK CHECK CONSTRAINT [FK_Status_aspnet_Users];

ALTER TABLE [dbo].[TransformationType] WITH CHECK CHECK CONSTRAINT [FK_TransformationType_aspnet_Users];

ALTER TABLE [dbo].[UnitOfMeasure] WITH CHECK CHECK CONSTRAINT [FK_UnitOfMeasure_aspnet_Users];

ALTER TABLE [dbo].[Instrument_DataSource] WITH CHECK CHECK CONSTRAINT [FK_Instrument_DataSource_Instrument];

ALTER TABLE [dbo].[Instrument_DataSource] WITH CHECK CHECK CONSTRAINT [FK_Instrument_DataSource_DataSource];

ALTER TABLE [dbo].[Instrument_DataSource] WITH CHECK CHECK CONSTRAINT [FK_Instrument_DataSource_aspnet_Users];

ALTER TABLE [dbo].[Instrument_Sensor] WITH CHECK CHECK CONSTRAINT [FK_Instrument_Sensor_Instrument];

ALTER TABLE [dbo].[Instrument_Sensor] WITH CHECK CHECK CONSTRAINT [FK_Instrument_Sensor_Sensor];

ALTER TABLE [dbo].[Instrument_Sensor] WITH CHECK CHECK CONSTRAINT [FK_Instrument_Sensor_aspnet_Users];

ALTER TABLE [dbo].[Organisation_Instrument] WITH CHECK CHECK CONSTRAINT [FK_Organisation_Instrument_Organisation];

ALTER TABLE [dbo].[Organisation_Instrument] WITH CHECK CHECK CONSTRAINT [FK_Organisation_Instrument_Instrument];

ALTER TABLE [dbo].[Organisation_Instrument] WITH CHECK CHECK CONSTRAINT [FK_Organisation_Instrument_OrganisationRole];

ALTER TABLE [dbo].[Organisation_Instrument] WITH CHECK CHECK CONSTRAINT [FK_Organisation_Instrument_aspnet_Users];

ALTER TABLE [dbo].[Organisation_Site] WITH CHECK CHECK CONSTRAINT [FK_Organisation_Site_Organisation];

ALTER TABLE [dbo].[Organisation_Site] WITH CHECK CHECK CONSTRAINT [FK_Organisation_Site_Site];

ALTER TABLE [dbo].[Organisation_Site] WITH CHECK CHECK CONSTRAINT [FK_Organisation_Site_OrganisationRole];

ALTER TABLE [dbo].[Organisation_Site] WITH CHECK CHECK CONSTRAINT [FK_Organisation_Site_aspnet_Users];

ALTER TABLE [dbo].[Organisation_Station] WITH CHECK CHECK CONSTRAINT [FK_Organisation_Station_Organisation];

ALTER TABLE [dbo].[Organisation_Station] WITH CHECK CHECK CONSTRAINT [FK_Organisation_Station_Station];

ALTER TABLE [dbo].[Organisation_Station] WITH CHECK CHECK CONSTRAINT [FK_Organisation_Station_OrganisationRole];

ALTER TABLE [dbo].[Organisation_Station] WITH CHECK CHECK CONSTRAINT [FK_Organisation_Station_aspnet_Users];

ALTER TABLE [dbo].[Programme] WITH CHECK CHECK CONSTRAINT [FK_Programme_aspnet_Users];

ALTER TABLE [dbo].[Progress] WITH CHECK CHECK CONSTRAINT [FK_Progress_ImportBatch];

ALTER TABLE [dbo].[Progress] WITH CHECK CHECK CONSTRAINT [FK_Progress_Sensor];

ALTER TABLE [dbo].[Progress] WITH CHECK CHECK CONSTRAINT [FK_Progress_PhenomenonOffering];

ALTER TABLE [dbo].[Progress] WITH CHECK CHECK CONSTRAINT [FK_Progress_aspnet_Users];

ALTER TABLE [dbo].[Project] WITH CHECK CHECK CONSTRAINT [FK_Project_Programme];

ALTER TABLE [dbo].[Project] WITH CHECK CHECK CONSTRAINT [FK_Project_aspnet_Users];

ALTER TABLE [dbo].[Project_Station] WITH CHECK CHECK CONSTRAINT [FK_Project_Station_ProjectID];

ALTER TABLE [dbo].[Project_Station] WITH CHECK CHECK CONSTRAINT [FK_Project_Station_StationID];

ALTER TABLE [dbo].[Project_Station] WITH CHECK CHECK CONSTRAINT [FK_Project_Station_aspnet_Users];

ALTER TABLE [dbo].[SchemaColumn] WITH CHECK CHECK CONSTRAINT [FK_SchemaColumn_DataSchema];

ALTER TABLE [dbo].[SchemaColumn] WITH CHECK CHECK CONSTRAINT [FK_SchemaColumn_SchemaColumnType];

ALTER TABLE [dbo].[SchemaColumn] WITH CHECK CHECK CONSTRAINT [FK_SchemaColumn_Phenomenon];

ALTER TABLE [dbo].[SchemaColumn] WITH CHECK CHECK CONSTRAINT [FK_SchemaColumn_PhenomenonOffering];

ALTER TABLE [dbo].[SchemaColumn] WITH CHECK CHECK CONSTRAINT [FK_SchemaColumn_PhenomenonUOM];

ALTER TABLE [dbo].[SchemaColumn] WITH CHECK CHECK CONSTRAINT [FK_SchemaColumn_aspnet_Users];

ALTER TABLE [dbo].[SchemaColumnType] WITH CHECK CHECK CONSTRAINT [FK_SchemaColumnType_aspnet_Users];

ALTER TABLE [dbo].[Station_Instrument] WITH CHECK CHECK CONSTRAINT [FK_Station_Instrument_Station];

ALTER TABLE [dbo].[Station_Instrument] WITH CHECK CHECK CONSTRAINT [FK_Station_Instrument_Instrument];

ALTER TABLE [dbo].[Station_Instrument] WITH CHECK CHECK CONSTRAINT [FK_Station_Instrument_aspnet_Users];

ALTER TABLE [dbo].[StatusReason] WITH CHECK CHECK CONSTRAINT [FK_StatusReason_aspnet_Users];


GO
PRINT N'Update complete.';


GO
