/*
Deployment script for ObservationsTest

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "ObservationsTest"
:setvar DefaultFilePrefix "ObservationsTest"
:setvar DefaultDataPath "C:\Program Files\Microsoft SQL Server\MSSQL13.SAEON\MSSQL\DATA\"
:setvar DefaultLogPath "C:\Program Files\Microsoft SQL Server\MSSQL13.SAEON\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
PRINT N'Creating [Authentication]...';


GO
ALTER DATABASE [$(DatabaseName)]
    ADD FILEGROUP [Authentication];


GO
PRINT N'Creating [Documents]...';


GO
ALTER DATABASE [$(DatabaseName)]
    ADD FILEGROUP [Documents] CONTAINS FILESTREAM;


GO
PRINT N'Creating [Observations]...';


GO
ALTER DATABASE [$(DatabaseName)]
    ADD FILEGROUP [Observations];


GO
PRINT N'Creating [Authentication]...';


GO
ALTER DATABASE [$(DatabaseName)]
    ADD FILE (NAME = [Authentication], FILENAME = '$(DefaultDataPath)$(DefaultFilePrefix)_Authentication.ndf') TO FILEGROUP [Authentication];


GO
PRINT N'Creating [Documents]...';


GO
ALTER DATABASE [$(DatabaseName)]
    ADD FILE (NAME = [Documents], FILENAME = '$(DefaultDataPath)$(DefaultFilePrefix)_Documents.ndf') TO FILEGROUP [Documents];


GO
PRINT N'Creating [Observations]...';


GO
ALTER DATABASE [$(DatabaseName)]
    ADD FILE (NAME = [Observations], FILENAME = '$(DefaultDataPath)$(DefaultFilePrefix)_Observations.ndf') TO FILEGROUP [Observations];


GO
USE [$(DatabaseName)];


GO
PRINT N'Dropping [dbo].[Observation].[IX_Observation_Comment]...';


GO
DROP INDEX [IX_Observation_Comment]
    ON [dbo].[Observation];


GO
PRINT N'Dropping unnamed constraint on [dbo].[aspnet_Membership]...';


GO
ALTER TABLE [dbo].[aspnet_Membership] DROP CONSTRAINT [FK__aspnet_Me__Appli__5D95E53A];


GO
PRINT N'Dropping unnamed constraint on [dbo].[aspnet_Paths]...';


GO
ALTER TABLE [dbo].[aspnet_Paths] DROP CONSTRAINT [FK__aspnet_Pa__Appli__5F7E2DAC];


GO
PRINT N'Dropping unnamed constraint on [dbo].[aspnet_Roles]...';


GO
ALTER TABLE [dbo].[aspnet_Roles] DROP CONSTRAINT [FK__aspnet_Ro__Appli__6442E2C9];


GO
PRINT N'Dropping unnamed constraint on [dbo].[aspnet_Users]...';


GO
ALTER TABLE [dbo].[aspnet_Users] DROP CONSTRAINT [FK__aspnet_Us__Appli__65370702];


GO
PRINT N'Dropping unnamed constraint on [dbo].[aspnet_PersonalizationAllUsers]...';


GO
ALTER TABLE [dbo].[aspnet_PersonalizationAllUsers] DROP CONSTRAINT [FK__aspnet_Pe__PathI__607251E5];


GO
PRINT N'Dropping unnamed constraint on [dbo].[aspnet_PersonalizationPerUser]...';


GO
ALTER TABLE [dbo].[aspnet_PersonalizationPerUser] DROP CONSTRAINT [FK__aspnet_Pe__PathI__6166761E];


GO
PRINT N'Dropping unnamed constraint on [dbo].[aspnet_Profile]...';


GO
ALTER TABLE [dbo].[aspnet_Profile] DROP CONSTRAINT [FK__aspnet_Pr__UserI__634EBE90];


GO
PRINT N'Dropping unnamed constraint on [dbo].[aspnet_UsersInRoles]...';


GO
ALTER TABLE [dbo].[aspnet_UsersInRoles] DROP CONSTRAINT [FK__aspnet_Us__RoleI__662B2B3B];


GO
PRINT N'Dropping [dbo].[FK_RoleModule_aspnet_Roles]...';


GO
ALTER TABLE [dbo].[RoleModule] DROP CONSTRAINT [FK_RoleModule_aspnet_Roles];


GO
PRINT N'Dropping [dbo].[FK_DataSourceRole_aspnet_Roles]...';


GO
ALTER TABLE [dbo].[DataSourceRole] DROP CONSTRAINT [FK_DataSourceRole_aspnet_Roles];


GO
PRINT N'Dropping [dbo].[FK_TransformationType_aspnet_Users]...';


GO
ALTER TABLE [dbo].[TransformationType] DROP CONSTRAINT [FK_TransformationType_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_UnitOfMeasure_aspnet_Users]...';


GO
ALTER TABLE [dbo].[UnitOfMeasure] DROP CONSTRAINT [FK_UnitOfMeasure_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_Instrument_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Instrument] DROP CONSTRAINT [FK_Instrument_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_DataSource_aspnet_Users]...';


GO
ALTER TABLE [dbo].[DataSource] DROP CONSTRAINT [FK_DataSource_aspnet_Users];


GO
PRINT N'Dropping unnamed constraint on [dbo].[aspnet_Membership]...';


GO
ALTER TABLE [dbo].[aspnet_Membership] DROP CONSTRAINT [FK__aspnet_Me__UserI__5E8A0973];


GO
PRINT N'Dropping [dbo].[FK_Station_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Station] DROP CONSTRAINT [FK_Station_aspnet_Users];


GO
PRINT N'Dropping unnamed constraint on [dbo].[aspnet_PersonalizationPerUser]...';


GO
ALTER TABLE [dbo].[aspnet_PersonalizationPerUser] DROP CONSTRAINT [FK__aspnet_Pe__UserI__625A9A57];


GO
PRINT N'Dropping unnamed constraint on [dbo].[aspnet_UsersInRoles]...';


GO
ALTER TABLE [dbo].[aspnet_UsersInRoles] DROP CONSTRAINT [FK__aspnet_Us__UserI__671F4F74];


GO
PRINT N'Dropping [dbo].[FK_Programme_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Programme] DROP CONSTRAINT [FK_Programme_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_AuditLog_aspnet_Users]...';


GO
ALTER TABLE [dbo].[AuditLog] DROP CONSTRAINT [FK_AuditLog_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_OrganisationRole_aspnet_Users]...';


GO
ALTER TABLE [dbo].[OrganisationRole] DROP CONSTRAINT [FK_OrganisationRole_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_Project_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Project] DROP CONSTRAINT [FK_Project_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_Instrument_DataSource_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Instrument_DataSource] DROP CONSTRAINT [FK_Instrument_DataSource_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_Organisation_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Organisation] DROP CONSTRAINT [FK_Organisation_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_Site_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Site] DROP CONSTRAINT [FK_Site_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_Sensor_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Sensor] DROP CONSTRAINT [FK_Sensor_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_DataSchema_aspnet_Users]...';


GO
ALTER TABLE [dbo].[DataSchema] DROP CONSTRAINT [FK_DataSchema_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_Instrument_Sensor_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Instrument_Sensor] DROP CONSTRAINT [FK_Instrument_Sensor_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_Progress_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Progress] DROP CONSTRAINT [FK_Progress_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_ProjectSite_aspnet_Users]...';


GO
ALTER TABLE [dbo].[ProjectSite] DROP CONSTRAINT [FK_ProjectSite_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_Organisation_Instrument_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Organisation_Instrument] DROP CONSTRAINT [FK_Organisation_Instrument_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_Organisation_Site_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Organisation_Site] DROP CONSTRAINT [FK_Organisation_Site_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_DataSourceRole_aspnet_Users]...';


GO
ALTER TABLE [dbo].[DataSourceRole] DROP CONSTRAINT [FK_DataSourceRole_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_Organisation_Station_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Organisation_Station] DROP CONSTRAINT [FK_Organisation_Station_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_StatusReason_aspnet_Users]...';


GO
ALTER TABLE [dbo].[StatusReason] DROP CONSTRAINT [FK_StatusReason_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_Project_Station_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Project_Station] DROP CONSTRAINT [FK_Project_Station_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_DataSourceTransformation_aspnet_Users]...';


GO
ALTER TABLE [dbo].[DataSourceTransformation] DROP CONSTRAINT [FK_DataSourceTransformation_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_Station_Instrument_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Station_Instrument] DROP CONSTRAINT [FK_Station_Instrument_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_DataSourceType_aspnet_Users]...';


GO
ALTER TABLE [dbo].[DataSourceType] DROP CONSTRAINT [FK_DataSourceType_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_Offering_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Offering] DROP CONSTRAINT [FK_Offering_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_DataLog_aspnet_Users]...';


GO
ALTER TABLE [dbo].[DataLog] DROP CONSTRAINT [FK_DataLog_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_ImportBatch_aspnet_Users]...';


GO
ALTER TABLE [dbo].[ImportBatch] DROP CONSTRAINT [FK_ImportBatch_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_Phenomenon_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Phenomenon] DROP CONSTRAINT [FK_Phenomenon_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_Observation_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Observation] DROP CONSTRAINT [FK_Observation_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_SchemaColumn_aspnet_Users]...';


GO
ALTER TABLE [dbo].[SchemaColumn] DROP CONSTRAINT [FK_SchemaColumn_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_SchemaColumnType_aspnet_Users]...';


GO
ALTER TABLE [dbo].[SchemaColumnType] DROP CONSTRAINT [FK_SchemaColumnType_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_PhenomenonOffering_aspnet_Users]...';


GO
ALTER TABLE [dbo].[PhenomenonOffering] DROP CONSTRAINT [FK_PhenomenonOffering_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_PhenomenonUOM_aspnet_Users]...';


GO
ALTER TABLE [dbo].[PhenomenonUOM] DROP CONSTRAINT [FK_PhenomenonUOM_aspnet_Users];


GO
PRINT N'Dropping [dbo].[FK_Status_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Status] DROP CONSTRAINT [FK_Status_aspnet_Users];


GO
PRINT N'Dropping unnamed constraint on [dbo].[aspnet_Applications]...';


GO
ALTER TABLE [dbo].[aspnet_Applications] DROP CONSTRAINT [UQ__aspnet_A__30910331FCE73F60];


GO
PRINT N'Dropping unnamed constraint on [dbo].[aspnet_Applications]...';


GO
ALTER TABLE [dbo].[aspnet_Applications] DROP CONSTRAINT [UQ__aspnet_A__17477DE4E1B5A1AB];


GO
PRINT N'Dropping unnamed constraint on [dbo].[aspnet_Applications]...';


GO
ALTER TABLE [dbo].[aspnet_Applications] DROP CONSTRAINT [PK__aspnet_A__C93A4C981DBC2F03];


GO
PRINT N'Dropping unnamed constraint on [dbo].[aspnet_Membership]...';


GO
ALTER TABLE [dbo].[aspnet_Membership] DROP CONSTRAINT [PK__aspnet_M__1788CC4DBD42DACD];


GO
PRINT N'Dropping unnamed constraint on [dbo].[aspnet_Paths]...';


GO
ALTER TABLE [dbo].[aspnet_Paths] DROP CONSTRAINT [PK__aspnet_P__CD67DC582B9FB508];


GO
PRINT N'Dropping unnamed constraint on [dbo].[aspnet_PersonalizationPerUser]...';


GO
ALTER TABLE [dbo].[aspnet_PersonalizationPerUser] DROP CONSTRAINT [PK__aspnet_P__3214EC065A000CD3];


GO
PRINT N'Dropping unnamed constraint on [dbo].[aspnet_Roles]...';


GO
ALTER TABLE [dbo].[aspnet_Roles] DROP CONSTRAINT [PK__aspnet_R__8AFACE1B0D9B1478];


GO
PRINT N'Dropping unnamed constraint on [dbo].[aspnet_Users]...';


GO
ALTER TABLE [dbo].[aspnet_Users] DROP CONSTRAINT [PK__aspnet_U__1788CC4DAAFB5702];


GO
PRINT N'Starting rebuilding table [dbo].[aspnet_PersonalizationAllUsers]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_aspnet_PersonalizationAllUsers] (
    [PathId]          UNIQUEIDENTIFIER NOT NULL,
    [PageSettings]    IMAGE            NOT NULL,
    [LastUpdatedDate] DATETIME         NOT NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_aspnet_PersonalizationAllUsers1] PRIMARY KEY CLUSTERED ([PathId] ASC) ON [Authentication]
) ON [Authentication];

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[aspnet_PersonalizationAllUsers])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_aspnet_PersonalizationAllUsers] ([PathId], [PageSettings], [LastUpdatedDate])
        SELECT   [PathId],
                 [PageSettings],
                 [LastUpdatedDate]
        FROM     [dbo].[aspnet_PersonalizationAllUsers]
        ORDER BY [PathId] ASC;
    END

DROP TABLE [dbo].[aspnet_PersonalizationAllUsers];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_aspnet_PersonalizationAllUsers]', N'aspnet_PersonalizationAllUsers';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_aspnet_PersonalizationAllUsers1]', N'PK_aspnet_PersonalizationAllUsers', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
EXECUTE sp_tableoption @TableNamePattern = N'[dbo].[aspnet_PersonalizationAllUsers]', @OptionName = N'text in row', @OptionValue = N'6000';


GO
PRINT N'Starting rebuilding table [dbo].[aspnet_Profile]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_aspnet_Profile] (
    [UserId]               UNIQUEIDENTIFIER NOT NULL,
    [PropertyNames]        NTEXT            NOT NULL,
    [PropertyValuesString] NTEXT            NOT NULL,
    [PropertyValuesBinary] IMAGE            NOT NULL,
    [LastUpdatedDate]      DATETIME         NOT NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_aspnet_Profile1] PRIMARY KEY CLUSTERED ([UserId] ASC) ON [Authentication]
) ON [Authentication];

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[aspnet_Profile])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_aspnet_Profile] ([UserId], [PropertyNames], [PropertyValuesString], [PropertyValuesBinary], [LastUpdatedDate])
        SELECT   [UserId],
                 [PropertyNames],
                 [PropertyValuesString],
                 [PropertyValuesBinary],
                 [LastUpdatedDate]
        FROM     [dbo].[aspnet_Profile]
        ORDER BY [UserId] ASC;
    END

DROP TABLE [dbo].[aspnet_Profile];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_aspnet_Profile]', N'aspnet_Profile';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_aspnet_Profile1]', N'PK_aspnet_Profile', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
EXECUTE sp_tableoption @TableNamePattern = N'[dbo].[aspnet_Profile]', @OptionName = N'text in row', @OptionValue = N'6000';


GO
PRINT N'Starting rebuilding table [dbo].[aspnet_SchemaVersions]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_aspnet_SchemaVersions] (
    [Feature]                 NVARCHAR (128) NOT NULL,
    [CompatibleSchemaVersion] NVARCHAR (128) NOT NULL,
    [IsCurrentVersion]        BIT            NOT NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_aspnet_SchemaVersions1] PRIMARY KEY CLUSTERED ([Feature] ASC, [CompatibleSchemaVersion] ASC) ON [Authentication]
) ON [Authentication];

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[aspnet_SchemaVersions])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_aspnet_SchemaVersions] ([Feature], [CompatibleSchemaVersion], [IsCurrentVersion])
        SELECT   [Feature],
                 [CompatibleSchemaVersion],
                 [IsCurrentVersion]
        FROM     [dbo].[aspnet_SchemaVersions]
        ORDER BY [Feature] ASC, [CompatibleSchemaVersion] ASC;
    END

DROP TABLE [dbo].[aspnet_SchemaVersions];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_aspnet_SchemaVersions]', N'aspnet_SchemaVersions';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_aspnet_SchemaVersions1]', N'PK_aspnet_SchemaVersions', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[aspnet_UsersInRoles]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_aspnet_UsersInRoles] (
    [UserId] UNIQUEIDENTIFIER NOT NULL,
    [RoleId] UNIQUEIDENTIFIER NOT NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_aspnet_UsersInRoles1] PRIMARY KEY CLUSTERED ([UserId] ASC, [RoleId] ASC) ON [Authentication]
) ON [Authentication];

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[aspnet_UsersInRoles])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_aspnet_UsersInRoles] ([UserId], [RoleId])
        SELECT   [UserId],
                 [RoleId]
        FROM     [dbo].[aspnet_UsersInRoles]
        ORDER BY [UserId] ASC, [RoleId] ASC;
    END

DROP TABLE [dbo].[aspnet_UsersInRoles];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_aspnet_UsersInRoles]', N'aspnet_UsersInRoles';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_aspnet_UsersInRoles1]', N'PK_aspnet_UsersInRoles', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating [dbo].[aspnet_UsersInRoles].[aspnet_UsersInRoles_index]...';


GO
CREATE NONCLUSTERED INDEX [aspnet_UsersInRoles_index]
    ON [dbo].[aspnet_UsersInRoles]([RoleId] ASC)
    ON [Authentication];


GO
PRINT N'Starting rebuilding table [dbo].[aspnet_WebEvent_Events]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_aspnet_WebEvent_Events] (
    [EventId]                CHAR (32)       NOT NULL,
    [EventTimeUtc]           DATETIME        NOT NULL,
    [EventTime]              DATETIME        NOT NULL,
    [EventType]              NVARCHAR (256)  NOT NULL,
    [EventSequence]          DECIMAL (19)    NOT NULL,
    [EventOccurrence]        DECIMAL (19)    NOT NULL,
    [EventCode]              INT             NOT NULL,
    [EventDetailCode]        INT             NOT NULL,
    [Message]                NVARCHAR (1024) NULL,
    [ApplicationPath]        NVARCHAR (256)  NULL,
    [ApplicationVirtualPath] NVARCHAR (256)  NULL,
    [MachineName]            NVARCHAR (256)  NOT NULL,
    [RequestUrl]             NVARCHAR (1024) NULL,
    [ExceptionType]          NVARCHAR (256)  NULL,
    [Details]                NTEXT           NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_aspnet_WebEvent_Events1] PRIMARY KEY CLUSTERED ([EventId] ASC) ON [Authentication]
) ON [Authentication];

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[aspnet_WebEvent_Events])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_aspnet_WebEvent_Events] ([EventId], [EventTimeUtc], [EventTime], [EventType], [EventSequence], [EventOccurrence], [EventCode], [EventDetailCode], [Message], [ApplicationPath], [ApplicationVirtualPath], [MachineName], [RequestUrl], [ExceptionType], [Details])
        SELECT   [EventId],
                 [EventTimeUtc],
                 [EventTime],
                 [EventType],
                 [EventSequence],
                 [EventOccurrence],
                 [EventCode],
                 [EventDetailCode],
                 [Message],
                 [ApplicationPath],
                 [ApplicationVirtualPath],
                 [MachineName],
                 [RequestUrl],
                 [ExceptionType],
                 [Details]
        FROM     [dbo].[aspnet_WebEvent_Events]
        ORDER BY [EventId] ASC;
    END

DROP TABLE [dbo].[aspnet_WebEvent_Events];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_aspnet_WebEvent_Events]', N'aspnet_WebEvent_Events';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_aspnet_WebEvent_Events1]', N'PK_aspnet_WebEvent_Events', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating [dbo].[PK_aspnet_Applications]...';


GO
ALTER TABLE [dbo].[aspnet_Applications]
    ADD CONSTRAINT [PK_aspnet_Applications] PRIMARY KEY NONCLUSTERED ([ApplicationId] ASC) ON [Authentication];


GO
PRINT N'Creating [dbo].[UX_aspnet_Applications_ApplicationName]...';


GO
ALTER TABLE [dbo].[aspnet_Applications]
    ADD CONSTRAINT [UX_aspnet_Applications_ApplicationName] UNIQUE NONCLUSTERED ([ApplicationName] ASC) ON [Authentication];


GO
PRINT N'Creating [dbo].[UX_aspnet_Applications_LoweredApplicationName]...';


GO
ALTER TABLE [dbo].[aspnet_Applications]
    ADD CONSTRAINT [UX_aspnet_Applications_LoweredApplicationName] UNIQUE NONCLUSTERED ([LoweredApplicationName] ASC) ON [Authentication];


GO
PRINT N'Creating [dbo].[PK_aspnet_Membership]...';


GO
ALTER TABLE [dbo].[aspnet_Membership]
    ADD CONSTRAINT [PK_aspnet_Membership] PRIMARY KEY NONCLUSTERED ([UserId] ASC) ON [Authentication];


GO
PRINT N'Creating [dbo].[PK_aspnet_Paths]...';


GO
ALTER TABLE [dbo].[aspnet_Paths]
    ADD CONSTRAINT [PK_aspnet_Paths] PRIMARY KEY NONCLUSTERED ([PathId] ASC) ON [Authentication];


GO
PRINT N'Creating [dbo].[PK_aspnet_PersonalizationPerUser]...';


GO
ALTER TABLE [dbo].[aspnet_PersonalizationPerUser]
    ADD CONSTRAINT [PK_aspnet_PersonalizationPerUser] PRIMARY KEY NONCLUSTERED ([Id] ASC) ON [Authentication];


GO
PRINT N'Creating [dbo].[PK_aspnet_Roles]...';


GO
ALTER TABLE [dbo].[aspnet_Roles]
    ADD CONSTRAINT [PK_aspnet_Roles] PRIMARY KEY NONCLUSTERED ([RoleId] ASC) ON [Authentication];


GO
PRINT N'Creating [dbo].[PK_aspnet_Users]...';


GO
ALTER TABLE [dbo].[aspnet_Users]
    ADD CONSTRAINT [PK_aspnet_Users] PRIMARY KEY NONCLUSTERED ([UserId] ASC) ON [Authentication];


GO
PRINT N'Creating unnamed constraint on [dbo].[aspnet_Membership]...';


GO
ALTER TABLE [dbo].[aspnet_Membership] WITH NOCHECK
    ADD FOREIGN KEY ([ApplicationId]) REFERENCES [dbo].[aspnet_Applications] ([ApplicationId]);


GO
PRINT N'Creating unnamed constraint on [dbo].[aspnet_Paths]...';


GO
ALTER TABLE [dbo].[aspnet_Paths] WITH NOCHECK
    ADD FOREIGN KEY ([ApplicationId]) REFERENCES [dbo].[aspnet_Applications] ([ApplicationId]);


GO
PRINT N'Creating unnamed constraint on [dbo].[aspnet_Roles]...';


GO
ALTER TABLE [dbo].[aspnet_Roles] WITH NOCHECK
    ADD FOREIGN KEY ([ApplicationId]) REFERENCES [dbo].[aspnet_Applications] ([ApplicationId]);


GO
PRINT N'Creating unnamed constraint on [dbo].[aspnet_Users]...';


GO
ALTER TABLE [dbo].[aspnet_Users] WITH NOCHECK
    ADD FOREIGN KEY ([ApplicationId]) REFERENCES [dbo].[aspnet_Applications] ([ApplicationId]);


GO
PRINT N'Creating unnamed constraint on [dbo].[aspnet_PersonalizationAllUsers]...';


GO
ALTER TABLE [dbo].[aspnet_PersonalizationAllUsers] WITH NOCHECK
    ADD FOREIGN KEY ([PathId]) REFERENCES [dbo].[aspnet_Paths] ([PathId]);


GO
PRINT N'Creating unnamed constraint on [dbo].[aspnet_PersonalizationPerUser]...';


GO
ALTER TABLE [dbo].[aspnet_PersonalizationPerUser] WITH NOCHECK
    ADD FOREIGN KEY ([PathId]) REFERENCES [dbo].[aspnet_Paths] ([PathId]);


GO
PRINT N'Creating unnamed constraint on [dbo].[aspnet_Profile]...';


GO
ALTER TABLE [dbo].[aspnet_Profile] WITH NOCHECK
    ADD FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating unnamed constraint on [dbo].[aspnet_UsersInRoles]...';


GO
ALTER TABLE [dbo].[aspnet_UsersInRoles] WITH NOCHECK
    ADD FOREIGN KEY ([RoleId]) REFERENCES [dbo].[aspnet_Roles] ([RoleId]);


GO
PRINT N'Creating [dbo].[FK_RoleModule_aspnet_Roles]...';


GO
ALTER TABLE [dbo].[RoleModule] WITH NOCHECK
    ADD CONSTRAINT [FK_RoleModule_aspnet_Roles] FOREIGN KEY ([RoleId]) REFERENCES [dbo].[aspnet_Roles] ([RoleId]);


GO
PRINT N'Creating [dbo].[FK_DataSourceRole_aspnet_Roles]...';


GO
ALTER TABLE [dbo].[DataSourceRole] WITH NOCHECK
    ADD CONSTRAINT [FK_DataSourceRole_aspnet_Roles] FOREIGN KEY ([RoleId]) REFERENCES [dbo].[aspnet_Roles] ([RoleId]);


GO
PRINT N'Creating [dbo].[FK_TransformationType_aspnet_Users]...';


GO
ALTER TABLE [dbo].[TransformationType] WITH NOCHECK
    ADD CONSTRAINT [FK_TransformationType_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_UnitOfMeasure_aspnet_Users]...';


GO
ALTER TABLE [dbo].[UnitOfMeasure] WITH NOCHECK
    ADD CONSTRAINT [FK_UnitOfMeasure_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Instrument_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Instrument] WITH NOCHECK
    ADD CONSTRAINT [FK_Instrument_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_DataSource_aspnet_Users]...';


GO
ALTER TABLE [dbo].[DataSource] WITH NOCHECK
    ADD CONSTRAINT [FK_DataSource_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating unnamed constraint on [dbo].[aspnet_Membership]...';


GO
ALTER TABLE [dbo].[aspnet_Membership] WITH NOCHECK
    ADD FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Station_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Station] WITH NOCHECK
    ADD CONSTRAINT [FK_Station_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating unnamed constraint on [dbo].[aspnet_PersonalizationPerUser]...';


GO
ALTER TABLE [dbo].[aspnet_PersonalizationPerUser] WITH NOCHECK
    ADD FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating unnamed constraint on [dbo].[aspnet_UsersInRoles]...';


GO
ALTER TABLE [dbo].[aspnet_UsersInRoles] WITH NOCHECK
    ADD FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Programme_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Programme] WITH NOCHECK
    ADD CONSTRAINT [FK_Programme_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_AuditLog_aspnet_Users]...';


GO
ALTER TABLE [dbo].[AuditLog] WITH NOCHECK
    ADD CONSTRAINT [FK_AuditLog_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_OrganisationRole_aspnet_Users]...';


GO
ALTER TABLE [dbo].[OrganisationRole] WITH NOCHECK
    ADD CONSTRAINT [FK_OrganisationRole_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Project_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Project] WITH NOCHECK
    ADD CONSTRAINT [FK_Project_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Instrument_DataSource_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Instrument_DataSource] WITH NOCHECK
    ADD CONSTRAINT [FK_Instrument_DataSource_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Organisation_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Organisation] WITH NOCHECK
    ADD CONSTRAINT [FK_Organisation_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Site_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Site] WITH NOCHECK
    ADD CONSTRAINT [FK_Site_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Sensor_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Sensor] WITH NOCHECK
    ADD CONSTRAINT [FK_Sensor_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_DataSchema_aspnet_Users]...';


GO
ALTER TABLE [dbo].[DataSchema] WITH NOCHECK
    ADD CONSTRAINT [FK_DataSchema_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Instrument_Sensor_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Instrument_Sensor] WITH NOCHECK
    ADD CONSTRAINT [FK_Instrument_Sensor_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Progress_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Progress] WITH NOCHECK
    ADD CONSTRAINT [FK_Progress_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_ProjectSite_aspnet_Users]...';


GO
ALTER TABLE [dbo].[ProjectSite] WITH NOCHECK
    ADD CONSTRAINT [FK_ProjectSite_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Organisation_Instrument_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Organisation_Instrument] WITH NOCHECK
    ADD CONSTRAINT [FK_Organisation_Instrument_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Organisation_Site_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Organisation_Site] WITH NOCHECK
    ADD CONSTRAINT [FK_Organisation_Site_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_DataSourceRole_aspnet_Users]...';


GO
ALTER TABLE [dbo].[DataSourceRole] WITH NOCHECK
    ADD CONSTRAINT [FK_DataSourceRole_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Organisation_Station_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Organisation_Station] WITH NOCHECK
    ADD CONSTRAINT [FK_Organisation_Station_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_StatusReason_aspnet_Users]...';


GO
ALTER TABLE [dbo].[StatusReason] WITH NOCHECK
    ADD CONSTRAINT [FK_StatusReason_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Project_Station_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Project_Station] WITH NOCHECK
    ADD CONSTRAINT [FK_Project_Station_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_DataSourceTransformation_aspnet_Users]...';


GO
ALTER TABLE [dbo].[DataSourceTransformation] WITH NOCHECK
    ADD CONSTRAINT [FK_DataSourceTransformation_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Station_Instrument_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Station_Instrument] WITH NOCHECK
    ADD CONSTRAINT [FK_Station_Instrument_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_DataSourceType_aspnet_Users]...';


GO
ALTER TABLE [dbo].[DataSourceType] WITH NOCHECK
    ADD CONSTRAINT [FK_DataSourceType_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Offering_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Offering] WITH NOCHECK
    ADD CONSTRAINT [FK_Offering_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_DataLog_aspnet_Users]...';


GO
ALTER TABLE [dbo].[DataLog] WITH NOCHECK
    ADD CONSTRAINT [FK_DataLog_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_ImportBatch_aspnet_Users]...';


GO
ALTER TABLE [dbo].[ImportBatch] WITH NOCHECK
    ADD CONSTRAINT [FK_ImportBatch_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Phenomenon_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Phenomenon] WITH NOCHECK
    ADD CONSTRAINT [FK_Phenomenon_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Observation_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Observation] WITH NOCHECK
    ADD CONSTRAINT [FK_Observation_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_SchemaColumn_aspnet_Users]...';


GO
ALTER TABLE [dbo].[SchemaColumn] WITH NOCHECK
    ADD CONSTRAINT [FK_SchemaColumn_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_SchemaColumnType_aspnet_Users]...';


GO
ALTER TABLE [dbo].[SchemaColumnType] WITH NOCHECK
    ADD CONSTRAINT [FK_SchemaColumnType_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_PhenomenonOffering_aspnet_Users]...';


GO
ALTER TABLE [dbo].[PhenomenonOffering] WITH NOCHECK
    ADD CONSTRAINT [FK_PhenomenonOffering_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_PhenomenonUOM_aspnet_Users]...';


GO
ALTER TABLE [dbo].[PhenomenonUOM] WITH NOCHECK
    ADD CONSTRAINT [FK_PhenomenonUOM_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Status_aspnet_Users]...';


GO
ALTER TABLE [dbo].[Status] WITH NOCHECK
    ADD CONSTRAINT [FK_Status_aspnet_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Refreshing [dbo].[vObservationRoles]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[vObservationRoles]';


GO
PRINT N'Refreshing [dbo].[aspnet_PersonalizationAdministration_DeleteAllState]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[aspnet_PersonalizationAdministration_DeleteAllState]';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Refreshing [dbo].[aspnet_PersonalizationAdministration_FindState]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[aspnet_PersonalizationAdministration_FindState]';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Refreshing [dbo].[aspnet_PersonalizationAdministration_GetCountOfState]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[aspnet_PersonalizationAdministration_GetCountOfState]';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Refreshing [dbo].[aspnet_PersonalizationAdministration_ResetSharedState]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[aspnet_PersonalizationAdministration_ResetSharedState]';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Refreshing [dbo].[aspnet_PersonalizationAllUsers_GetPageSettings]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[aspnet_PersonalizationAllUsers_GetPageSettings]';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Refreshing [dbo].[aspnet_PersonalizationAllUsers_ResetPageSettings]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[aspnet_PersonalizationAllUsers_ResetPageSettings]';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Refreshing [dbo].[aspnet_PersonalizationAllUsers_SetPageSettings]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[aspnet_PersonalizationAllUsers_SetPageSettings]';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Refreshing [dbo].[aspnet_AnyDataInTables]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[aspnet_AnyDataInTables]';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Refreshing [dbo].[aspnet_Profile_DeleteInactiveProfiles]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[aspnet_Profile_DeleteInactiveProfiles]';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Refreshing [dbo].[aspnet_Profile_GetNumberOfInactiveProfiles]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[aspnet_Profile_GetNumberOfInactiveProfiles]';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Refreshing [dbo].[aspnet_Profile_GetProfiles]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[aspnet_Profile_GetProfiles]';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Refreshing [dbo].[aspnet_Profile_GetProperties]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[aspnet_Profile_GetProperties]';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Refreshing [dbo].[aspnet_Profile_SetProperties]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[aspnet_Profile_SetProperties]';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Refreshing [dbo].[aspnet_Users_DeleteUser]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[aspnet_Users_DeleteUser]';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Refreshing [dbo].[aspnet_Profile_DeleteProfiles]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[aspnet_Profile_DeleteProfiles]';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Refreshing [dbo].[aspnet_CheckSchemaVersion]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[aspnet_CheckSchemaVersion]';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Refreshing [dbo].[aspnet_RegisterSchemaVersion]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[aspnet_RegisterSchemaVersion]';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Refreshing [dbo].[aspnet_UnRegisterSchemaVersion]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[aspnet_UnRegisterSchemaVersion]';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Refreshing [dbo].[aspnet_Roles_DeleteRole]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[aspnet_Roles_DeleteRole]';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Refreshing [dbo].[aspnet_UsersInRoles_AddUsersToRoles]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[aspnet_UsersInRoles_AddUsersToRoles]';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Refreshing [dbo].[aspnet_UsersInRoles_FindUsersInRole]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[aspnet_UsersInRoles_FindUsersInRole]';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Refreshing [dbo].[aspnet_UsersInRoles_GetRolesForUser]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[aspnet_UsersInRoles_GetRolesForUser]';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Refreshing [dbo].[aspnet_UsersInRoles_GetUsersInRoles]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[aspnet_UsersInRoles_GetUsersInRoles]';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Refreshing [dbo].[aspnet_UsersInRoles_IsUserInRole]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[aspnet_UsersInRoles_IsUserInRole]';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Refreshing [dbo].[aspnet_UsersInRoles_RemoveUsersFromRoles]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[aspnet_UsersInRoles_RemoveUsersFromRoles]';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Refreshing [dbo].[aspnet_WebEvent_LogEvent]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[aspnet_WebEvent_LogEvent]';


GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Checking existing data against newly created constraints';


GO
USE [$(DatabaseName)];


GO
ALTER TABLE [dbo].[RoleModule] WITH CHECK CHECK CONSTRAINT [FK_RoleModule_aspnet_Roles];

ALTER TABLE [dbo].[DataSourceRole] WITH CHECK CHECK CONSTRAINT [FK_DataSourceRole_aspnet_Roles];

ALTER TABLE [dbo].[TransformationType] WITH CHECK CHECK CONSTRAINT [FK_TransformationType_aspnet_Users];

ALTER TABLE [dbo].[UnitOfMeasure] WITH CHECK CHECK CONSTRAINT [FK_UnitOfMeasure_aspnet_Users];

ALTER TABLE [dbo].[Instrument] WITH CHECK CHECK CONSTRAINT [FK_Instrument_aspnet_Users];

ALTER TABLE [dbo].[DataSource] WITH CHECK CHECK CONSTRAINT [FK_DataSource_aspnet_Users];

ALTER TABLE [dbo].[Station] WITH CHECK CHECK CONSTRAINT [FK_Station_aspnet_Users];

ALTER TABLE [dbo].[Programme] WITH CHECK CHECK CONSTRAINT [FK_Programme_aspnet_Users];

ALTER TABLE [dbo].[AuditLog] WITH CHECK CHECK CONSTRAINT [FK_AuditLog_aspnet_Users];

ALTER TABLE [dbo].[OrganisationRole] WITH CHECK CHECK CONSTRAINT [FK_OrganisationRole_aspnet_Users];

ALTER TABLE [dbo].[Project] WITH CHECK CHECK CONSTRAINT [FK_Project_aspnet_Users];

ALTER TABLE [dbo].[Instrument_DataSource] WITH CHECK CHECK CONSTRAINT [FK_Instrument_DataSource_aspnet_Users];

ALTER TABLE [dbo].[Organisation] WITH CHECK CHECK CONSTRAINT [FK_Organisation_aspnet_Users];

ALTER TABLE [dbo].[Site] WITH CHECK CHECK CONSTRAINT [FK_Site_aspnet_Users];

ALTER TABLE [dbo].[Sensor] WITH CHECK CHECK CONSTRAINT [FK_Sensor_aspnet_Users];

ALTER TABLE [dbo].[DataSchema] WITH CHECK CHECK CONSTRAINT [FK_DataSchema_aspnet_Users];

ALTER TABLE [dbo].[Instrument_Sensor] WITH CHECK CHECK CONSTRAINT [FK_Instrument_Sensor_aspnet_Users];

ALTER TABLE [dbo].[Progress] WITH CHECK CHECK CONSTRAINT [FK_Progress_aspnet_Users];

ALTER TABLE [dbo].[ProjectSite] WITH CHECK CHECK CONSTRAINT [FK_ProjectSite_aspnet_Users];

ALTER TABLE [dbo].[Organisation_Instrument] WITH CHECK CHECK CONSTRAINT [FK_Organisation_Instrument_aspnet_Users];

ALTER TABLE [dbo].[Organisation_Site] WITH CHECK CHECK CONSTRAINT [FK_Organisation_Site_aspnet_Users];

ALTER TABLE [dbo].[DataSourceRole] WITH CHECK CHECK CONSTRAINT [FK_DataSourceRole_aspnet_Users];

ALTER TABLE [dbo].[Organisation_Station] WITH CHECK CHECK CONSTRAINT [FK_Organisation_Station_aspnet_Users];

ALTER TABLE [dbo].[StatusReason] WITH CHECK CHECK CONSTRAINT [FK_StatusReason_aspnet_Users];

ALTER TABLE [dbo].[Project_Station] WITH CHECK CHECK CONSTRAINT [FK_Project_Station_aspnet_Users];

ALTER TABLE [dbo].[DataSourceTransformation] WITH CHECK CHECK CONSTRAINT [FK_DataSourceTransformation_aspnet_Users];

ALTER TABLE [dbo].[Station_Instrument] WITH CHECK CHECK CONSTRAINT [FK_Station_Instrument_aspnet_Users];

ALTER TABLE [dbo].[DataSourceType] WITH CHECK CHECK CONSTRAINT [FK_DataSourceType_aspnet_Users];

ALTER TABLE [dbo].[Offering] WITH CHECK CHECK CONSTRAINT [FK_Offering_aspnet_Users];

ALTER TABLE [dbo].[DataLog] WITH CHECK CHECK CONSTRAINT [FK_DataLog_aspnet_Users];

ALTER TABLE [dbo].[ImportBatch] WITH CHECK CHECK CONSTRAINT [FK_ImportBatch_aspnet_Users];

ALTER TABLE [dbo].[Phenomenon] WITH CHECK CHECK CONSTRAINT [FK_Phenomenon_aspnet_Users];

ALTER TABLE [dbo].[Observation] WITH CHECK CHECK CONSTRAINT [FK_Observation_aspnet_Users];

ALTER TABLE [dbo].[SchemaColumn] WITH CHECK CHECK CONSTRAINT [FK_SchemaColumn_aspnet_Users];

ALTER TABLE [dbo].[SchemaColumnType] WITH CHECK CHECK CONSTRAINT [FK_SchemaColumnType_aspnet_Users];

ALTER TABLE [dbo].[PhenomenonOffering] WITH CHECK CHECK CONSTRAINT [FK_PhenomenonOffering_aspnet_Users];

ALTER TABLE [dbo].[PhenomenonUOM] WITH CHECK CHECK CONSTRAINT [FK_PhenomenonUOM_aspnet_Users];

ALTER TABLE [dbo].[Status] WITH CHECK CHECK CONSTRAINT [FK_Status_aspnet_Users];


GO
CREATE TABLE [#__checkStatus] (
    id           INT            IDENTITY (1, 1) PRIMARY KEY CLUSTERED,
    [Schema]     NVARCHAR (256),
    [Table]      NVARCHAR (256),
    [Constraint] NVARCHAR (256)
);

SET NOCOUNT ON;

DECLARE tableconstraintnames CURSOR LOCAL FORWARD_ONLY
    FOR SELECT SCHEMA_NAME([schema_id]),
               OBJECT_NAME([parent_object_id]),
               [name],
               0
        FROM   [sys].[objects]
        WHERE  [parent_object_id] IN (OBJECT_ID(N'dbo.aspnet_Membership'), OBJECT_ID(N'dbo.aspnet_Paths'), OBJECT_ID(N'dbo.aspnet_Roles'), OBJECT_ID(N'dbo.aspnet_Users'), OBJECT_ID(N'dbo.aspnet_PersonalizationAllUsers'), OBJECT_ID(N'dbo.aspnet_PersonalizationPerUser'), OBJECT_ID(N'dbo.aspnet_Profile'), OBJECT_ID(N'dbo.aspnet_UsersInRoles'))
               AND [type] IN (N'F', N'C')
                   AND [object_id] IN (SELECT [object_id]
                                       FROM   [sys].[check_constraints]
                                       WHERE  [is_not_trusted] <> 0
                                              AND [is_disabled] = 0
                                       UNION
                                       SELECT [object_id]
                                       FROM   [sys].[foreign_keys]
                                       WHERE  [is_not_trusted] <> 0
                                              AND [is_disabled] = 0);

DECLARE @schemaname AS NVARCHAR (256);

DECLARE @tablename AS NVARCHAR (256);

DECLARE @checkname AS NVARCHAR (256);

DECLARE @is_not_trusted AS INT;

DECLARE @statement AS NVARCHAR (1024);

BEGIN TRY
    OPEN tableconstraintnames;
    FETCH tableconstraintnames INTO @schemaname, @tablename, @checkname, @is_not_trusted;
    WHILE @@fetch_status = 0
        BEGIN
            PRINT N'Checking constraint: ' + @checkname + N' [' + @schemaname + N'].[' + @tablename + N']';
            SET @statement = N'ALTER TABLE [' + @schemaname + N'].[' + @tablename + N'] WITH ' + CASE @is_not_trusted WHEN 0 THEN N'CHECK' ELSE N'NOCHECK' END + N' CHECK CONSTRAINT [' + @checkname + N']';
            BEGIN TRY
                EXECUTE [sp_executesql] @statement;
            END TRY
            BEGIN CATCH
                INSERT  [#__checkStatus] ([Schema], [Table], [Constraint])
                VALUES                  (@schemaname, @tablename, @checkname);
            END CATCH
            FETCH tableconstraintnames INTO @schemaname, @tablename, @checkname, @is_not_trusted;
        END
END TRY
BEGIN CATCH
    PRINT ERROR_MESSAGE();
END CATCH

IF CURSOR_STATUS(N'LOCAL', N'tableconstraintnames') >= 0
    CLOSE tableconstraintnames;

IF CURSOR_STATUS(N'LOCAL', N'tableconstraintnames') = -1
    DEALLOCATE tableconstraintnames;

SELECT N'Constraint verification failed:' + [Schema] + N'.' + [Table] + N',' + [Constraint]
FROM   [#__checkStatus];

IF @@ROWCOUNT > 0
    BEGIN
        DROP TABLE [#__checkStatus];
        RAISERROR (N'An error occurred while verifying constraints', 16, 127);
    END

SET NOCOUNT OFF;

DROP TABLE [#__checkStatus];


GO
PRINT N'Update complete.';


GO
